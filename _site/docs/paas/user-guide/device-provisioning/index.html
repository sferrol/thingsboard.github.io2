







<!Doctype html>
<html id="docs" class="ThingsBoard Cloud Documentation">







<head>
    <meta charset="utf-8">
    <meta name="cf-2fa-verify" content="a08672380de15e9">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Provisioning devices | ThingsBoard Cloud</title>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Provisioning devices" />
<meta name="author" content="thingsboard" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="IoT device management using ThingsBoard provisioning devices feature" />
<meta property="og:description" content="IoT device management using ThingsBoard provisioning devices feature" />
<link rel="canonical" href="http://0.0.0.0:4002/docs/paas/user-guide/device-provisioning/" />
<meta property="og:url" content="http://0.0.0.0:4002/docs/paas/user-guide/device-provisioning/" />
<meta property="og:site_name" content="ThingsBoard" />
<meta property="og:image" content="http://0.0.0.0:4002/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://0.0.0.0:4002/images/thingsboard_logo.png" />
<meta property="twitter:title" content="Provisioning devices" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
{"url":"http://0.0.0.0:4002/docs/paas/user-guide/device-provisioning/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4002/images/thingsboard_logo.png"},"name":"thingsboard"},"author":{"@type":"Person","name":"thingsboard"},"image":{"twitter":"/images/thingsboard_logo.png","facebook":"/images/thingsboard_logo.png","url":"http://0.0.0.0:4002/images/thingsboard_logo.png","@type":"imageObject"},"description":"IoT device management using ThingsBoard provisioning devices feature","@type":"WebPage","headline":"Provisioning devices","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
    
    <meta name="twitter:description" content="IoT device management using ThingsBoard provisioning devices feature"/>
    
    
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.7.0/qs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gifffer/1.5.0/gifffer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            Gifffer();
        }
    </script>
    <script type="text/javascript">
        /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
        !function (a) {
            "use strict";
            var b = function (b, c, d) {
                function e(a) {
                    return h.body ? a() : void setTimeout(function () {
                        e(a)
                    })
                }

                function f() {
                    i.addEventListener && i.removeEventListener("load", f), i.media = d || "all"
                }

                var g, h = a.document, i = h.createElement("link");
                if (c) g = c; else {
                    var j = (h.body || h.getElementsByTagName("head")[0]).childNodes;
                    g = j[j.length - 1]
                }
                var k = h.styleSheets;
                i.rel = "stylesheet", i.href = b, i.media = "only x", e(function () {
                    g.parentNode.insertBefore(i, c ? g : g.nextSibling)
                });
                var l = function (a) {
                    for (var b = i.href, c = k.length; c--;) if (k[c].href === b) return a();
                    setTimeout(function () {
                        l(a)
                    })
                };
                return i.addEventListener && i.addEventListener("load", f), i.onloadcssdefined = l, l(f), i
            };
            "undefined" != typeof exports ? exports.loadCSS = b : a.loadCSS = b
        }("undefined" != typeof global ? global : this);

        /*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
        function onloadCSS(a, b) {
            function c() {
                !d && b && (d = !0, b.call(a))
            }

            var d;
            a.addEventListener && a.addEventListener("load", c), a.attachEvent && a.attachEvent("onload", c), "isApplicationInstalled" in navigator && "onloadcssdefined" in a && a.onloadcssdefined(c)
        }
    </script>
    <script type="text/javascript">

        function jqueryDefer(method) {
            if (window.jQuery) {
                method();
            } else {
                setTimeout(function () {
                    jqueryDefer(method)
                }, 50);
            }
        }

        function jqueryUiDefer(method) {
            if (window.jQuery && window.jQuery.ui) {
                method();
            } else {
                setTimeout(function () {
                    jqueryUiDefer(method)
                }, 50);
            }
        }

        window.vis = (function () {
            var stateKey,
                eventKey,
                keys = {
                    hidden: "visibilitychange",
                    webkitHidden: "webkitvisibilitychange",
                    mozHidden: "mozvisibilitychange",
                    msHidden: "msvisibilitychange"
                };
            for (stateKey in keys) {
                if (stateKey in document) {
                    eventKey = keys[stateKey];
                    break;
                }
            }
            return function (c) {
                if (c) document.addEventListener(eventKey, c);
                return !document[stateKey];
            }
        })();

        function loadScript(src, callback) {
            var s, r, t;
            r = false;
            s = document.createElement('script');
            s.type = 'text/javascript';
            s.src = src;
            s.onload = s.onreadystatechange = function () {
                if (!r && (!this.readyState || this.readyState == 'complete')) {
                    r = true;
                    if (callback) {
                        callback();
                    }
                }
            };
            t = document.getElementsByTagName('script')[0];
            t.parentNode.insertBefore(s, t);
        }

        function loadCssAsync(src, callback) {
            var stylesheet = loadCSS(src);
            if (callback) {
                onloadCSS(stylesheet, callback);
            }
        }

        function loadNextScript(index, scriptsList, completeCallback) {
            if (index < scriptsList.length) {
                var script = scriptsList[index];
                if (script.type === 'script') {
                    loadScript(script.src, function () {
                        if (script.callback) {
                            script.callback();
                        }
                        index++;
                        loadNextScript(index, scriptsList, completeCallback);
                    });
                } else if (script.type === 'css') {
                    loadCssAsync(script.src, function () {
                        index++;
                        loadNextScript(index, scriptsList, completeCallback);
                    });
                }
            } else if (completeCallback) {
                completeCallback();
            }
        }

        var initialScriptsList = [
            {src: '/js/jquery-2.2.0.min.js', type: 'script'},
            {src: '/css/jquery-ui.min.css', type: 'css'},
            {src: '/js/jquery-ui.min.js', type: 'script'},
            {src: '/js/jquery.vide.js', type: 'script'},
            {src: '/js/script.js', type: 'script'},
            {src: '/css/photoswipe.css', type: 'css'},
            {src: '/css/default-skin/default-skin.css', type: 'css'},
            {src: '/js/photoswipe.min.js', type: 'script'},
            {src: '/js/photoswipe-ui-default.min.js', type: 'script'}
        ];

        loadNextScript(0, initialScriptsList);

        jqueryDefer(function () {
            (function ($, win) {
                $.fn.inViewport = function (cb) {
                    return this.each(function (i, el) {
                        function visPx() {
                            var H = $(this).height(),
                                r = el.getBoundingClientRect(), t = r.top, b = r.bottom;
                            var result = cb.call(el, Math.max(0, t > 0 ? H - t : (b < H ? b : H)));
                            if (result) {
                                $(win).off("resize scroll", visPx);
                            }
                        }

                        visPx();
                        $(win).on("resize scroll", visPx);
                    });
                };
            }(jQuery, window));
        });

        function inViewportDefer(method) {
            if (window.jQuery && $.fn.inViewport) {
                method();
            } else {
                setTimeout(function () {
                    inViewportDefer(method)
                }, 50);
            }
        }

    </script>
    <script type="text/javascript">
        function _gaLt(event) {
            /* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
            if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
                return;
            }
            var el = event.srcElement || event.target;

            while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
                el = el.parentNode;
            }
            if (el && el.href) {
                var link = el.href;
                if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
                    var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
                    if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
                        target = "_blank";
                    }

                    var hbrun = false; // tracker has not yet run
                    var hitBack = function () {
                        if (hbrun) return;
                        hbrun = true;
                        window.location.href = link;
                    };

                    if (target) {
                        ga(
                            "send", "event", "Outgoing Links", link,
                            document.location.pathname + document.location.search
                        );
                    } else {
                        event.preventDefault ? event.preventDefault() : event.returnValue = !1;
                        ga(
                            "send", "event", "Outgoing Links", link,
                            document.location.pathname + document.location.search, {
                                "hitCallback": hitBack
                            }
                        );

                        setTimeout(hitBack, 1000);
                    }
                }
            }
        }

        var _w = window;
        var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
        _w.addEventListener ? _w.addEventListener("load", function () {
                document.body.addEventListener(_gaLtEvt, _gaLt, !1)
            }, !1)
            : _w.attachEvent && _w.attachEvent("onload", function () {
            document.body.attachEvent("on" + _gaLtEvt, _gaLt)
        });
    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-88383331-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script>
        function Burger() {
            var header = $('header');
            var body = $('body');
            if (header.hasClass('opened-burger')) {
                header.removeClass('opened-burger');
                let subMenus = $('nav.head-menu > ul > li > div.centered-sub > ul.sub-menu');
                subMenus.removeClass('open-sub');
                body.css('overflow', '');
            } else {
                header.addClass('opened-burger');
                body.css('overflow', 'hidden');
            }
        }
    </script>
    <script>

        jqueryDefer(function () {
            let menuElement = $('nav.head-menu > ul');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            let menuItems = $('nav.head-menu > ul > li');
            let indicator = $('nav.head-menu > ul > div.indicator');
            let subMenuActive = false;
            menuElement.on('mouseleave', function (event) {
                if (!$(event.relatedTarget).parents('div.sub-menu-container').length) {
                    subMenuActive = false;
                    submenuContainer.removeClass('active bounds-transition');
                    menuItems.removeClass('active');
                    indicator.removeClass('left-transition');
                }
            });
            submenuContainer.on('mouseleave', function (event) {
                if (!$(event.relatedTarget).parents('nav.head-menu > ul').length) {
                    subMenuActive = false;
                    submenuContainer.removeClass('active bounds-transition');
                    menuItems.removeClass('active');
                    indicator.removeClass('left-transition');
                }
            });
            menuItems.each(function() {
                let item = $( this );
                let subMenuId = item.attr('data-submenu-id');
                item.on('mouseenter', function () {
                    let submenus = $('nav.head-menu > div.sub-menu-container > div');
                    submenus.css('display', 'none');
                    menuItems.removeClass('active');
                    item.addClass('active');
                    let targetSubMenu = $('nav.head-menu > div.sub-menu-container > div#'+subMenuId);
                    targetSubMenu.css('display', 'block');
                    submenuContainer.css('overflow', 'visible');
                    let left = item.position().left + (item.outerWidth() - targetSubMenu.outerWidth()) / 2;
                    submenuContainer.css('left', left + 'px');
                    if (!subMenuActive) {
                        submenuContainer.addClass('active');
                        subMenuActive = true;
                    } else {
                        submenuContainer.addClass('bounds-transition');
                        indicator.addClass('left-transition');
                    }
                    indicator.css('left', item.position().left);
                    indicator.css('width', item.outerWidth());
                    submenuContainer.css('height', targetSubMenu.outerHeight() + 'px');
                    submenuContainer.css('width', targetSubMenu.outerWidth() + 'px');
                    submenuContainer.css('overflow', 'hidden');
                });
            });

            let isMobile = $('button.burger').css('display') === 'block';
            if (isMobile) {
                initMobileSubmenu();
            }

            $(window).resize(function(){
                let newIsMobile = $('button.burger').css('display') === 'block';
                if (isMobile !== newIsMobile) {
                    isMobile = newIsMobile;
                    if (isMobile) {
                        initMobileSubmenu();
                    } else {
                        restoreDesktopSubmenu();
                    }
                }
            });

            // Products selector

            
            let productsSelector = $('.products-selector');
            $(window).click(function(e) {
                if (productsSelector[0].contains(e.target)) {
                    if (productsSelector.hasClass('active')) {
                        productsSelector.removeClass('active');
                    } else {
                        productsSelector.addClass('active');
                    }
                } else {
                    productsSelector.removeClass('active');
                }
            });
            

            // Rogue line numbers fix (don't show line numbers for 1 row)
            $( document ).ready(function() {
                $('.rouge-gutter.gl').each(function() {
                    var lineNumbers = $(this).children('.lineno');
                    if (lineNumbers.text() === '1\n') {
                        $(this).css('display', 'none');
                    }
                });
            });
        });

        function initMobileSubmenu() {

            var header = $('header');
            if (header.hasClass('opened-burger')) {
                var body = $('body');
                body.css('overflow', 'hidden');
            }

            let targetSubMenus = $('nav.head-menu > div.sub-menu-container > div');
            targetSubMenus.css('display', 'block');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            submenuContainer.removeClass('active');
            submenuContainer.css('display', 'none');

            targetSubMenus.each(function() {
                let subMenu = $( this );
                let subMenuId = subMenu.attr('id');
                let parent = $('nav.head-menu > ul > li.'+subMenuId);
                parent.append(subMenu);
            });
        }

        function restoreDesktopSubmenu() {
            var body = $('body');
            body.css('overflow', '');
            let targetSubMenus = $('nav.head-menu > ul > li > div');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            submenuContainer.removeClass('active');
            submenuContainer.css('display', 'block');
            let menuItems = $('nav.head-menu > ul > li');
            menuItems.removeClass('active');
            targetSubMenus.each(function() {
                let subMenu = $( this );
                submenuContainer.append(subMenu);
            });
        }

        function listburg(subMenuId) {
            let isMobile = $('button.burger').css('display') === 'block';
            if (isMobile) {
                let targetSubMenu = $('nav.head-menu > ul > li > div.centered-sub#'+subMenuId+' > ul.sub-menu');
                let isOpen = targetSubMenu.hasClass('open-sub');
                let subMenus = $('nav.head-menu > ul > li > div.centered-sub > ul.sub-menu');
                subMenus.removeClass('open-sub');
                if (!isOpen) {
                    targetSubMenu.addClass('open-sub');
                }
            }
        }
    </script>
</head>
<body>

<div class="products-selector">
    <img src="/images/thingsboard-c-icon.svg"/>
    <div class="product-info">
        <div class="product-title">
            Cloud
        </div>
        <div class="product-description">
            ThingsBoard Documentation
        </div>
    </div>
    <div class="products">
        
        

    
        
        


        
            
        
    


        <a href="/docs/paas/user-guide/device-provisioning/" class="product active">Cloud</a>
        
        

    
        
        


        
            
        
    


        <a href="/docs/pe/user-guide/device-provisioning/" class="product">Professional Edition</a>
        
        

    
        
        


        
            
        
    


        <a href="/docs/user-guide/device-provisioning/" class="product">Community Edition</a>
        
        

    


        <a href="/docs/edge/" class="product">Edge</a>
        
        

    


        <a href="/docs/iot-gateway/" class="product">IoT Gateway</a>
        
        

    


        <a href="/products/license-server/" class="product">License Server</a>
        
        

    


        <a href="/docs/trendz/" class="product">Trendz Analytics</a>
        
    </div>
</div>

<header>
    <div class="logo-burger">
        
        <button onclick="Burger()" class="burger"></button>
        <div id="githubButtonContainer">
            <a class="github-button" href="https://github.com/thingsboard/thingsboard" data-show-count="true"
               aria-label="Star thingsboard/thingsboard on GitHub">Star</a>
        </div>
    </div>
    <nav class="head-menu">
        <ul>
            <li class="nav-products" data-submenu-id="nav-products">
                <a onclick="listburg('nav-products')">Products</a>
            </li>
            <li class="nav-services" data-submenu-id="nav-services">
                <a onclick="listburg('nav-services')">Services</a>
            </li>
            
            <li class="nav-cases" data-submenu-id="nav-cases">
                <a onclick="listburg('nav-cases')">Use Cases</a>
            </li>
            <li class="nav-customers" data-submenu-id="nav-customers">
                <a onclick="listburg('nav-customers')">Customers</a>
            </li>
            <li class="nav-company" data-submenu-id="nav-company">
                <a onclick="listburg('nav-company')">Company</a>
            </li>
            <div class="indicator"><div class="head-arrow"></div><div class="line"></div><div class="sub-background"></div></div>
        </ul>
        <div class="sub-menu-container">
            <div id="nav-products" class="centered-sub">
                <ul class="sub-menu products">
                    <div class="sub-groups">
                        <div class="group">
                            <p class="group-name">IoT platforms</p>
                            <a class="cloud-lnk" href="/products/paas/">
                                <img src="/images/thingsboard-c-icon.svg">
                                <div class="sub-text">
                                    <h1>Cloud</h1>
                                    <p>Platform as a service</p>
                                </div>
                            </a>
                            <a class="prof-lnk" href="/products/thingsboard-pe/">
                                <img src="/images/thingsboard-p-icon.svg">
                                <div class="sub-text">
                                    <h1>Professional Edition</h1>
                                    <p>Advanced IoT platform</p>
                                </div>
                            </a>
                            <a class="com-lnk" href="/">
                                <img src="/images/thingsboard-cm-icon.svg">
                                <div class="sub-text">
                                    <h1>Community Edition</h1>
                                    <p>Open source platform</p>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <p class="group-name">Product ecosystem</p>
                            <a class="edge-lnk" href="/products/thingsboard-edge/">
                                <img src="/images/thingsboard-e-icon.svg">
                                <div class="sub-text">
                                    <h1>Edge</h1>
                                    <p>Edge computing</p>
                                </div>
                            </a>
                            <a class="gateway-lnk" href="/docs/iot-gateway/what-is-iot-gateway/">
                                <img src="/images/gateway-icon.svg">
                                <div class="sub-text">
                                    <h1>IoT Gateway</h1>
                                    <p>Connect legacy protocols</p>
                                </div>
                            </a>
                            <a class="license-lnk" href="/products/license-server/">
                                <img src="/images/license-icon.svg">
                                <div class="sub-text">
                                    <h1>License Server</h1>
                                    <p>Billing solution</p>
                                </div>
                            </a>
                            <a class="trendz-lnk" href="/products/trendz/">
                                <img src="/images/trendz-icon.svg">
                                <div class="sub-text">
                                    <h1>Trendz Analytics</h1>
                                    <p>Data analytics and Prediction</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </ul>
            </div>
            <div id="nav-services" class="centered-sub">
                <ul class="sub-menu services">
                    <a href="/docs/services/support/">
                        <img src="/images/support-icon.svg">
                        <div class="sub-text">
                            <h1>Support</h1>
                            <p>Support packages</p>
                        </div>
                    </a>
                    <a href="/docs/services/trainings/">
                        <img src="/images/train-icon.svg">
                        <div class="sub-text">
                            <h1>Trainings</h1>
                            <p>ThingsBoard education courses</p>
                        </div>
                    </a>
                    <a href="/docs/services/consulting/">
                        <img src="/images/prof-icon.svg">
                        <div class="sub-text">
                            <h1>Professional services</h1>
                            <p>Development of solutions by the ThingsBoard team</p>
                        </div>
                    </a>
                </ul>
            </div>
            
            <div id="nav-cases" class="centered-sub">
                <ul class="sub-menu cases">
                    <a href="/smart-metering/">
                        <img src="/images/case-met-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Metering</h1>
                            <p>Collection, analysis and visualization of data from meters</p>
                        </div>
                    </a>
                    <a href="/smart-energy/">
                        <img src="/images/case-eng-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Energy</h1>
                            <p>Energy monitoring and efficiency analysis</p>
                        </div>
                    </a>
                    <a href="/smart-farming/">
                        <img src="/images/case-fam-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Farming</h1>
                            <p>Monitoring of indoor conditions and plant growth characteristics</p>
                        </div>
                    </a>
                    <a href="/fleet-tracking/">
                        <img src="/images/case-trk-icon.svg">
                        <div class="sub-text">
                            <h1>Fleet Tracking</h1>
                            <p>Fleet tracking and fleet management</p>
                        </div>
                    </a>
                </ul>
            </div>
            <div id="nav-customers" class="centered-sub">
                <ul class="sub-menu customers">
                    <div class="sub-groups">
                        <div class="group">
                            <a class="small-link" href="/industries/smart-energy/">
                                <img src="/images/se-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart Energy</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/agriculture/">
                                <img src="/images/agr-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Agriculture</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/smart-buildings/">
                                <img src="/images/sb-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart Buildings</h1>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <a class="small-link" href="/industries/smart-city/">
                                <img src="/images/sc-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart City</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/telecom/">
                                <img src="/images/tel-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Telecom</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/industry40/">
                                <img src="/images/in-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Industry 4.0</h1>
                                </div>
                            </a>
                        </div>
                    </div>
                </ul>
            </div>
            <div id="nav-company" class="centered-sub">
                <ul class="sub-menu about">
                    <div class="sub-groups">
                        <div class="group">
                            <a class="small-link" href="/company/">
                                <img src="/images/about-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Our Company</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/docs/contact-us/">
                                <img src="/images/contact-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Contact Us</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/careers/">
                                <img src="/images/careers-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Careers</h1>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <a class="small-link" href="/mediakit/">
                                <img src="/images/media-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Media Kit</h1>
                                </div>
                            </a>
                            <a class="small-link" href="https://blog.thingsboard.io/">
                                <img src="/images/blog-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Blog</h1>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="bottom-group">
                        <a class="small-link" href="/partners/hardware/">
                            <img src="/images/hard-s-icon.svg">
                            <div class="sub-text">
                                <h1>Hardware partners</h1>
                            </div>
                        </a>
                        <a class="small-link" href="/partners/distributors/">
                            <img src="/images/dis-s-icon.svg">
                            <div class="sub-text">
                                <h1>Distributors</h1>
                            </div>
                        </a>
                    </div>
                </ul>
            </div>
        </div>
    </nav>
    <div>
        <a href="/installations/" class="n-button try">Try it now</a>
        <a href="/pricing/" class="n-button price">Pricing</a>
    </div>
</header>


<div id="searchBox">
    <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/paas/search/?q=' + this.value)">
    <button class="searchButton"></button>
</div>

<!--  HERO  -->
<section id="hero">
  <div id="hero-content">
    <div id="vendorStrip">
      <div id="docsList">
          <ul>
            
              
              
              
              <li>
                  <a href="/docs/paas/getting-started-guides/helloworld/" >Getting Started</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/paas/" class="YAH">Documentation</a>
                  
                     <div class="indicator"><div class="head-arrow"></div><div class="line"></div><div class="sub-background"></div></div>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/paas/guides/" >Guides</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/paas/api/" >API</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/paas/faq/" >FAQ</a>
                  
              </li>
            
          </ul>
          <div id="docsBreadcrumbs">
              
                  
                  
                  
                  
                      
                  
                      
                  
                      
                  
                      
                  
                      
                         
                         
                         
    

    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    
        
        
        
    

    

    

    

    

    


        
            
        
    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    
        
        
        

                         
                            
                  
                    <span class="item">Documentation</span>
                    
                        <span class="divider">></span>
                    
                  
                    <span class="item">Other Features</span>
                    
                        <span class="divider">></span>
                    
                  
                    <span class="item">Device provisioning</span>
                    
                  
              
          </div>
      </div>
    </div>
  </div>
</section>
<div id="docsNav">
    <div class="docItems">
        
            
            
                <a class="toc" href="/docs/paas/getting-started-guides/helloworld/" >Getting Started</a>
            
        
            
            
                <div class="pi-accordion">
                    


<a class="item" data-title="ThingsBoard Cloud" href="/docs/paas/"></a>


<a class="item" data-title="What is ThingsBoard?" href="/docs/paas/getting-started-guides/what-is-thingsboard/"></a>


<a class="item" data-title="What is ThingsBoard Cloud?" href="/products/paas/what-is-thingsboard-cloud/"></a>


<a class="item" data-title="How to connect your device?" href="/docs/paas/getting-started-guides/connectivity/"></a>


<div class="item item-new" data-title="Solution Templates">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/solution-templates/overview/"></a>


<a class="item" data-title="Temperature & Humidity Sensors" href="/docs/paas/solution-templates/temperature-humidity-sensors/"></a>


<a class="item" data-title="Smart office" href="/docs/paas/solution-templates/smart-office/"></a>


<a class="item" data-title="Fleet tracking" href="/docs/paas/solution-templates/fleet-tracking/"></a>


<a class="item" data-title="Water metering" href="/docs/paas/solution-templates/water-metering/"></a>
  </div>
</div>


<div class="item" data-title="Key concepts">
  <div class="container">


<a class="item" data-title="Entities and Relations" href="/docs/paas/user-guide/entities-and-relations/"></a>


<a class="item item-new" data-title="Device Profiles" href="/docs/paas/user-guide/device-profiles/"></a>


<a class="item" data-title="Attributes" href="/docs/paas/user-guide/attributes/"></a>


<a class="item" data-title="Time-series data" href="/docs/paas/user-guide/telemetry/"></a>


<a class="item" data-title="Alarms" href="/docs/paas/user-guide/alarms/"></a>


<a class="item" data-title="Remote commands to devices" href="/docs/paas/user-guide/rpc/"></a>
  </div>
</div>


<div class="item" data-title="Dashboards">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/user-guide/dashboards/"></a>


<a class="item" data-title="Aliases" href="/docs/paas/user-guide/ui/aliases/"></a>


<a class="item" data-title="Widget Actions" href="/docs/paas/user-guide/ui/widget-actions/"></a>


<a class="item" data-title="Widgets Library" href="/docs/paas/user-guide/ui/widget-library/"></a>


<a class="item" data-title="Widgets development" href="/docs/paas/user-guide/contribution/widgets-development/"></a>
  </div>
</div>


<div class="item" data-title="Rule engine">
  <div class="container">


<a class="item" data-title="Getting Started" href="/docs/paas/user-guide/rule-engine-2-0/re-getting-started/"></a>


<a class="item" data-title="Overview" href="/docs/paas/user-guide/rule-engine-2-0/overview/"></a>


<a class="item" data-title="Architecture" href="/docs/paas/user-guide/rule-engine-2-0/architecture/"></a>


<div class="item" data-title="Nodes">
  <div class="container">


<a class="item" data-title="Filter Nodes" href="/docs/paas/user-guide/rule-engine-2-0/filter-nodes/"></a>


<a class="item" data-title="Enrichment Nodes" href="/docs/paas/user-guide/rule-engine-2-0/enrichment-nodes/"></a>


<a class="item" data-title="Transformation Nodes" href="/docs/paas/user-guide/rule-engine-2-0/transformation-nodes/"></a>


<a class="item" data-title="Action Nodes" href="/docs/paas/user-guide/rule-engine-2-0/action-nodes/"></a>


<a class="item" data-title="External Nodes" href="/docs/paas/user-guide/rule-engine-2-0/external-nodes/"></a>


<a class="item" data-title="Analytics Nodes" href="/docs/paas/user-guide/rule-engine-2-0/analytics-nodes/"></a>
  </div>
</div>
  </div>
</div>


<div class="item" data-title="White-labeling">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/user-guide/white-labeling/"></a>


<a class="item" data-title="Self-registration" href="/docs/paas/user-guide/self-registration/"></a>


<a class="item" data-title="Custom Translations" href="/docs/paas/user-guide/custom-translation/"></a>


<a class="item" data-title="Custom Menu" href="/docs/paas/user-guide/custom-menu/"></a>


<a class="item" data-title="Domains" href="/products/paas/domains/"></a>
  </div>
</div>


<div class="item" data-title="Integrations">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/user-guide/integrations/"></a>


<a class="item" data-title="Remote Integrations" href="/docs/paas/user-guide/integrations/remote-integrations/"></a>


<a class="item" data-title="HTTP" href="/docs/paas/user-guide/integrations/http/"></a>


<a class="item" data-title="MQTT" href="/docs/paas/user-guide/integrations/mqtt/"></a>


<a class="item" data-title="OPC-UA" href="/docs/paas/user-guide/integrations/opc-ua/"></a>


<a class="item" data-title="Actility ThingPark" href="/docs/paas/user-guide/integrations/thingpark/"></a>


<a class="item" data-title="TheThingsNetwork" href="/docs/paas/user-guide/integrations/ttn/"></a>


<a class="item" data-title="TheThingsIndustries" href="/docs/paas/user-guide/integrations/tti/"></a>


<a class="item" data-title="LORIOT" href="/docs/paas/user-guide/integrations/loriot/"></a>


<a class="item" data-title="AWS IoT" href="/docs/paas/user-guide/integrations/aws-iot/"></a>


<a class="item" data-title="AWS Kinesis" href="/docs/paas/user-guide/integrations/aws-kinesis/"></a>


<a class="item" data-title="IBM Watson" href="/docs/paas/user-guide/integrations/ibm-watson-iot/"></a>


<a class="item" data-title="Azure Event Hub" href="/docs/paas/user-guide/integrations/azure-event-hub/"></a>


<a class="item" data-title="Azure IoT Hub" href="/docs/paas/user-guide/integrations/azure-iot-hub/"></a>


<a class="item" data-title="TCP" href="/docs/paas/user-guide/integrations/tcp/"></a>


<a class="item" data-title="UDP" href="/docs/paas/user-guide/integrations/udp/"></a>


<a class="item" data-title="SigFox" href="/docs/paas/user-guide/integrations/sigfox/"></a>


<a class="item" data-title="Ocean Connect" href="/docs/paas/user-guide/integrations/ocean-connect/"></a>


<a class="item" data-title="Custom Integration development guide" href="/docs/paas/user-guide/integrations/custom/"></a>


<a class="item" data-title="Notifications and Alarms on your smartphone using Telegram Bot" href="/docs/paas/user-guide/rule-engine-2-0/tutorials/integration-with-telegram-bot/"></a>
  </div>
</div>


<div class="item" data-title="Analytics">
  <div class="container">


<a class="item" data-title="Trendz Analytics" href="/docs/trendz/"></a>


<a class="item" data-title="Kafka Streams" href="/docs/paas/samples/analytics/kafka-streams/"></a>
  </div>
</div>


<div class="item" data-title="Other Features">
  <div class="container">


<a class="item" data-title="Device Connectivity Status" href="/docs/paas/user-guide/device-connectivity-status/"></a>


<a class="item" data-title="Claiming Devices" href="/docs/paas/user-guide/claiming-devices/"></a>


<a class="item" data-title="Device provisioning" href="/docs/paas/user-guide/device-provisioning/"></a>


<a class="item" data-title="Entity Views" href="/docs/paas/user-guide/entity-views/"></a>


<a class="item" data-title="API Limits" href="/docs/paas/user-guide/api-limits/"></a>


<a class="item" data-title="Bulk Provisioning" href="/docs/paas/user-guide/bulk-provisioning/"></a>


<a class="item" data-title="Entity Groups" href="/docs/paas/user-guide/groups/"></a>


<a class="item" data-title="Scheduler" href="/docs/paas/user-guide/scheduler/"></a>


<a class="item" data-title="Reporting" href="/docs/paas/user-guide/reporting/"></a>


<a class="item" data-title="CSV/XLS data export" href="/docs/paas/user-guide/csv-xls-data-export/"></a>


<a class="item" data-title="File Storage" href="/docs/paas/user-guide/file-storage/"></a>
  </div>
</div>


<div class="item" data-title="Security">
  <div class="container">


<a class="item" data-title="Audit Log" href="/docs/paas/user-guide/audit-log/"></a>


<a class="item" data-title="Advanced RBAC for IoT" href="/docs/paas/user-guide/rbac/"></a>


<a class="item" data-title="OAuth 2 Support" href="/docs/paas/user-guide/oauth-2-support/"></a>


<a class="item" data-title="MQTT over SSL" href="/docs/paas/user-guide/mqtt-over-ssl/"></a>


<a class="item" data-title="Device authentication options" href="/docs/paas/user-guide/device-credentials/"></a>


<a class="item" data-title="Access Token based authentication" href="/docs/paas/user-guide/access-token/"></a>


<a class="item" data-title="Basic MQTT Credentials" href="/docs/paas/user-guide/basic-mqtt/"></a>


<a class="item" data-title="X.509 Certificate based authentication" href="/docs/paas/user-guide/certificates/"></a>
  </div>
</div>


<div class="item" data-title="Administration UI">
  <div class="container">


<a class="item" data-title="Tenants" href="/docs/paas/user-guide/ui/tenants/"></a>


<a class="item" data-title="Customers" href="/docs/paas/user-guide/ui/customers/"></a>


<a class="item" data-title="Users" href="/docs/paas/user-guide/ui/users/"></a>


<a class="item" data-title="Assets" href="/docs/paas/user-guide/ui/assets/"></a>


<a class="item" data-title="Devices" href="/docs/paas/user-guide/ui/devices/"></a>


<a class="item" data-title="Rule Chains" href="/docs/paas/user-guide/ui/rule-chains/"></a>


<a class="item" data-title="Dashboards" href="/docs/paas/user-guide/ui/dashboards/"></a>


<div class="item" data-title="Widgets">
  <div class="container">


<a class="item" data-title="Trip Animation Widget" href="/docs/paas/user-guide/ui/trip-animation-widget/"></a>


<a class="item" data-title="Advanced Settings of the Entity Table widget" href="/docs/paas/user-guide/ui/entity-table-widget/"></a>


<a class="item" data-title="Advanced data key configuration" href="/docs/paas/user-guide/ui/advanced-data-key-configuration/"></a>
  </div>
</div>
  </div>
</div>


<a class="item" data-title="Subscriptions" href="/products/paas/subscription/"></a>


<a class="item" data-title="Plan and billing" href="/products/paas/billing-info/"></a>
                </div>
            
        
            
            
                <a class="toc" href="/docs/paas/guides/" >Guides</a>
            
        
            
            
                <a class="toc" href="/docs/paas/api/" >API</a>
            
        
            
            
                <a class="toc" href="/docs/paas/faq/" >FAQ</a>
            
        
    </div>
</div>








<section id="encyclopedia">
  
  <div id="docsToc">
        <div class="pi-accordion">
        


<a class="item" data-title="ThingsBoard Cloud" href="/docs/paas/"></a>


<a class="item" data-title="What is ThingsBoard?" href="/docs/paas/getting-started-guides/what-is-thingsboard/"></a>


<a class="item" data-title="What is ThingsBoard Cloud?" href="/products/paas/what-is-thingsboard-cloud/"></a>


<a class="item" data-title="How to connect your device?" href="/docs/paas/getting-started-guides/connectivity/"></a>


<div class="item item-new" data-title="Solution Templates">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/solution-templates/overview/"></a>


<a class="item" data-title="Temperature & Humidity Sensors" href="/docs/paas/solution-templates/temperature-humidity-sensors/"></a>


<a class="item" data-title="Smart office" href="/docs/paas/solution-templates/smart-office/"></a>


<a class="item" data-title="Fleet tracking" href="/docs/paas/solution-templates/fleet-tracking/"></a>


<a class="item" data-title="Water metering" href="/docs/paas/solution-templates/water-metering/"></a>
  </div>
</div>


<div class="item" data-title="Key concepts">
  <div class="container">


<a class="item" data-title="Entities and Relations" href="/docs/paas/user-guide/entities-and-relations/"></a>


<a class="item item-new" data-title="Device Profiles" href="/docs/paas/user-guide/device-profiles/"></a>


<a class="item" data-title="Attributes" href="/docs/paas/user-guide/attributes/"></a>


<a class="item" data-title="Time-series data" href="/docs/paas/user-guide/telemetry/"></a>


<a class="item" data-title="Alarms" href="/docs/paas/user-guide/alarms/"></a>


<a class="item" data-title="Remote commands to devices" href="/docs/paas/user-guide/rpc/"></a>
  </div>
</div>


<div class="item" data-title="Dashboards">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/user-guide/dashboards/"></a>


<a class="item" data-title="Aliases" href="/docs/paas/user-guide/ui/aliases/"></a>


<a class="item" data-title="Widget Actions" href="/docs/paas/user-guide/ui/widget-actions/"></a>


<a class="item" data-title="Widgets Library" href="/docs/paas/user-guide/ui/widget-library/"></a>


<a class="item" data-title="Widgets development" href="/docs/paas/user-guide/contribution/widgets-development/"></a>
  </div>
</div>


<div class="item" data-title="Rule engine">
  <div class="container">


<a class="item" data-title="Getting Started" href="/docs/paas/user-guide/rule-engine-2-0/re-getting-started/"></a>


<a class="item" data-title="Overview" href="/docs/paas/user-guide/rule-engine-2-0/overview/"></a>


<a class="item" data-title="Architecture" href="/docs/paas/user-guide/rule-engine-2-0/architecture/"></a>


<div class="item" data-title="Nodes">
  <div class="container">


<a class="item" data-title="Filter Nodes" href="/docs/paas/user-guide/rule-engine-2-0/filter-nodes/"></a>


<a class="item" data-title="Enrichment Nodes" href="/docs/paas/user-guide/rule-engine-2-0/enrichment-nodes/"></a>


<a class="item" data-title="Transformation Nodes" href="/docs/paas/user-guide/rule-engine-2-0/transformation-nodes/"></a>


<a class="item" data-title="Action Nodes" href="/docs/paas/user-guide/rule-engine-2-0/action-nodes/"></a>


<a class="item" data-title="External Nodes" href="/docs/paas/user-guide/rule-engine-2-0/external-nodes/"></a>


<a class="item" data-title="Analytics Nodes" href="/docs/paas/user-guide/rule-engine-2-0/analytics-nodes/"></a>
  </div>
</div>
  </div>
</div>


<div class="item" data-title="White-labeling">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/user-guide/white-labeling/"></a>


<a class="item" data-title="Self-registration" href="/docs/paas/user-guide/self-registration/"></a>


<a class="item" data-title="Custom Translations" href="/docs/paas/user-guide/custom-translation/"></a>


<a class="item" data-title="Custom Menu" href="/docs/paas/user-guide/custom-menu/"></a>


<a class="item" data-title="Domains" href="/products/paas/domains/"></a>
  </div>
</div>


<div class="item" data-title="Integrations">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/paas/user-guide/integrations/"></a>


<a class="item" data-title="Remote Integrations" href="/docs/paas/user-guide/integrations/remote-integrations/"></a>


<a class="item" data-title="HTTP" href="/docs/paas/user-guide/integrations/http/"></a>


<a class="item" data-title="MQTT" href="/docs/paas/user-guide/integrations/mqtt/"></a>


<a class="item" data-title="OPC-UA" href="/docs/paas/user-guide/integrations/opc-ua/"></a>


<a class="item" data-title="Actility ThingPark" href="/docs/paas/user-guide/integrations/thingpark/"></a>


<a class="item" data-title="TheThingsNetwork" href="/docs/paas/user-guide/integrations/ttn/"></a>


<a class="item" data-title="TheThingsIndustries" href="/docs/paas/user-guide/integrations/tti/"></a>


<a class="item" data-title="LORIOT" href="/docs/paas/user-guide/integrations/loriot/"></a>


<a class="item" data-title="AWS IoT" href="/docs/paas/user-guide/integrations/aws-iot/"></a>


<a class="item" data-title="AWS Kinesis" href="/docs/paas/user-guide/integrations/aws-kinesis/"></a>


<a class="item" data-title="IBM Watson" href="/docs/paas/user-guide/integrations/ibm-watson-iot/"></a>


<a class="item" data-title="Azure Event Hub" href="/docs/paas/user-guide/integrations/azure-event-hub/"></a>


<a class="item" data-title="Azure IoT Hub" href="/docs/paas/user-guide/integrations/azure-iot-hub/"></a>


<a class="item" data-title="TCP" href="/docs/paas/user-guide/integrations/tcp/"></a>


<a class="item" data-title="UDP" href="/docs/paas/user-guide/integrations/udp/"></a>


<a class="item" data-title="SigFox" href="/docs/paas/user-guide/integrations/sigfox/"></a>


<a class="item" data-title="Ocean Connect" href="/docs/paas/user-guide/integrations/ocean-connect/"></a>


<a class="item" data-title="Custom Integration development guide" href="/docs/paas/user-guide/integrations/custom/"></a>


<a class="item" data-title="Notifications and Alarms on your smartphone using Telegram Bot" href="/docs/paas/user-guide/rule-engine-2-0/tutorials/integration-with-telegram-bot/"></a>
  </div>
</div>


<div class="item" data-title="Analytics">
  <div class="container">


<a class="item" data-title="Trendz Analytics" href="/docs/trendz/"></a>


<a class="item" data-title="Kafka Streams" href="/docs/paas/samples/analytics/kafka-streams/"></a>
  </div>
</div>


<div class="item" data-title="Other Features">
  <div class="container">


<a class="item" data-title="Device Connectivity Status" href="/docs/paas/user-guide/device-connectivity-status/"></a>


<a class="item" data-title="Claiming Devices" href="/docs/paas/user-guide/claiming-devices/"></a>


<a class="item" data-title="Device provisioning" href="/docs/paas/user-guide/device-provisioning/"></a>


<a class="item" data-title="Entity Views" href="/docs/paas/user-guide/entity-views/"></a>


<a class="item" data-title="API Limits" href="/docs/paas/user-guide/api-limits/"></a>


<a class="item" data-title="Bulk Provisioning" href="/docs/paas/user-guide/bulk-provisioning/"></a>


<a class="item" data-title="Entity Groups" href="/docs/paas/user-guide/groups/"></a>


<a class="item" data-title="Scheduler" href="/docs/paas/user-guide/scheduler/"></a>


<a class="item" data-title="Reporting" href="/docs/paas/user-guide/reporting/"></a>


<a class="item" data-title="CSV/XLS data export" href="/docs/paas/user-guide/csv-xls-data-export/"></a>


<a class="item" data-title="File Storage" href="/docs/paas/user-guide/file-storage/"></a>
  </div>
</div>


<div class="item" data-title="Security">
  <div class="container">


<a class="item" data-title="Audit Log" href="/docs/paas/user-guide/audit-log/"></a>


<a class="item" data-title="Advanced RBAC for IoT" href="/docs/paas/user-guide/rbac/"></a>


<a class="item" data-title="OAuth 2 Support" href="/docs/paas/user-guide/oauth-2-support/"></a>


<a class="item" data-title="MQTT over SSL" href="/docs/paas/user-guide/mqtt-over-ssl/"></a>


<a class="item" data-title="Device authentication options" href="/docs/paas/user-guide/device-credentials/"></a>


<a class="item" data-title="Access Token based authentication" href="/docs/paas/user-guide/access-token/"></a>


<a class="item" data-title="Basic MQTT Credentials" href="/docs/paas/user-guide/basic-mqtt/"></a>


<a class="item" data-title="X.509 Certificate based authentication" href="/docs/paas/user-guide/certificates/"></a>
  </div>
</div>


<div class="item" data-title="Administration UI">
  <div class="container">


<a class="item" data-title="Tenants" href="/docs/paas/user-guide/ui/tenants/"></a>


<a class="item" data-title="Customers" href="/docs/paas/user-guide/ui/customers/"></a>


<a class="item" data-title="Users" href="/docs/paas/user-guide/ui/users/"></a>


<a class="item" data-title="Assets" href="/docs/paas/user-guide/ui/assets/"></a>


<a class="item" data-title="Devices" href="/docs/paas/user-guide/ui/devices/"></a>


<a class="item" data-title="Rule Chains" href="/docs/paas/user-guide/ui/rule-chains/"></a>


<a class="item" data-title="Dashboards" href="/docs/paas/user-guide/ui/dashboards/"></a>


<div class="item" data-title="Widgets">
  <div class="container">


<a class="item" data-title="Trip Animation Widget" href="/docs/paas/user-guide/ui/trip-animation-widget/"></a>


<a class="item" data-title="Advanced Settings of the Entity Table widget" href="/docs/paas/user-guide/ui/entity-table-widget/"></a>


<a class="item" data-title="Advanced data key configuration" href="/docs/paas/user-guide/ui/advanced-data-key-configuration/"></a>
  </div>
</div>
  </div>
</div>


<a class="item" data-title="Subscriptions" href="/products/paas/subscription/"></a>


<a class="item" data-title="Plan and billing" href="/products/paas/billing-info/"></a>
        </div> <!-- /pi-accordion -->
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class=" hasTocContent">
      <div id="table-of-contents">
          
              <h4>On this page</h4>
          
      </div>
      <div id="top-spacer"></div>
      <h1>Provisioning devices</h1>
      <div id="content">
          
<ul id="markdown-toc">
  <li><a href="#use-case-description" id="markdown-toc-use-case-description">Use Case description</a></li>
  <li><a href="#how-it-works" id="markdown-toc-how-it-works">How it works?</a></li>
  <li><a href="#device-profile-configuration" id="markdown-toc-device-profile-configuration">Device profile configuration</a></li>
  <li><a href="#provision-device-apis" id="markdown-toc-provision-device-apis">Provision Device APIs</a>    <ul>
      <li><a href="#mqtt-device-apis" id="markdown-toc-mqtt-device-apis">MQTT Device APIs</a></li>
      <li><a href="#http-device-apis" id="markdown-toc-http-device-apis">HTTP Device APIs</a></li>
      <li><a href="#coap-device-apis" id="markdown-toc-coap-device-apis">CoAP Device APIs</a></li>
    </ul>
  </li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next steps</a></li>
</ul>

<h2 id="use-case-description">Use Case description</h2>

<p>As a device manufacturer or firmware developer, I would like my devices to automatically provision themselves in ThingsBoard.
During the automatic provisioning, the device may either generate unique credentials or ask the server to provide unique credentials for the device.</p>

<h2 id="how-it-works">How it works?</h2>

<object width="80%" data="/images/user-guide/device-provisioning/flow.svg"></object>

<p>The device may send a device provisioning request (Request) to the ThingsBoard. The Request should always contain a Provision key and secret. 
The Request may optionally include the device name and credentials generated by the device. 
If those credentials are absent, the Server will generate an Access Token to be used by the device.</p>

<p>Provisioning request example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"YOUR_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"YOUR_PROVISION_SECRET_HERE"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>The ThingsBoard validates the Request and replies with the device provisioning response (Response). 
The successful response contains device id, credentials type, and body. 
If the validation was not successful, the Response will contain only the status.</p>

<p>Provisioning response example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"provisionDeviceStatus"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">  
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"accessToken"</span><span class="p">:</span><span class="s2">"sLzc0gDAZPkGMzFVTyUY"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>During the validation of the Request, ThingsBoard will first check the supplied <em>provisionDeviceKey</em> and <em>provisionDeviceSecret</em> to find the corresponding <a href="/docs/paas/user-guide/device-profiles/">Device Profile</a>.
Once the profile is found, the platform will use the configured provision strategy to validate the device name. 
There are two provision strategies available:</p>

<ul>
  <li><strong>Allowing creating new devices</strong> - checks that the device with the same name has not registered in ThingsBoard yet. 
This strategy is useful when you don’t know the list of unique device names (MAC addresses, etc.) during manufacturing, but the device itself has access to this info in the firmware. 
It is easier to implement, but it is less secure than the second strategy.</li>
  <li><strong>Checking pre-provisioned devices</strong> - checks that the device with the same name has been already created in ThingsBoard, but hasn’t been provisioned yet.
This strategy is useful when you want to allow provisioning only for a specific list of devices. Let’s assume that you have collected a list of unique IDS (MAC addresses, etc) during the manufacturing. 
You can use <a href="/docs/paas/user-guide/bulk-provisioning/">bulk provisioning</a> to upload this list to ThingsBoard. Now, devices from the list can issue provision requests, and no other devices will be able to provision themselves.</li>
</ul>

<p>Once the provisioning is complete, ThingsBoard will update <em>provisionState</em> server attribute of the device and will set it to <em>provisioned</em> value.</p>

<h2 id="device-profile-configuration">Device profile configuration</h2>

<p>You should configure the device profile to enable provisioning feature, collect provision device key and provision device secret.</p>

<ul>
  <li>You can either create a new device profile or open the existing one. To create a new one you should open the Device profiles page and click on the "+" icon in the table header.</li>
  <li>Input a name of the new device profile and click on Step 4 of the "Add device profile" wizard. We will use name "Device Provisioning Test" in this example. However, typically this should be your device model or similar.</li>
  <li>Choose one of the provisioning strategies, copy the provisioning key and secret, and finally click "Add".</li>
</ul>

<div id="0">
  <div itemscope="" itemtype="http://schema.org/ImageGallery" class="images-gallery" style="justify-content: start;">
    <figure itemprop="associatedMedia" itemscope="" itemtype="http://schema.org/ImageObject" style="max-width: min(225px, 100%);
                    max-height: min(225px, 100%);" class="list-item">
<a href="/images/user-guide/device-provisioning/device-provisioning-step-1.png" onclick="return false;" itemprop="contentUrl"> <img src="/images/user-guide/device-provisioning/device-provisioning-step-1-preview.png" itemprop="thumbnail" alt="image" style="max-width: min(225px, 100%);
                                max-height: min(225px, 100%);" /> </a>       <figcaption itemprop="caption description" style="display: none">
You can either create a new device profile or open the existing one. To create a new one you should open the Device profiles page and click on the "+" icon in the table header.
      </figcaption>
    </figure>
    <figure itemprop="associatedMedia" itemscope="" itemtype="http://schema.org/ImageObject" style="max-width: min(225px, 100%);
                    max-height: min(225px, 100%);" class="list-item">
<a href="/images/user-guide/device-provisioning/device-provisioning-step-2.png" onclick="return false;" itemprop="contentUrl"> <img src="/images/user-guide/device-provisioning/device-provisioning-step-2-preview.png" itemprop="thumbnail" alt="image" style="max-width: min(225px, 100%);
                                max-height: min(225px, 100%);" /> </a>       <figcaption itemprop="caption description" style="display: none">
Input a name of the new device profile and click on Step 4 of the "Add device profile" wizard. We will use name "Device Provisioning Test" in this example. However, typically this should be your device model or similar.
      </figcaption>
    </figure>
    <figure itemprop="associatedMedia" itemscope="" itemtype="http://schema.org/ImageObject" style="max-width: min(225px, 100%);
                    max-height: min(225px, 100%);" class="list-item">
<a href="/images/user-guide/device-provisioning/device-provisioning-step-3.png" onclick="return false;" itemprop="contentUrl"> <img src="/images/user-guide/device-provisioning/device-provisioning-step-3-preview.png" itemprop="thumbnail" alt="image" style="max-width: min(225px, 100%);
                                max-height: min(225px, 100%);" /> </a>       <figcaption itemprop="caption description" style="display: none">
Choose one of the provisioning strategies, copy the provisioning key and secret, and finally click "Add".
      </figcaption>
    </figure>
  </div>
</div>

<script>
    window.addEventListener("load", function() {
        window.removeEventListener("load", arguments.callee, false);

        if(!document.getElementsByClassName('pswp').length){
            document.body.insertAdjacentHTML('beforeend',
                '<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n' +
                '        <div class="pswp__bg"></div>\n' +
                '        <div class="pswp__scroll-wrap">\n' +
                '            <div class="pswp__container">\n' +
                '                <div class="pswp__item"></div>\n' +
                '                <div class="pswp__item"></div>\n' +
                '                <div class="pswp__item"></div>\n' +
                '            </div>\n' +
                '\n' +
                '            <div class="pswp__ui pswp__ui--hidden">\n' +
                '\n' +
                '                <div class="pswp__top-bar">\n' +
                '                    <div class="pswp__counter"></div>\n' +
                '\n' +
                '                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n' +
                '\n' +
                '                    <button class="pswp__button pswp__button--share" title="Share"></button>\n' +
                '\n' +
                '                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n' +
                '\n' +
                '                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n' +
                '\n' +
                '                    <div class="pswp__preloader">\n' +
                '                        <div class="pswp__preloader__icn">\n' +
                '                            <div class="pswp__preloader__cut">\n' +
                '                                <div class="pswp__preloader__donut"></div>\n' +
                '                            </div>\n' +
                '                        </div>\n' +
                '                    </div>\n' +
                '                </div>\n' +
                '                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n' +
                '                    <div class="pswp__share-tooltip"></div>\n' +
                '                </div>\n' +
                '                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n' +
                '                </button>\n' +
                '                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n' +
                '                </button>\n' +
                '                <div class="pswp__caption">\n' +
                '                    <div class="pswp__caption__center"></div>\n' +
                '                </div>\n' +
                '            </div>\n' +
                '        </div>\n' +
                '    </div>'
            );
        }

        var container = document.getElementById('0');

        var initPhotoSwipeFromDOM = function(gallerySelector) {
            var parseThumbnailElements = function(el) {
                var thumbElements = el.childNodes,
                    numNodes = thumbElements.length,
                    items = [],
                    figureEl,
                    linkEl,
                    size,
                    item;

                for(var i = 0; i < numNodes; i++) {

                    figureEl = thumbElements[i];
                    if(figureEl.nodeType !== 1) {
                        continue;
                    }
                    linkEl = figureEl.children[0];
                    size = linkEl.children[0];
                    item = {
                        src: linkEl.getAttribute('href'),
                        w: 2500,
                        h: 0,
                        sizeLoaded: false
                    };

                    if(figureEl.children.length > 1) {
                        item.title = figureEl.children[1].innerHTML;
                    }
                    if(linkEl.children.length > 0) {
                        item.msrc = linkEl.children[0].getAttribute('src');
                    }
                    if(item.msrc === item.src){
                        item.w = parseInt(size.naturalWidth, 10);
                        item.h = parseInt(size.naturalHeight, 10);
                    }

                    item.el = figureEl;
                    items.push(item);
                }
                return items;
            };

            var closest = function closest(el, fn) {
                return el && ( fn(el) ? el : closest(el.parentNode, fn) );
            };

            var onThumbnailsClick = function(e) {
                e = e || window.event;
                e.preventDefault ? e.preventDefault() : e.returnValue = false;

                var eTarget = e.target || e.srcElement;

                var clickedListItem = closest(eTarget, function(el) {
                    return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
                });

                if(!clickedListItem) {
                    return;
                }

                var clickedGallery = clickedListItem.parentNode,
                    childNodes = clickedListItem.parentNode.childNodes,
                    numChildNodes = childNodes.length,
                    nodeIndex = 0,
                    index;

                for (var i = 0; i < numChildNodes; i++) {
                    if(childNodes[i].nodeType !== 1) {
                        continue;
                    }

                    if(childNodes[i] === clickedListItem) {
                        index = nodeIndex;
                        break;
                    }
                    nodeIndex++;
                }

                if(index >= 0) {
                    openPhotoSwipe( index, clickedGallery );
                }
                return false;
            };

            var photoswipeParseHash = function() {
                var hash = window.location.hash.substring(1),
                    params = {};

                if(hash.length < 5) {
                    return params;
                }

                var vars = hash.split('&');
                for (var i = 0; i < vars.length; i++) {
                    if(!vars[i]) {
                        continue;
                    }
                    var pair = vars[i].split('=');
                    if(pair.length < 2) {
                        continue;
                    }
                    params[pair[0]] = pair[1];
                }

                if(params.gid) {
                    params.gid = parseInt(params.gid, 10);
                }

                return params;
            };

            var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
                var pswpElement = document.querySelectorAll('.pswp')[0],
                    gallery,
                    options,
                    items;

                items = parseThumbnailElements(galleryElement);

                options = {
                    galleryUID: galleryElement.getAttribute('data-pswp-uid'),
                    getThumbBoundsFn: function(index) {
                        var thumbnail = items[index].el.getElementsByTagName('img')[0], // find thumbnail
                            pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
                            rect = thumbnail.getBoundingClientRect();
                        return {x:rect.left, y:rect.top + pageYScroll, w:rect.width};
                    },
                    bgOpacity: 0.8,
                    closeOnScroll: false,
                    shareEl: false,
                    fullscreenEl: false,
                    zoomEl: true,
                    history: false,
                    loop: false
                };

                if(fromURL) {
                    if(options.galleryPIDs) {
                        for(var j = 0; j < items.length; j++) {
                            if(items[j].pid == index) {
                                options.index = j;
                                break;
                            }
                        }
                    } else {
                        options.index = parseInt(index, 10) - 1;
                    }
                } else {
                    options.index = parseInt(index, 10);
                }

                if( isNaN(options.index) ) {
                    return;
                }

                if(disableAnimation) {
                    options.showAnimationDuration = 0;
                }

                gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options);

                gallery.listen('gettingData', function(index, item) {
                    if (!item.sizeLoaded) {
                        item.sizeLoaded = true;
                        var img = new Image();
                        img.onload = function() {
                            item.w = this.width;
                            item.h = this.height;
                            gallery.updateSize(true);
                        }
                        img.src = item.src;
                    }
                });

                gallery.init();

                var buttonLeft = pswpElement.getElementsByClassName('pswp__button--arrow--left')[0];
                var buttonRight = pswpElement.getElementsByClassName('pswp__button--arrow--right')[0];

                buttonLeft.hidden = gallery.getCurrentIndex() === 0;
                buttonRight.hidden = gallery.getCurrentIndex() + 1 === gallery.items.length;

                gallery.listen('beforeChange', function() {
                        buttonLeft.hidden = gallery.getCurrentIndex() === 0;
                        buttonRight.hidden = gallery.getCurrentIndex() + 1 === gallery.items.length;
                    }
                );
            };

            var galleryElements = container.querySelectorAll( gallerySelector );

            for(var i = 0, l = galleryElements.length; i < l; i++) {
                galleryElements[i].setAttribute('data-pswp-uid', i+1);
                galleryElements[i].onclick = onThumbnailsClick;
            }

            var hashData = photoswipeParseHash();
            if(hashData.pid && hashData.gid) {
                openPhotoSwipe( hashData.pid ,  galleryElements[ hashData.gid - 1 ], true, true );
            }
        };

        initPhotoSwipeFromDOM('.images-gallery');
    }, false)
</script>

<h2 id="provision-device-apis">Provision Device APIs</h2>

<h4 id="mqtt-device-apis">MQTT Device APIs</h4>

<p>You can use the <a href="/docs/paas/reference/mqtt-api/#device-provisioning">MQTT API</a> reference to develop your device firmware that will perform the provision request. <br />
As mentioned earlier, a device can request the server to generate the credentials or to provide its own credentials during the registration process.
See request/response and code examples for each option below:</p>

<div class="tb-content-toggle" id="mqttprovisioning">
  <div class="panel panel-default">
    <div class="panel-heading">
<a class="content-toggle-button" data-target="#without">
                <div class="content-toggle-button-text">
                    Credentials generated by the ThingsBoard server
                </div>
            </a> <a class="content-toggle-button" data-target="#access-token">
                <div class="content-toggle-button-text">
                    Devices supplies<br />Access Token
                </div>
            </a> <a class="content-toggle-button" data-target="#mqtt-basic">
                <div class="content-toggle-button-text">
                    Devices supplies<br />Basic MQTT Credentials
                </div>
            </a> <a class="content-toggle-button" data-target="#x509-certificate">
                <div class="content-toggle-button-text">
                    Devices supplies<br />X.509 Certificate
                </div>
            </a>
    </div>
    <div id="without" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="s2">"sLzc0gDAZPkGMzFVTyUY"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 class="no_toc" id="sample-script">Sample script</h4>

<p>To communicate with ThingsBoard we will use Paho MQTT module, so we should install it:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip3 <span class="nb">install </span>paho-mqtt <span class="nt">--user</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code is available below. You may copy-paste it to a file, for example:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now you should run the script and follow the steps inside.<br />
You may launch the script using python 3:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python3 device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code:</p>

<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
</pre></td><td class="rouge-code"><pre>
<span class="kn">from</span> <span class="nn">paho.mqtt.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>

<span class="n">RESULT_CODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">"incorrect protocol version"</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">"invalid client identifier"</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">"server unavailable"</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">"bad username or password"</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">"not authorised"</span><span class="p">,</span>
    <span class="p">}</span>



<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning with basic authorization example script.</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mhost</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mport</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (1883): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">1883</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="k">class</span> <span class="nc">ProvisionClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    <span class="n">PROVISION_REQUEST_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/request"</span>
    <span class="n">PROVISION_RESPONSE_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/response"</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_username</span> <span class="o">=</span> <span class="s">"provision"</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_connect</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_message</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span> <span class="o">=</span> <span class="n">provision_request</span>

    <span class="k">def</span> <span class="nf">__on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect
</span>        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connected to ThingsBoard "</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_RESPONSE_TOPIC</span><span class="p">)</span>  <span class="c1"># Subscribe to provisioning response topic
</span>            <span class="n">provision_request</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Sending provisioning request %s"</span> <span class="o">%</span> <span class="n">provision_request</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_REQUEST_TOPIC</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">)</span>  <span class="c1"># Publishing provisioning request topic
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">payload</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"UTF-8"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Received data from ThingsBoard: %s"</span> <span class="o">%</span> <span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">decoded_message</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">provision_device_status</span> <span class="o">=</span> <span class="n">decoded_message</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"status"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">provision_device_status</span> <span class="o">==</span> <span class="s">"SUCCESS"</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">__save_credentials</span><span class="p">(</span><span class="n">decoded_message</span><span class="p">[</span><span class="s">"credentialsValue"</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Provisioning was unsuccessful with status %s and message: %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">provision_device_status</span><span class="p">,</span> <span class="n">decoded_message</span><span class="p">[</span><span class="s">"errorMsg"</span><span class="p">]))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">provision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connecting to ThingsBoard (provisioning client)"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__clean_credentials</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_host</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_port</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_new_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client_credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__get_credentials</span><span class="p">()</span>
        <span class="n">new_client</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">client_credentials</span><span class="p">:</span>
            <span class="n">new_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
            <span class="n">new_client</span><span class="p">.</span><span class="n">username_pw_set</span><span class="p">(</span><span class="n">client_credentials</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Read credentials from file."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot read credentials from file!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_client</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_credentials</span><span class="p">():</span>
        <span class="n">new_credentials</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
                <span class="n">new_credentials</span> <span class="o">=</span> <span class="n">credentials_file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_credentials</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__save_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
            <span class="n">credentials_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__clean_credentials</span><span class="p">():</span>
        <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">on_tb_connected</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect with received credentials
</span>    <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Connected to ThingsBoard with credentials: %s"</span> <span class="o">%</span> <span class="n">client</span><span class="p">.</span><span class="n">_username</span><span class="p">.</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>  <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>  <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">provision_client</span> <span class="o">=</span> <span class="n">ProvisionClient</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="n">PROVISION_REQUEST</span><span class="p">)</span>
    <span class="n">provision_client</span><span class="p">.</span><span class="n">provision</span><span class="p">()</span>  <span class="c1"># Request provisioned data
</span>    <span class="n">tb_client</span> <span class="o">=</span> <span class="n">provision_client</span><span class="p">.</span><span class="n">get_new_client</span><span class="p">()</span>  <span class="c1"># Getting client with provisioned data
</span>    <span class="k">if</span> <span class="n">tb_client</span><span class="p">:</span>
        <span class="n">tb_client</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_tb_connected</span>  <span class="c1"># Setting callback for connect
</span>        <span class="n">tb_client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">tb_client</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>  <span class="c1"># Starting infinity loop
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Client was not created!"</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
    <div id="access-token" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left">credentialsType</td>
      <td style="text-align: left"><strong>ACCESS_TOKEN</strong></td>
      <td>Credentials type parameter.</td>
    </tr>
    <tr>
      <td style="text-align: left">token</td>
      <td style="text-align: left"><strong>DEVICE_ACCESS_TOKEN</strong></td>
      <td>Access token for device in ThingsBoard.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_ACCESS_TOKEN"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="s2">"DEVICE_ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 class="no_toc" id="sample-script">Sample script</h4>

<p>To communicate with ThingsBoard we will use Paho MQTT module, so we should install it:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip3 <span class="nb">install </span>paho-mqtt <span class="nt">--user</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code is available below. You may copy-paste it to a file, for example:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now you should run the script and follow the steps inside.<br />
You may launch the script using python 3:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python3 device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code:</p>

<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
</pre></td><td class="rouge-code"><pre>
<span class="kn">from</span> <span class="nn">paho.mqtt.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>

<span class="n">RESULT_CODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">"incorrect protocol version"</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">"invalid client identifier"</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">"server unavailable"</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">"bad username or password"</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">"not authorised"</span><span class="p">,</span>
    <span class="p">}</span>



<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning with access token authorization example script. MQTT API</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mhost</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mport</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (1883): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">1883</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"token"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice access token</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="k">class</span> <span class="nc">ProvisionClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    <span class="n">PROVISION_REQUEST_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/request"</span>
    <span class="n">PROVISION_RESPONSE_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/response"</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_username</span> <span class="o">=</span> <span class="s">"provision"</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_connect</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_message</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span> <span class="o">=</span> <span class="n">provision_request</span>

    <span class="k">def</span> <span class="nf">__on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect
</span>        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connected to ThingsBoard "</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_RESPONSE_TOPIC</span><span class="p">)</span>  <span class="c1"># Subscribe to provisioning response topic
</span>            <span class="n">provision_request</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Sending provisioning request %s"</span> <span class="o">%</span> <span class="n">provision_request</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_REQUEST_TOPIC</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">)</span>  <span class="c1"># Publishing provisioning request topic
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">payload</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"UTF-8"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Received data from ThingsBoard: %s"</span> <span class="o">%</span> <span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">decoded_message</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">provision_device_status</span> <span class="o">=</span> <span class="n">decoded_message</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"status"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">provision_device_status</span> <span class="o">==</span> <span class="s">"SUCCESS"</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">__save_credentials</span><span class="p">(</span><span class="n">decoded_message</span><span class="p">[</span><span class="s">"credentialsValue"</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Provisioning was unsuccessful with status %s and message: %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">provision_device_status</span><span class="p">,</span> <span class="n">decoded_message</span><span class="p">[</span><span class="s">"errorMsg"</span><span class="p">]))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">provision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connecting to ThingsBoard (provisioning client)"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__clean_credentials</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_host</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_port</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_new_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client_credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__get_credentials</span><span class="p">()</span>
        <span class="n">new_client</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">client_credentials</span><span class="p">:</span>
            <span class="n">new_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
            <span class="n">new_client</span><span class="p">.</span><span class="n">username_pw_set</span><span class="p">(</span><span class="n">client_credentials</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Read credentials from file."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot read credentials from file!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_client</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_credentials</span><span class="p">():</span>
        <span class="n">new_credentials</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
                <span class="n">new_credentials</span> <span class="o">=</span> <span class="n">credentials_file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_credentials</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__save_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
            <span class="n">credentials_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__clean_credentials</span><span class="p">():</span>
        <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">on_tb_connected</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect with received credentials
</span>    <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Connected to ThingsBoard with credentials: %s"</span> <span class="o">%</span> <span class="n">client</span><span class="p">.</span><span class="n">_username</span><span class="p">.</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>  <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>  <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="s">"credentialsType"</span><span class="p">:</span> <span class="s">"ACCESS_TOKEN"</span><span class="p">,</span>
                         <span class="s">"token"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"token"</span><span class="p">],</span>
                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">provision_client</span> <span class="o">=</span> <span class="n">ProvisionClient</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="n">PROVISION_REQUEST</span><span class="p">)</span>
    <span class="n">provision_client</span><span class="p">.</span><span class="n">provision</span><span class="p">()</span>  <span class="c1"># Request provisioned data
</span>    <span class="n">tb_client</span> <span class="o">=</span> <span class="n">provision_client</span><span class="p">.</span><span class="n">get_new_client</span><span class="p">()</span>  <span class="c1"># Getting client with provisioned data
</span>    <span class="k">if</span> <span class="n">tb_client</span><span class="p">:</span>
        <span class="n">tb_client</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_tb_connected</span>  <span class="c1"># Setting callback for connect
</span>        <span class="n">tb_client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">tb_client</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>  <span class="c1"># Starting infinity loop
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Client was not created!"</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
    <div id="mqtt-basic" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left">credentialsType</td>
      <td style="text-align: left"><strong>MQTT_BASIC</strong></td>
      <td>Credentials type parameter.</td>
    </tr>
    <tr>
      <td style="text-align: left">username</td>
      <td style="text-align: left"><strong>DEVICE_USERNAME_HERE</strong></td>
      <td>Username for device in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left">password</td>
      <td style="text-align: left"><strong>DEVICE_PASSWORD_HERE</strong></td>
      <td>Password for device in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left">clientId</td>
      <td style="text-align: left"><strong>DEVICE_CLIENT_ID_HERE</strong></td>
      <td>Client id for device in ThingsBoard.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MQTT_BASIC"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_USERNAME_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_PASSWORD_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"clientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_CLIENT_ID_HERE"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"MQTT_BASIC"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"clientId"</span><span class="p">:</span><span class="s2">"DEVICE_CLIENT_ID_HERE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userName"</span><span class="p">:</span><span class="s2">"DEVICE_USERNAME_HERE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"DEVICE_PASSWORD_HERE"</span><span class="w">
    </span><span class="p">},</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 class="no_toc" id="sample-script">Sample script</h4>

<p>To communicate with ThingsBoard we will use Paho MQTT module, so we should install it:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip3 <span class="nb">install </span>paho-mqtt <span class="nt">--user</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code is available below. You may copy-paste it to a file, for example:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now you should run the script and follow the steps inside.<br />
You may launch the script using python 3:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python3 device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code:</p>

<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre></td><td class="rouge-code"><pre>
<span class="kn">from</span> <span class="nn">paho.mqtt.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>

<span class="n">RESULT_CODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">"incorrect protocol version"</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">"invalid client identifier"</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">"server unavailable"</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">"bad username or password"</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">"not authorised"</span><span class="p">,</span>
    <span class="p">}</span>



<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning with basic authorization example script.</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mhost</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mport</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (1883): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">1883</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"clientId"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mclient Id</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93musername</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"password"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mpassword</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="k">class</span> <span class="nc">ProvisionClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    <span class="n">PROVISION_REQUEST_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/request"</span>
    <span class="n">PROVISION_RESPONSE_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/response"</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_username</span> <span class="o">=</span> <span class="s">"provision"</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_connect</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_message</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span> <span class="o">=</span> <span class="n">provision_request</span>

    <span class="k">def</span> <span class="nf">__on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect
</span>        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connected to ThingsBoard "</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_RESPONSE_TOPIC</span><span class="p">)</span>  <span class="c1"># Subscribe to provisioning response topic
</span>            <span class="n">provision_request</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Sending provisioning request %s"</span> <span class="o">%</span> <span class="n">provision_request</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_REQUEST_TOPIC</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">)</span>  <span class="c1"># Publishing provisioning request topic
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">payload</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"UTF-8"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Received data from ThingsBoard: %s"</span> <span class="o">%</span> <span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">decoded_message</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">provision_device_status</span> <span class="o">=</span> <span class="n">decoded_message</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"status"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">provision_device_status</span> <span class="o">==</span> <span class="s">"SUCCESS"</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">__save_credentials</span><span class="p">(</span><span class="n">decoded_message</span><span class="p">[</span><span class="s">"credentialsValue"</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Provisioning was unsuccessful with status %s and message: %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">provision_device_status</span><span class="p">,</span> <span class="n">decoded_message</span><span class="p">[</span><span class="s">"errorMsg"</span><span class="p">]))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">provision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connecting to ThingsBoard (provisioning client)"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__clean_credentials</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_host</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_port</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_new_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client_credentials</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__get_credentials</span><span class="p">())</span>
        <span class="n">new_client</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">client_credentials</span><span class="p">:</span>
            <span class="n">new_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">client_credentials</span><span class="p">[</span><span class="s">"clientId"</span><span class="p">])</span>  <span class="c1"># Setting client id
</span>            <span class="n">new_client</span><span class="p">.</span><span class="n">username_pw_set</span><span class="p">(</span><span class="n">client_credentials</span><span class="p">[</span><span class="s">"userName"</span><span class="p">],</span> <span class="n">client_credentials</span><span class="p">[</span><span class="s">"password"</span><span class="p">])</span>  <span class="c1"># Setting username and password for ThingsBoard client
</span>            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Read credentials from file."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot read credentials from file!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_client</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_credentials</span><span class="p">():</span>
        <span class="n">new_credentials</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
                <span class="n">new_credentials</span> <span class="o">=</span> <span class="n">credentials_file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_credentials</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__save_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
            <span class="n">credentials_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">credentials</span><span class="p">))</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__clean_credentials</span><span class="p">():</span>
        <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">on_tb_connected</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect with received credentials
</span>    <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Connected to ThingsBoard with credentials: username: %s, password: %s, client id: %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">_username</span><span class="p">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">client</span><span class="p">.</span><span class="n">_password</span><span class="p">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">client</span><span class="p">.</span><span class="n">_client_id</span><span class="p">.</span><span class="n">decode</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>
                         <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>
                         <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="s">"credentialsType"</span><span class="p">:</span> <span class="s">"MQTT_BASIC"</span><span class="p">,</span>
                         <span class="s">"username"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"username"</span><span class="p">],</span>
                         <span class="s">"password"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"password"</span><span class="p">],</span>
                         <span class="s">"clientId"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"clientId"</span><span class="p">],</span>
                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">provision_client</span> <span class="o">=</span> <span class="n">ProvisionClient</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="n">PROVISION_REQUEST</span><span class="p">)</span>
    <span class="n">provision_client</span><span class="p">.</span><span class="n">provision</span><span class="p">()</span>  <span class="c1"># Request provisioned data
</span>    <span class="n">tb_client</span> <span class="o">=</span> <span class="n">provision_client</span><span class="p">.</span><span class="n">get_new_client</span><span class="p">()</span>  <span class="c1"># Getting client with provisioned data
</span>    <span class="k">if</span> <span class="n">tb_client</span><span class="p">:</span>
        <span class="n">tb_client</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_tb_connected</span>  <span class="c1"># Setting callback for connect
</span>        <span class="n">tb_client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">tb_client</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>  <span class="c1"># Starting infinity loop
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Client was not created!"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
    <div id="x509-certificate" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<div class="info-banner">
<img src="/images/doc-info-icon.svg" />   <div>
    <p><strong>INFO: To use this feature, you should configure <a href="/docs/paas/user-guide/mqtt-over-ssl/">MQTT over SSL in ThingsBoard</a></strong></p>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left">credentialsType</td>
      <td style="text-align: left"><strong>X509_CERTIFICATE</strong></td>
      <td>Credentials type parameter.</td>
    </tr>
    <tr>
      <td style="text-align: left">hash</td>
      <td style="text-align: left"><strong>MIIB……..AQAB</strong></td>
      <td>Public key X509 hash for device in ThingsBoard.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"X509_CERTIFICATE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"hash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MIIB........AQAB"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceId"</span><span class="p">:</span><span class="s2">"3b829220-232f-11eb-9d5c-e9ed3235dff8"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"X509_CERTIFICATE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsId"</span><span class="p">:</span><span class="s2">"f307a1f717a12b32c27203cf77728d305d29f64694a8311be921070dd1259b3a"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="s2">"MIIB........AQAB"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceStatus"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 class="no_toc" id="mqtt-example-script">MQTT Example script</h3>

<p>To use this script put your <strong>mqttserver.pub.pem</strong> (public key of the server) into the folder with script.</p>

<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
</pre></td><td class="rouge-code"><pre>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">cryptography</span> <span class="kn">import</span> <span class="n">x509</span>
<span class="kn">from</span> <span class="nn">cryptography.x509.oid</span> <span class="kn">import</span> <span class="n">NameOID</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">hashes</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.backends</span> <span class="kn">import</span> <span class="n">default_backend</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">serialization</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.asymmetric</span> <span class="kn">import</span> <span class="n">rsa</span>
<span class="kn">from</span> <span class="nn">paho.mqtt.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>

<span class="n">RESULT_CODES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">"incorrect protocol version"</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">"invalid client identifier"</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">"server unavailable"</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">"bad username or password"</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">"not authorised"</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning with X509 certificate authorization example script. MQTT API</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mhost</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mSSL port</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (8883): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">8883</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>

<span class="k">def</span> <span class="nf">generate_certs</span><span class="p">(</span><span class="n">ca_certfile</span><span class="o">=</span><span class="s">"mqttserver.pub.pem"</span><span class="p">):</span>
    <span class="n">root_cert</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ca_certfile</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">ca_file</span><span class="p">:</span>
            <span class="n">root_cert</span> <span class="o">=</span> <span class="n">x509</span><span class="p">.</span><span class="n">load_pem_x509_certificate</span><span class="p">(</span><span class="nb">str</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">ca_file</span><span class="p">.</span><span class="n">read</span><span class="p">()),</span> <span class="n">default_backend</span><span class="p">())</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Failed to load CA certificate: %r"</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">root_cert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">private_key</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">.</span><span class="n">generate_private_key</span><span class="p">(</span>
            <span class="n">public_exponent</span><span class="o">=</span><span class="mi">65537</span><span class="p">,</span> <span class="n">key_size</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="n">new_subject</span> <span class="o">=</span> <span class="n">x509</span><span class="p">.</span><span class="n">Name</span><span class="p">([</span>
        <span class="n">x509</span><span class="p">.</span><span class="n">NameAttribute</span><span class="p">(</span><span class="n">NameOID</span><span class="p">.</span><span class="n">COMMON_NAME</span><span class="p">,</span> <span class="s">"localhost"</span><span class="p">)</span>
    <span class="p">])</span>
        <span class="n">certificate</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">x509</span><span class="p">.</span><span class="n">CertificateBuilder</span><span class="p">()</span>
            <span class="p">.</span><span class="n">subject_name</span><span class="p">(</span><span class="n">new_subject</span><span class="p">)</span>
            <span class="p">.</span><span class="n">issuer_name</span><span class="p">(</span><span class="n">new_subject</span><span class="p">)</span>
            <span class="p">.</span><span class="n">public_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">.</span><span class="n">public_key</span><span class="p">())</span>
            <span class="p">.</span><span class="n">serial_number</span><span class="p">(</span><span class="n">x509</span><span class="p">.</span><span class="n">random_serial_number</span><span class="p">())</span>
            <span class="p">.</span><span class="n">not_valid_before</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">utcnow</span><span class="p">())</span>
            <span class="p">.</span><span class="n">not_valid_after</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span>
            <span class="p">.</span><span class="n">add_extension</span><span class="p">(</span><span class="n">x509</span><span class="p">.</span><span class="n">BasicConstraints</span><span class="p">(</span><span class="n">ca</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">path_length</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span> <span class="n">critical</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">private_key</span><span class="o">=</span><span class="n">private_key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="p">.</span><span class="n">SHA256</span><span class="p">(),</span> <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">())</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"cert.pem"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">cert_file</span><span class="p">:</span>
            <span class="n">cert_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">certificate</span><span class="p">.</span><span class="n">public_bytes</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">serialization</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">PEM</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"key.pem"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">key_file</span><span class="p">:</span>
            <span class="n">key_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">private_key</span><span class="p">.</span><span class="n">private_bytes</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">serialization</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">PEM</span><span class="p">,</span>
                                                     <span class="nb">format</span><span class="o">=</span><span class="n">serialization</span><span class="p">.</span><span class="n">PrivateFormat</span><span class="p">.</span><span class="n">TraditionalOpenSSL</span><span class="p">,</span>
                                                     <span class="n">encryption_algorithm</span><span class="o">=</span><span class="n">serialization</span><span class="p">.</span><span class="n">NoEncryption</span><span class="p">(),</span>
                                                <span class="p">))</span>


<span class="k">def</span> <span class="nf">read_cert</span><span class="p">():</span>
    <span class="n">cert</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">key</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"cert.pem"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">cert_file</span><span class="p">:</span>
            <span class="n">cert</span> <span class="o">=</span> <span class="n">cert_file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"key.pem"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">key_file</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key_file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Cannot read certificate with error: %r"</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cert</span><span class="p">,</span> <span class="n">key</span>


<span class="k">class</span> <span class="nc">ProvisionClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    <span class="n">PROVISION_REQUEST_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/request"</span>
    <span class="n">PROVISION_RESPONSE_TOPIC</span> <span class="o">=</span> <span class="s">"/provision/response"</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_username</span> <span class="o">=</span> <span class="s">"provision"</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tls_set</span><span class="p">(</span><span class="n">ca_certs</span><span class="o">=</span><span class="s">"mqttserver.pub.pem"</span><span class="p">,</span> <span class="n">tls_version</span><span class="o">=</span><span class="n">ssl</span><span class="p">.</span><span class="n">PROTOCOL_TLSv1_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_connect</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__on_message</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span> <span class="o">=</span> <span class="n">provision_request</span>

    <span class="k">def</span> <span class="nf">__on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect
</span>        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connected to ThingsBoard "</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_RESPONSE_TOPIC</span><span class="p">)</span>  <span class="c1"># Subscribe to provisioning response topic
</span>            <span class="n">provision_request</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__provision_request</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Sending provisioning request %s"</span> <span class="o">%</span> <span class="n">provision_request</span><span class="p">)</span>
            <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">PROVISION_REQUEST_TOPIC</span><span class="p">,</span> <span class="n">provision_request</span><span class="p">)</span>  <span class="c1"># Publishing provisioning request topic
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__on_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">payload</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"UTF-8"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Received data from ThingsBoard: %s"</span> <span class="o">%</span> <span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">decoded_message</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">decoded_payload</span><span class="p">)</span>
        <span class="n">provision_device_status</span> <span class="o">=</span> <span class="n">decoded_message</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"status"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">provision_device_status</span> <span class="o">==</span> <span class="s">"SUCCESS"</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">decoded_message</span><span class="p">[</span><span class="s">"credentialsValue"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cert</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"-----BEGIN CERTIFICATE-----</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>\
                                                          <span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"-----END CERTIFICATE-----</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>\
                                                          <span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Provisioning success! Certificates are saved."</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">__save_credentials</span><span class="p">(</span><span class="n">cert</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Returned certificate is not equal to sent one."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Provisioning was unsuccessful with status %s and message: %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">provision_device_status</span><span class="p">,</span> <span class="n">decoded_message</span><span class="p">[</span><span class="s">"errorMsg"</span><span class="p">]))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">provision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Connecting to ThingsBoard (provisioning client)"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__clean_credentials</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_host</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_port</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_new_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">client_credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__get_credentials</span><span class="p">()</span>
        <span class="n">new_client</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">client_credentials</span><span class="p">:</span>
            <span class="n">new_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
            <span class="n">new_client</span><span class="p">.</span><span class="n">tls_set</span><span class="p">(</span><span class="n">ca_certs</span><span class="o">=</span><span class="s">"mqttserver.pub.pem"</span><span class="p">,</span> <span class="n">certfile</span><span class="o">=</span><span class="s">"cert.pem"</span><span class="p">,</span> <span class="n">keyfile</span><span class="o">=</span><span class="s">"key.pem"</span><span class="p">,</span> <span class="n">cert_reqs</span><span class="o">=</span><span class="n">ssl</span><span class="p">.</span><span class="n">CERT_REQUIRED</span><span class="p">,</span>
                               <span class="n">tls_version</span><span class="o">=</span><span class="n">ssl</span><span class="p">.</span><span class="n">PROTOCOL_TLSv1_2</span><span class="p">,</span> <span class="n">ciphers</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            <span class="n">new_client</span><span class="p">.</span><span class="n">tls_insecure_set</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Read credentials from file."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[Provisioning client] Cannot read credentials from file!"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_client</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_credentials</span><span class="p">():</span>
        <span class="n">new_credentials</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
                <span class="n">new_credentials</span> <span class="o">=</span> <span class="n">credentials_file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_credentials</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__save_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">credentials_file</span><span class="p">:</span>
            <span class="n">credentials_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">__clean_credentials</span><span class="p">():</span>
        <span class="nb">open</span><span class="p">(</span><span class="s">"credentials"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">on_tb_connected</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>  <span class="c1"># Callback for connect with received credentials
</span>    <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Connected to ThingsBoard with credentials: username: %s, password: %s, client id: %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">_username</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">_password</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">_client_id</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[ThingsBoard client] Cannot connect to ThingsBoard!, result: %s"</span> <span class="o">%</span> <span class="n">RESULT_CODES</span><span class="p">[</span><span class="n">rc</span><span class="p">])</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>  <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>  <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="s">"credentialsType"</span><span class="p">:</span> <span class="s">"X509_CERTIFICATE"</span><span class="p">,</span>
                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">generate_certs</span><span class="p">()</span>  <span class="c1"># Generate certificate and key
</span>    <span class="n">cert</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">read_cert</span><span class="p">()</span>  <span class="c1"># Read certificate and key
</span>    <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"hash"</span><span class="p">]</span> <span class="o">=</span> <span class="n">cert</span>
    <span class="k">if</span> <span class="n">PROVISION_REQUEST</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"hash"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">provision_client</span> <span class="o">=</span> <span class="n">ProvisionClient</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="n">PROVISION_REQUEST</span><span class="p">)</span>
        <span class="n">provision_client</span><span class="p">.</span><span class="n">provision</span><span class="p">()</span>  <span class="c1"># Request provisioned data
</span>        <span class="n">tb_client</span> <span class="o">=</span> <span class="n">provision_client</span><span class="p">.</span><span class="n">get_new_client</span><span class="p">()</span>  <span class="c1"># Getting client with provisioned data
</span>        <span class="k">if</span> <span class="n">tb_client</span><span class="p">:</span>
            <span class="n">tb_client</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_tb_connected</span>  <span class="c1"># Setting callback for connect
</span>            <span class="n">tb_client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">tb_client</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>  <span class="c1"># Starting infinity loop
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Client was not created!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Cannot read certificate."</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
  </div>
</div>

<script>
    jqueryUiDefer(initContentTogglemqttprovisioning);
    function initContentTogglemqttprovisioning() {
        $(function(){

            window.addEventListener('popstate', onPopStatemqttprovisioning);

            onPopStatemqttprovisioning();

            $('.tb-content-toggle#mqttprovisioning a.content-toggle-button').click(function(event) {
                event.preventDefault();
                var id = $(this).attr("data-target").substring(1);
                var param = 'mqttprovisioning';
                var params = Qs.parse(window.location.search, { ignoreQueryPrefix: true });
                params[param] = id;

                var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?' + Qs.stringify(params);
                if (window.location.hash) {
                    newurl += window.location.hash;
                }
                window.history.pushState({ path: newurl }, '', newurl);
                selectTargetmqttprovisioning(id);
            });
        });
    }

    function onPopStatemqttprovisioning() {
        var params = Qs.parse(window.location.search, { ignoreQueryPrefix: true });
        var targetId = params['mqttprovisioning'];
        if (!targetId) {
            targetId = 'without';
        }
        selectTargetmqttprovisioning(targetId);
    }

    function selectTargetmqttprovisioning(targetId) {
        $(".tb-content-toggle#mqttprovisioning a.content-toggle-button").removeClass("active");
        $(".tb-content-toggle#mqttprovisioning a.content-toggle-button[data-target='#"+targetId+"']").addClass("active");
        $('.tb-content-toggle#mqttprovisioning .panel-collapse').removeClass("show");
        $('.tb-content-toggle#mqttprovisioning .panel-collapse#'+targetId).addClass("show");
    }

</script>

<h4 id="http-device-apis">HTTP Device APIs</h4>

<p>You may use the <a href="/docs/paas/reference/http-api/#device-provisioning">HTTP API</a> reference to develop your device firmware that will perform the provision request. <br />
As mentioned earlier, the device may request server to generate the credentials or provide its own credentials during the registration process.
See request/response and code examples for each option below:</p>

<div class="tb-content-toggle" id="httpprovisioning">
  <div class="panel panel-default">
    <div class="panel-heading">
<a class="content-toggle-button" data-target="#without">
                <div class="content-toggle-button-text">
                    Credentials generated by ThingsBoard server
                </div>
            </a> <a class="content-toggle-button" data-target="#access-token">
                <div class="content-toggle-button-text">
                    Devices supplies<br />Access Token
                </div>
            </a>
    </div>
    <div id="without" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="s2">"sLzc0gDAZPkGMzFVTyUY"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 class="no_toc" id="sample-script">Sample script</h4>

<p>The script source code is available below. You may copy-paste it to a file, for example:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now you should run the script and follow the steps inside.<br />
You may launch the script using python 3:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python3 device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code:</p>
<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="rouge-code"><pre>

<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">post</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span>


<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning without authorization example script. HTTP API</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mhost</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (https://thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"https://thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mHTTP port</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (80): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">80</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="c1"># Example for message to ThingsBoard
</span><span class="n">to_publish</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"stringKey"</span><span class="p">:</span> <span class="s">"value1"</span><span class="p">,</span>
  <span class="s">"booleanKey"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
  <span class="s">"doubleKey"</span><span class="p">:</span> <span class="mf">42.0</span><span class="p">,</span>
  <span class="s">"longKey"</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span>
  <span class="s">"jsonKey"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">"someNumber"</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s">"someArray"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s">"someNestedObject"</span><span class="p">:</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"value"</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>  <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>  <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="s">"%s:%i/api/v1/provision"</span> <span class="o">%</span> <span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">),</span> <span class="n">json</span><span class="o">=</span><span class="n">PROVISION_REQUEST</span><span class="p">)</span>
    <span class="n">decoded_response</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Received response: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">)</span>
    <span class="n">received_token</span> <span class="o">=</span> <span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"credentialsValue"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">received_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="s">'%s:%i/api/v1/%s/telemetry'</span> <span class="o">%</span> <span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="n">received_token</span><span class="p">,),</span> <span class="n">dumps</span><span class="p">(</span><span class="n">to_publish</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[THINGSBOARD CLIENT] Response code from Thingsboard."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get access token from response."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"errorMsg"</span><span class="p">))</span>


</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
    <div id="access-token" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left">credentialsType</td>
      <td style="text-align: left"><strong>ACCESS_TOKEN</strong></td>
      <td>Credentials type parameter.</td>
    </tr>
    <tr>
      <td style="text-align: left">token</td>
      <td style="text-align: left"><strong>DEVICE_ACCESS_TOKEN</strong></td>
      <td>Access token for device in ThingsBoard.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_ACCESS_TOKEN"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="s2">"DEVICE_ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 class="no_toc" id="sample-script">Sample script</h4>

<p>The script source code is available below. You may copy-paste it to a file, for example:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now you should run the script and follow the steps inside.<br />
You may launch the script using python 3:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python3 device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code:</p>
<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="rouge-code"><pre>

<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">post</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span>


<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning with access token authorization example script. HTTP API</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93murl</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (https://thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"https://thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mHTTP port</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (80): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">80</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"token"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice access token</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="c1"># Example for message to ThingsBoard
</span><span class="n">to_publish</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"stringKey"</span><span class="p">:</span> <span class="s">"value1"</span><span class="p">,</span>
  <span class="s">"booleanKey"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
  <span class="s">"doubleKey"</span><span class="p">:</span> <span class="mf">42.0</span><span class="p">,</span>
  <span class="s">"longKey"</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span>
  <span class="s">"jsonKey"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">"someNumber"</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s">"someArray"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s">"someNestedObject"</span><span class="p">:</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"value"</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>  <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>  <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="s">"credentialsType"</span><span class="p">:</span> <span class="s">"ACCESS_TOKEN"</span><span class="p">,</span>
                         <span class="s">"token"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"token"</span><span class="p">],</span>
                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="s">"%s:%i/api/v1/provision"</span> <span class="o">%</span> <span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">),</span> <span class="n">json</span><span class="o">=</span><span class="n">PROVISION_REQUEST</span><span class="p">)</span>
    <span class="n">decoded_response</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Received response: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">)</span>
    <span class="n">received_token</span> <span class="o">=</span> <span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"credentialsValue"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">received_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="s">'%s:%i/api/v1/%s/telemetry'</span> <span class="o">%</span> <span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">,</span> <span class="n">received_token</span><span class="p">,),</span> <span class="n">dumps</span><span class="p">(</span><span class="n">to_publish</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[THINGSBOARD CLIENT] Response code from Thingsboard."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get access token from response."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"errorMsg"</span><span class="p">))</span>


</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
  </div>
</div>

<script>
    jqueryUiDefer(initContentTogglehttpprovisioning);
    function initContentTogglehttpprovisioning() {
        $(function(){

            window.addEventListener('popstate', onPopStatehttpprovisioning);

            onPopStatehttpprovisioning();

            $('.tb-content-toggle#httpprovisioning a.content-toggle-button').click(function(event) {
                event.preventDefault();
                var id = $(this).attr("data-target").substring(1);
                var param = 'httpprovisioning';
                var params = Qs.parse(window.location.search, { ignoreQueryPrefix: true });
                params[param] = id;

                var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?' + Qs.stringify(params);
                if (window.location.hash) {
                    newurl += window.location.hash;
                }
                window.history.pushState({ path: newurl }, '', newurl);
                selectTargethttpprovisioning(id);
            });
        });
    }

    function onPopStatehttpprovisioning() {
        var params = Qs.parse(window.location.search, { ignoreQueryPrefix: true });
        var targetId = params['httpprovisioning'];
        if (!targetId) {
            targetId = 'without';
        }
        selectTargethttpprovisioning(targetId);
    }

    function selectTargethttpprovisioning(targetId) {
        $(".tb-content-toggle#httpprovisioning a.content-toggle-button").removeClass("active");
        $(".tb-content-toggle#httpprovisioning a.content-toggle-button[data-target='#"+targetId+"']").addClass("active");
        $('.tb-content-toggle#httpprovisioning .panel-collapse').removeClass("show");
        $('.tb-content-toggle#httpprovisioning .panel-collapse#'+targetId).addClass("show");
    }

</script>

<h4 id="coap-device-apis">CoAP Device APIs</h4>

<p>You may use the <a href="/docs/paas/reference/coap-api/#device-provisioning">CoAP API</a> reference to develop your device firmware that will perform the provision request. <br />
As mentioned earlier, the device may request server to generate the credentials or provide its own credentials during the registration process.
See request/response and code examples for each option below:</p>

<div class="tb-content-toggle" id="coapprovisioning">
  <div class="panel panel-default">
    <div class="panel-heading">
<a class="content-toggle-button" data-target="#without">
                <div class="content-toggle-button-text">
                    Credentials generated by ThingsBoard server
                </div>
            </a> <a class="content-toggle-button" data-target="#access-token">
                <div class="content-toggle-button-text">
                    Devices supplies<br />Access Token
                </div>
            </a>
    </div>
    <div id="without" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="s2">"sLzc0gDAZPkGMzFVTyUY"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 class="no_toc" id="sample-script">Sample script</h4>

<p>To communicate with ThingsBoard we will use CoAPthon3 module, so we should install it:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip3 <span class="nb">install </span>coapthon3 <span class="nt">--user</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code is available below. You may copy-paste it to a file, for example:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now you should run the script and follow the steps inside.<br />
You may launch the script using python 3:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python3 device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code:</p>

<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td><td class="rouge-code"><pre>
<span class="kn">from</span> <span class="nn">coapthon.client.helperclient</span> <span class="kn">import</span> <span class="n">HelperClient</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">loads</span><span class="p">,</span> <span class="n">dumps</span>


<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning without authorization example script. CoAP API</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mhost</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mCoAP port</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (5683): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">5683</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="c1"># Example for message to ThingsBoard
</span><span class="n">to_publish</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"stringKey"</span><span class="p">:</span> <span class="s">"value1"</span><span class="p">,</span>
  <span class="s">"booleanKey"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
  <span class="s">"doubleKey"</span><span class="p">:</span> <span class="mf">42.0</span><span class="p">,</span>
  <span class="s">"longKey"</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span>
  <span class="s">"jsonKey"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">"someNumber"</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s">"someArray"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s">"someNestedObject"</span><span class="p">:</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"value"</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>  <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>  <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">HelperClient</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">))</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/api/v1/provision'</span><span class="p">,</span> <span class="n">dumps</span><span class="p">(</span><span class="n">PROVISION_REQUEST</span><span class="p">))</span>
    <span class="n">client</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">decoded_response</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Received response: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">)</span>
    <span class="n">received_token</span> <span class="o">=</span> <span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"credentialsValue"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">received_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">thingsboardClient</span> <span class="o">=</span> <span class="n">HelperClient</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">thingsboardClient</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/api/v1/%s/telemetry'</span> <span class="o">%</span> <span class="p">(</span><span class="n">received_token</span><span class="p">,),</span> <span class="n">dumps</span><span class="p">(</span><span class="n">to_publish</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[THINGSBOARD CLIENT] Response from Thingsboard."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">thingsboardClient</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get access token from response."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"errorMsg"</span><span class="p">))</span>

</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
    <div id="access-token" class="panel-collapse collapse">
      <div class="panel-body">
        <table><tr><td>
<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>Parameter</strong></th>
      <th style="text-align: left"><strong>Example value</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><em>deviceName</em></td>
      <td style="text-align: left"><strong>DEVICE_NAME</strong></td>
      <td>Device name in ThingsBoard.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceKey</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_KEY_HERE</strong></td>
      <td>Provisioning device key, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left"><em>provisionDeviceSecret</em></td>
      <td style="text-align: left"><strong>PUT_PROVISION_SECRET_HERE</strong></td>
      <td>Provisioning device secret, you should take it from configured device profile.</td>
    </tr>
    <tr>
      <td style="text-align: left">credentialsType</td>
      <td style="text-align: left"><strong>ACCESS_TOKEN</strong></td>
      <td>Credentials type parameter.</td>
    </tr>
    <tr>
      <td style="text-align: left">token</td>
      <td style="text-align: left"><strong>DEVICE_ACCESS_TOKEN</strong></td>
      <td>Access token for device in ThingsBoard.</td>
    </tr>
  </tbody>
</table>

<p>Provisioning request data example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"deviceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_NAME"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_KEY_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"provisionDeviceSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUT_PROVISION_SECRET_HERE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEVICE_ACCESS_TOKEN"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Provisioning response example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"credentialsType"</span><span class="p">:</span><span class="s2">"ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"credentialsValue"</span><span class="p">:</span><span class="s2">"DEVICE_ACCESS_TOKEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"SUCCESS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 class="no_toc" id="sample-script">Sample script</h4>

<p>To communicate with ThingsBoard we will use CoAPthon3 module, so we should install it:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip3 <span class="nb">install </span>coapthon3 <span class="nt">--user</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code is available below. You may copy-paste it to a file, for example:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now you should run the script and follow the steps inside.<br />
You may launch the script using python 3:</p>

<div class="language-bash copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python3 device-provision-example.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The script source code:</p>

<div class="language-python copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre></td><td class="rouge-code"><pre>
<span class="kn">from</span> <span class="nn">coapthon.client.helperclient</span> <span class="kn">import</span> <span class="n">HelperClient</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">loads</span><span class="p">,</span> <span class="n">dumps</span>


<span class="k">def</span> <span class="nf">collect_required_data</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">" "</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="s">"</span><span class="se">\033</span><span class="s">[1m</span><span class="se">\033</span><span class="s">[94mThingsBoard device provisioning with access token authorization example script. CoAP API</span><span class="se">\033</span><span class="s">[0m"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mhost</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (thingsboard.cloud): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="k">else</span> <span class="s">"thingsboard.cloud"</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write your ThingsBoard </span><span class="se">\033</span><span class="s">[93mCoAP port</span><span class="se">\033</span><span class="s">[0m or leave it blank to use default (5683): "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">port</span> <span class="k">else</span> <span class="mi">5683</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device key</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mprovision device secret</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">"token"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice access token</span><span class="se">\033</span><span class="s">[0m: "</span><span class="p">)</span>
    <span class="n">device_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please write </span><span class="se">\033</span><span class="s">[93mdevice name</span><span class="se">\033</span><span class="s">[0m or leave it blank to generate: "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device_name</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"="</span><span class="o">*</span><span class="mi">80</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="c1"># Example for message to ThingsBoard
</span><span class="n">to_publish</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"stringKey"</span><span class="p">:</span> <span class="s">"value1"</span><span class="p">,</span>
  <span class="s">"booleanKey"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
  <span class="s">"doubleKey"</span><span class="p">:</span> <span class="mf">42.0</span><span class="p">,</span>
  <span class="s">"longKey"</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span>
  <span class="s">"jsonKey"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">"someNumber"</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s">"someArray"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s">"someNestedObject"</span><span class="p">:</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"value"</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">collect_required_data</span><span class="p">()</span>

    <span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"host"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance host
</span>    <span class="n">THINGSBOARD_PORT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"port"</span><span class="p">]</span>  <span class="c1"># ThingsBoard instance MQTT port
</span>
    <span class="n">PROVISION_REQUEST</span> <span class="o">=</span> <span class="p">{</span><span class="s">"provisionDeviceKey"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_key"</span><span class="p">],</span>  <span class="c1"># Provision device key, replace this value with your value from device profile.
</span>                         <span class="s">"provisionDeviceSecret"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"provision_device_secret"</span><span class="p">],</span>  <span class="c1"># Provision device secret, replace this value with your value from device profile.
</span>                         <span class="s">"credentialsType"</span><span class="p">:</span> <span class="s">"ACCESS_TOKEN"</span><span class="p">,</span>
                         <span class="s">"token"</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s">"token"</span><span class="p">],</span>
                         <span class="p">}</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"device_name"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">PROVISION_REQUEST</span><span class="p">[</span><span class="s">"deviceName"</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">"device_name"</span><span class="p">]</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">HelperClient</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">))</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/api/v1/provision'</span><span class="p">,</span> <span class="n">dumps</span><span class="p">(</span><span class="n">PROVISION_REQUEST</span><span class="p">))</span>
    <span class="n">client</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">decoded_response</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Received response: "</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">)</span>
    <span class="n">received_token</span> <span class="o">=</span> <span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"credentialsValue"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">received_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">thingsboardClient</span> <span class="o">=</span> <span class="n">HelperClient</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="n">THINGSBOARD_PORT</span><span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">thingsboardClient</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'/api/v1/%s/telemetry'</span> <span class="o">%</span> <span class="p">(</span><span class="n">received_token</span><span class="p">,),</span> <span class="n">dumps</span><span class="p">(</span><span class="n">to_publish</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[THINGSBOARD CLIENT] Response from Thingsboard."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">thingsboardClient</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get access token from response."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">decoded_response</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"errorMsg"</span><span class="p">))</span>

</pre></td></tr></tbody></table></code></pre></div></div>

</td></tr></table>
      </div>
    </div>
  </div>
</div>

<script>
    jqueryUiDefer(initContentTogglecoapprovisioning);
    function initContentTogglecoapprovisioning() {
        $(function(){

            window.addEventListener('popstate', onPopStatecoapprovisioning);

            onPopStatecoapprovisioning();

            $('.tb-content-toggle#coapprovisioning a.content-toggle-button').click(function(event) {
                event.preventDefault();
                var id = $(this).attr("data-target").substring(1);
                var param = 'coapprovisioning';
                var params = Qs.parse(window.location.search, { ignoreQueryPrefix: true });
                params[param] = id;

                var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?' + Qs.stringify(params);
                if (window.location.hash) {
                    newurl += window.location.hash;
                }
                window.history.pushState({ path: newurl }, '', newurl);
                selectTargetcoapprovisioning(id);
            });
        });
    }

    function onPopStatecoapprovisioning() {
        var params = Qs.parse(window.location.search, { ignoreQueryPrefix: true });
        var targetId = params['coapprovisioning'];
        if (!targetId) {
            targetId = 'without';
        }
        selectTargetcoapprovisioning(targetId);
    }

    function selectTargetcoapprovisioning(targetId) {
        $(".tb-content-toggle#coapprovisioning a.content-toggle-button").removeClass("active");
        $(".tb-content-toggle#coapprovisioning a.content-toggle-button[data-target='#"+targetId+"']").addClass("active");
        $('.tb-content-toggle#coapprovisioning .panel-collapse').removeClass("show");
        $('.tb-content-toggle#coapprovisioning .panel-collapse#'+targetId).addClass("show");
    }

</script>

<h2 id="next-steps">Next steps</h2>

<ul>
  <li>
    <p><a href="/docs/paas/guides#AnchorIDGettingStartedGuides">Getting started guides</a> - These guides provide quick overview of main ThingsBoard features. Designed to be completed in 15-30 minutes.</p>
  </li>
  <li>
    <p><a href="/docs/paas/guides#AnchorIDConnectYourDevice">Connect your device</a> - Learn how to connect devices based on your connectivity technology or solution.</p>
  </li>
  <li>
    <p><a href="/docs/paas/guides#AnchorIDDataVisualization">Data visualization</a> - These guides contain instructions how to configure complex ThingsBoard dashboards.</p>
  </li>
  <li>
    <p><a href="/docs/paas/guides#AnchorIDDataProcessing">Data processing &amp; actions</a> - Learn how to use ThingsBoard Rule Engine.</p>
  </li>
  <li>
    <p><a href="/docs/paas/guides#AnchorIDDataAnalytics">IoT Data analytics</a> - Learn how to use rule engine to perform basic analytics tasks.</p>
  </li>
  <li>
    <p><a href="/docs/paas/guides#AnchorIDHardwareSamples">Hardware samples</a> - Learn how to connect various hardware platforms to ThingsBoard.</p>
  </li>
</ul>

<p><br /></p>


      </div>
      <footer>
	<main class="light-text">
		<div class="newsletterSubsContainer">
            <script type="text/javascript">
                function subscribeForNewsletter(event) {
                    event.stopPropagation();
                    var script_tag = document.createElement('script');
                    script_tag.setAttribute("type", "text/javascript");
                    script_tag.setAttribute("src", "https://static.mailerlite.com/js/w/webforms.min.js?v28bf44f740701752bfc6767bc7e171d4");
                    document.getElementsByTagName("head")[0].appendChild(script_tag);
                    $(event.target).css('display', 'none');
                    $('#mlb2-7341216').css('display', 'block');
                }
            </script>
            <button class="n-button price subscribe" onClick="subscribeForNewsletter(event)">Sign up for ThingsBoard news</button>
            <div id="mlb2-7341216" class="ml-subscribe-form ml-subscribe-form-7341216" style="display: none;">
<!--            <div id="mlb2-7341216" class="ml-subscribe-form ml-subscribe-form-7341216" style="display: block;">-->
                <div class="ml-vertical-align-center">
                    <div class="subscribe-form ml-block-success" style="display: none;">
                        <div class="form-section">
                            <p>Thank you for your interest in ThingsBoard!<br/>Have a great day!</p>
                        </div>
                    </div>
                    <form class="ml-block-form" action="https://static.mailerlite.com/webforms/submit/r9r9x7" data-id="708170" data-code="r9r9x7" method="POST" target="_blank">
                        <div class="subscribe-form horizontal">
                            <div class="form-section horizontal">
                                <div class="form-group ml-field-email ml-validate-required ml-validate-email">
                                    <input type="email" name="fields[email]" class="form-control" placeholder="Email address*" value="" autocomplete="email" x-autocompletetype="email" spellcheck="false" autocapitalize="off" autocorrect="off">
                                </div>
                            </div>
                            <input type="hidden" name="ml-submit" value="1">
                            <div class="form-section horizontal ml-button-position">
                                <button class="primary n-button price subscribe" type="submit">
                                    Subscribe
                                </button>
                                <button disabled="disabled" style="display: none;" type="button" class="n-button loading">
                                    <img src="https://static.mailerlite.com/images/rolling@2x.gif" width="20" height="20" style="width: 20px; height: 20px;">
                                </button>
                            </div>
                            <p>By subscribing you agree to receive newsletters from ThingsBoard, Inc.</p>
                        </div>
                    </form>
                </div>
            </div>
		</div>

        <hr>

        <div class="deeper">
            <a href="/" class="footer-logo"></a>
            <nav>
                <a href="/docs/getting-started-guides/helloworld/">Get Started</a>
                <a href="/docs/">Documentation</a>
                <a href="/iot-use-cases/">Use cases</a>
                <a href="https://blog.thingsboard.io/">Blog</a>
                <a href="/docs/services/">Services</a>
                <a href="/docs/contact-us/">Contact us</a>
            </nav>
        </div>

        <div class="deepmost">
            <div class="copyright">&copy; 2021 The ThingsBoard Authors</div>
            <div class="social">
                <a href="https://github.com/thingsboard/thingsboard" class="github"></a>
                <a href="https://gitter.im/thingsboard/chat" class="gitter"></a>
                <a href="https://www.youtube.com/thingsboard" class="youtube"></a>
                <a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"></a>
                <a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"></a>
                <a href="https://www.facebook.com/thingsboard" class="facebook"></a>
                <a href="https://twitter.com/thingsboard" class="twitter"></a>
            </div>
        </div>
	</main>
</footer>

  </div>
</section>

<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
<script>
    jqueryDefer(function () {
        $(document).on('selectionchange',function() {
        // $(document).mouseup(function () {
            $('.clipboard-btn').removeClass('noChars');
            var selectedChars = getSelectedText();
            // $('#numberChars').html(selectedChars.length);
            if (selectedChars == 0) {
                $('.clipboard-btn').addClass('noChars');
            }
        });
    });
    function getSelectedText() {
        var text;
        if (window.getSelection) {
            text = window.getSelection().toString();
        } else if (document.getSelection) {
            text = document.getSelection();
        } else if (document.selection) {
            text = document.selection.createRange().text;
        }
        return text;
    }
</script>
<script>
    jqueryDefer(function () {
        $(document).ready(function () {
            var allCodeBlocksElements = $(".copy-code");
            allCodeBlocksElements.each(function (i) {
                var codeBlock = $(this);
                if (!codeBlock.hasClass('highlighter-rouge')) {
                    codeBlock = codeBlock.find('.highlighter-rouge');
                }
                codeBlock.each(function () {
                    var block = codeBlock.find('pre.highlight > code .rouge-code');
                    var currentId = "codeblock" + (i + 1);
                    block.attr('id', currentId);
                    var clipButton = $('<button class="clipboard-btn" data-clipboard-target="#' + currentId + '"><p>Copy to clipboard</p><div><img src="/images/copy-code-icon.svg" alt="Copy to clipboard"></div></button>');
                    $(this).append(clipButton);
                    var troyan = codeBlock.find('pre.highlight');
                    var Tooltip = $('<div class="customTooltip"><div class="tooltipText">Copied!</div></div>');
                    troyan.append(Tooltip);
                    troyan.addClass('clipboard-btn');
                    troyan.attr('data-clipboard-target', "#" + currentId);
                    troyan.on('mouseleave', clearTooltip);
                    troyan.on('blur', clearTooltip);
                    troyan.on('click', function(e) {
                        var el = $(e.currentTarget);
                        if (el.hasClass('showTool')) {
                            clearTooltip(e);
                            troyan.attr('data-skip-tooltip', "true");
                        }
                    });
                });
            });

            var clipboard = new Clipboard('.noChars');
            clipboard.on('success', function (e) {
                $('.clipboard-btn').removeClass('noChars');
                e.clearSelection();
                var trigger = e.trigger;
                if (!$(trigger).attr('data-skip-tooltip')) {
                    showTooltip(e.trigger, 'Copied!');
                } else {
                    $(trigger).removeAttr('data-skip-tooltip');
                }
            });

            $('#search').focus(
                function(){
                    $(this).parent('#searchBox').addClass('focused');
                }).blur(
                function(){
                    $(this).parent('#searchBox').removeClass('focused');
                });

            $('#searchBox .searchButton').click(function () {
                var value = $('#search').val();
                window.location.replace('/docs/paas/search/?q=' + value);
            });

            $('#docsBreadcrumbs').click(function () {
                if ($(this).hasClass('active')) {
                    $(this).removeClass('active');
                    $('#docsNav').removeClass('active');
                    $('#searchBox').removeClass('visible');
                } else {
                    $(this).addClass('active');
                    $('#docsNav').addClass('active');
                    $('#searchBox').addClass('visible');
                }
            });
        });

        function clearTooltip(e) {
            var el = $(e.currentTarget);
            el.removeClass('showTool');
            el.attr('aria-label', null);
        }

        function showTooltip(elem, msg) {
            var el = $(elem);
            el.addClass('showTool');
            el.attr('aria-label', msg);
        }
    });
</script>

<script>
    jqueryDefer(function () {
        var markdownTocs = null;
        var contentAnchors = [];
        var activeAnchor = null;
        var firstAnchor = null;
        var lastAnchor = null;

        function updatePositions() {
            contentAnchors = [];
            markdownTocs.each(function (i) {
                var tocAnchor = $(this).children('a');
                var href = tocAnchor.attr('href');
                var contentAnchor = $('div#content ' + href);
                var top = Math.floor(contentAnchor.offset().top);
                var bottom;
                if (i < markdownTocs.length - 1) {
                    var nextHref = $(markdownTocs[i + 1]).children('a').attr('href');
                    var nextContentAnchor = $('div#content ' + nextHref);
                    bottom = Math.floor(nextContentAnchor.offset().top);
                } else {
                    bottom = $('div#content').offset().top + $('div#content').innerHeight();
                }
                var contentAnchorInfo = {anchor: contentAnchor, toc: $(this), top: top, bottom: bottom, href: href};
                contentAnchors.push(contentAnchorInfo);
                if (i === 0) {
                    firstAnchor = contentAnchorInfo;
                }
                if (i === markdownTocs.length - 1) {
                    lastAnchor = contentAnchorInfo;
                }
            });
        }

        function findActiveContentToc() {
            var top = $(window).scrollTop();
            var bottom = top + $(window).height();
            if (bottom === $('#encyclopedia').offset().top + $('#encyclopedia').innerHeight()) {
                return lastAnchor;
            } else {
                bottom -= 154;
                for (var i = 0; i < contentAnchors.length; i++) {
                    var contentAnchor = contentAnchors[i];
                    if (contentAnchor.top <= bottom &&
                        contentAnchor.bottom > top) {
                        return contentAnchor;
                    }
                }
            }
            return firstAnchor;
        }

        function updateActiveToc(init) {
            updatePositions();
            var newActiveAnchor = findActiveContentToc();
            if (!activeAnchor || newActiveAnchor.href !== activeAnchor.href) {
                activeAnchor = newActiveAnchor;
                markdownTocs.removeClass('active');
                activeAnchor.toc.addClass('active');
                var tocTop = $('#table-of-contents').scrollTop() + 100;
                var tocBottom = tocTop + $('#table-of-contents').innerHeight() - 200;
                var activeTocTop = activeAnchor.toc.position().top;
                var activeTocBottom = activeTocTop + activeAnchor.toc.children(':first').height();
                if (tocTop > activeTocTop) {
                    activeAnchor.toc[0].scrollIntoView();
                    $('#table-of-contents')[0].scrollTop -= 100;
                } else if (tocBottom < activeTocBottom) {
                    activeAnchor.toc[0].scrollIntoView();
                    $('#table-of-contents')[0].scrollTop += init ? -100 : 100;
                }
            }
        }
        $( document ).ready(function() {
            var tocs = $('#content > ul#markdown-toc');
            var tableOfContents = $('#table-of-contents');
            tableOfContents.append(tocs);
            markdownTocs = $('#table-of-contents ul#markdown-toc li').filter(function() {
                var tocAnchor = $(this).children('a');
                var href = tocAnchor.attr('href');
                if (!href.startsWith('#')) {
                    return false;
                } else {
                    var contentAnchor = $('div#content ' + href);
                    return contentAnchor.length > 0;
                }
            });
            updateActiveToc(true);
        });

        $(document).on("scroll", function() {
            updateActiveToc(false);
        });

    });
</script>

</body>
</html>

