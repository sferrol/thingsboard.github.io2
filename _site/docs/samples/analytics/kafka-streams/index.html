







<!Doctype html>
<html id="docs" class="ThingsBoard Documentation">







<head>
    <meta charset="utf-8">
    <meta name="cf-2fa-verify" content="a08672380de15e9">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>IoT data analytics using Kafka, Kafka Streams and ThingsBoard | ThingsBoard Community Edition</title>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="IoT data analytics using Kafka, Kafka Streams and ThingsBoard" />
<meta name="author" content="thingsboard" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="IoT device data analytics sample using Kafka, Kafka Streams and ThingsBoard" />
<meta property="og:description" content="IoT device data analytics sample using Kafka, Kafka Streams and ThingsBoard" />
<link rel="canonical" href="http://0.0.0.0:4002/docs/samples/analytics/kafka-streams/" />
<meta property="og:url" content="http://0.0.0.0:4002/docs/samples/analytics/kafka-streams/" />
<meta property="og:site_name" content="ThingsBoard" />
<meta property="og:image" content="http://0.0.0.0:4002/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://0.0.0.0:4002/images/thingsboard_logo.png" />
<meta property="twitter:title" content="IoT data analytics using Kafka, Kafka Streams and ThingsBoard" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
{"url":"http://0.0.0.0:4002/docs/samples/analytics/kafka-streams/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4002/images/thingsboard_logo.png"},"name":"thingsboard"},"author":{"@type":"Person","name":"thingsboard"},"image":{"twitter":"/images/thingsboard_logo.png","facebook":"/images/thingsboard_logo.png","url":"http://0.0.0.0:4002/images/thingsboard_logo.png","@type":"imageObject"},"description":"IoT device data analytics sample using Kafka, Kafka Streams and ThingsBoard","@type":"WebPage","headline":"IoT data analytics using Kafka, Kafka Streams and ThingsBoard","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
    
    <meta name="twitter:description" content="IoT device data analytics sample using Kafka, Kafka Streams and ThingsBoard"/>
    
    
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.7.0/qs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gifffer/1.5.0/gifffer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            Gifffer();
        }
    </script>
    <script type="text/javascript">
        /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
        !function (a) {
            "use strict";
            var b = function (b, c, d) {
                function e(a) {
                    return h.body ? a() : void setTimeout(function () {
                        e(a)
                    })
                }

                function f() {
                    i.addEventListener && i.removeEventListener("load", f), i.media = d || "all"
                }

                var g, h = a.document, i = h.createElement("link");
                if (c) g = c; else {
                    var j = (h.body || h.getElementsByTagName("head")[0]).childNodes;
                    g = j[j.length - 1]
                }
                var k = h.styleSheets;
                i.rel = "stylesheet", i.href = b, i.media = "only x", e(function () {
                    g.parentNode.insertBefore(i, c ? g : g.nextSibling)
                });
                var l = function (a) {
                    for (var b = i.href, c = k.length; c--;) if (k[c].href === b) return a();
                    setTimeout(function () {
                        l(a)
                    })
                };
                return i.addEventListener && i.addEventListener("load", f), i.onloadcssdefined = l, l(f), i
            };
            "undefined" != typeof exports ? exports.loadCSS = b : a.loadCSS = b
        }("undefined" != typeof global ? global : this);

        /*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
        function onloadCSS(a, b) {
            function c() {
                !d && b && (d = !0, b.call(a))
            }

            var d;
            a.addEventListener && a.addEventListener("load", c), a.attachEvent && a.attachEvent("onload", c), "isApplicationInstalled" in navigator && "onloadcssdefined" in a && a.onloadcssdefined(c)
        }
    </script>
    <script type="text/javascript">

        function jqueryDefer(method) {
            if (window.jQuery) {
                method();
            } else {
                setTimeout(function () {
                    jqueryDefer(method)
                }, 50);
            }
        }

        function jqueryUiDefer(method) {
            if (window.jQuery && window.jQuery.ui) {
                method();
            } else {
                setTimeout(function () {
                    jqueryUiDefer(method)
                }, 50);
            }
        }

        window.vis = (function () {
            var stateKey,
                eventKey,
                keys = {
                    hidden: "visibilitychange",
                    webkitHidden: "webkitvisibilitychange",
                    mozHidden: "mozvisibilitychange",
                    msHidden: "msvisibilitychange"
                };
            for (stateKey in keys) {
                if (stateKey in document) {
                    eventKey = keys[stateKey];
                    break;
                }
            }
            return function (c) {
                if (c) document.addEventListener(eventKey, c);
                return !document[stateKey];
            }
        })();

        function loadScript(src, callback) {
            var s, r, t;
            r = false;
            s = document.createElement('script');
            s.type = 'text/javascript';
            s.src = src;
            s.onload = s.onreadystatechange = function () {
                if (!r && (!this.readyState || this.readyState == 'complete')) {
                    r = true;
                    if (callback) {
                        callback();
                    }
                }
            };
            t = document.getElementsByTagName('script')[0];
            t.parentNode.insertBefore(s, t);
        }

        function loadCssAsync(src, callback) {
            var stylesheet = loadCSS(src);
            if (callback) {
                onloadCSS(stylesheet, callback);
            }
        }

        function loadNextScript(index, scriptsList, completeCallback) {
            if (index < scriptsList.length) {
                var script = scriptsList[index];
                if (script.type === 'script') {
                    loadScript(script.src, function () {
                        if (script.callback) {
                            script.callback();
                        }
                        index++;
                        loadNextScript(index, scriptsList, completeCallback);
                    });
                } else if (script.type === 'css') {
                    loadCssAsync(script.src, function () {
                        index++;
                        loadNextScript(index, scriptsList, completeCallback);
                    });
                }
            } else if (completeCallback) {
                completeCallback();
            }
        }

        var initialScriptsList = [
            {src: '/js/jquery-2.2.0.min.js', type: 'script'},
            {src: '/css/jquery-ui.min.css', type: 'css'},
            {src: '/js/jquery-ui.min.js', type: 'script'},
            {src: '/js/jquery.vide.js', type: 'script'},
            {src: '/js/script.js', type: 'script'},
            {src: '/css/photoswipe.css', type: 'css'},
            {src: '/css/default-skin/default-skin.css', type: 'css'},
            {src: '/js/photoswipe.min.js', type: 'script'},
            {src: '/js/photoswipe-ui-default.min.js', type: 'script'}
        ];

        loadNextScript(0, initialScriptsList);

        jqueryDefer(function () {
            (function ($, win) {
                $.fn.inViewport = function (cb) {
                    return this.each(function (i, el) {
                        function visPx() {
                            var H = $(this).height(),
                                r = el.getBoundingClientRect(), t = r.top, b = r.bottom;
                            var result = cb.call(el, Math.max(0, t > 0 ? H - t : (b < H ? b : H)));
                            if (result) {
                                $(win).off("resize scroll", visPx);
                            }
                        }

                        visPx();
                        $(win).on("resize scroll", visPx);
                    });
                };
            }(jQuery, window));
        });

        function inViewportDefer(method) {
            if (window.jQuery && $.fn.inViewport) {
                method();
            } else {
                setTimeout(function () {
                    inViewportDefer(method)
                }, 50);
            }
        }

    </script>
    <script type="text/javascript">
        function _gaLt(event) {
            /* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
            if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
                return;
            }
            var el = event.srcElement || event.target;

            while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
                el = el.parentNode;
            }
            if (el && el.href) {
                var link = el.href;
                if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
                    var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
                    if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
                        target = "_blank";
                    }

                    var hbrun = false; // tracker has not yet run
                    var hitBack = function () {
                        if (hbrun) return;
                        hbrun = true;
                        window.location.href = link;
                    };

                    if (target) {
                        ga(
                            "send", "event", "Outgoing Links", link,
                            document.location.pathname + document.location.search
                        );
                    } else {
                        event.preventDefault ? event.preventDefault() : event.returnValue = !1;
                        ga(
                            "send", "event", "Outgoing Links", link,
                            document.location.pathname + document.location.search, {
                                "hitCallback": hitBack
                            }
                        );

                        setTimeout(hitBack, 1000);
                    }
                }
            }
        }

        var _w = window;
        var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
        _w.addEventListener ? _w.addEventListener("load", function () {
                document.body.addEventListener(_gaLtEvt, _gaLt, !1)
            }, !1)
            : _w.attachEvent && _w.attachEvent("onload", function () {
            document.body.attachEvent("on" + _gaLtEvt, _gaLt)
        });
    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-88383331-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script>
        function Burger() {
            var header = $('header');
            var body = $('body');
            if (header.hasClass('opened-burger')) {
                header.removeClass('opened-burger');
                let subMenus = $('nav.head-menu > ul > li > div.centered-sub > ul.sub-menu');
                subMenus.removeClass('open-sub');
                body.css('overflow', '');
            } else {
                header.addClass('opened-burger');
                body.css('overflow', 'hidden');
            }
        }
    </script>
    <script>

        jqueryDefer(function () {
            let menuElement = $('nav.head-menu > ul');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            let menuItems = $('nav.head-menu > ul > li');
            let indicator = $('nav.head-menu > ul > div.indicator');
            let subMenuActive = false;
            menuElement.on('mouseleave', function (event) {
                if (!$(event.relatedTarget).parents('div.sub-menu-container').length) {
                    subMenuActive = false;
                    submenuContainer.removeClass('active bounds-transition');
                    menuItems.removeClass('active');
                    indicator.removeClass('left-transition');
                }
            });
            submenuContainer.on('mouseleave', function (event) {
                if (!$(event.relatedTarget).parents('nav.head-menu > ul').length) {
                    subMenuActive = false;
                    submenuContainer.removeClass('active bounds-transition');
                    menuItems.removeClass('active');
                    indicator.removeClass('left-transition');
                }
            });
            menuItems.each(function() {
                let item = $( this );
                let subMenuId = item.attr('data-submenu-id');
                item.on('mouseenter', function () {
                    let submenus = $('nav.head-menu > div.sub-menu-container > div');
                    submenus.css('display', 'none');
                    menuItems.removeClass('active');
                    item.addClass('active');
                    let targetSubMenu = $('nav.head-menu > div.sub-menu-container > div#'+subMenuId);
                    targetSubMenu.css('display', 'block');
                    submenuContainer.css('overflow', 'visible');
                    let left = item.position().left + (item.outerWidth() - targetSubMenu.outerWidth()) / 2;
                    submenuContainer.css('left', left + 'px');
                    if (!subMenuActive) {
                        submenuContainer.addClass('active');
                        subMenuActive = true;
                    } else {
                        submenuContainer.addClass('bounds-transition');
                        indicator.addClass('left-transition');
                    }
                    indicator.css('left', item.position().left);
                    indicator.css('width', item.outerWidth());
                    submenuContainer.css('height', targetSubMenu.outerHeight() + 'px');
                    submenuContainer.css('width', targetSubMenu.outerWidth() + 'px');
                    submenuContainer.css('overflow', 'hidden');
                });
            });

            let isMobile = $('button.burger').css('display') === 'block';
            if (isMobile) {
                initMobileSubmenu();
            }

            $(window).resize(function(){
                let newIsMobile = $('button.burger').css('display') === 'block';
                if (isMobile !== newIsMobile) {
                    isMobile = newIsMobile;
                    if (isMobile) {
                        initMobileSubmenu();
                    } else {
                        restoreDesktopSubmenu();
                    }
                }
            });

            // Products selector

            
            let productsSelector = $('.products-selector');
            $(window).click(function(e) {
                if (productsSelector[0].contains(e.target)) {
                    if (productsSelector.hasClass('active')) {
                        productsSelector.removeClass('active');
                    } else {
                        productsSelector.addClass('active');
                    }
                } else {
                    productsSelector.removeClass('active');
                }
            });
            

            // Rogue line numbers fix (don't show line numbers for 1 row)
            $( document ).ready(function() {
                $('.rouge-gutter.gl').each(function() {
                    var lineNumbers = $(this).children('.lineno');
                    if (lineNumbers.text() === '1\n') {
                        $(this).css('display', 'none');
                    }
                });
            });
        });

        function initMobileSubmenu() {

            var header = $('header');
            if (header.hasClass('opened-burger')) {
                var body = $('body');
                body.css('overflow', 'hidden');
            }

            let targetSubMenus = $('nav.head-menu > div.sub-menu-container > div');
            targetSubMenus.css('display', 'block');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            submenuContainer.removeClass('active');
            submenuContainer.css('display', 'none');

            targetSubMenus.each(function() {
                let subMenu = $( this );
                let subMenuId = subMenu.attr('id');
                let parent = $('nav.head-menu > ul > li.'+subMenuId);
                parent.append(subMenu);
            });
        }

        function restoreDesktopSubmenu() {
            var body = $('body');
            body.css('overflow', '');
            let targetSubMenus = $('nav.head-menu > ul > li > div');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            submenuContainer.removeClass('active');
            submenuContainer.css('display', 'block');
            let menuItems = $('nav.head-menu > ul > li');
            menuItems.removeClass('active');
            targetSubMenus.each(function() {
                let subMenu = $( this );
                submenuContainer.append(subMenu);
            });
        }

        function listburg(subMenuId) {
            let isMobile = $('button.burger').css('display') === 'block';
            if (isMobile) {
                let targetSubMenu = $('nav.head-menu > ul > li > div.centered-sub#'+subMenuId+' > ul.sub-menu');
                let isOpen = targetSubMenu.hasClass('open-sub');
                let subMenus = $('nav.head-menu > ul > li > div.centered-sub > ul.sub-menu');
                subMenus.removeClass('open-sub');
                if (!isOpen) {
                    targetSubMenu.addClass('open-sub');
                }
            }
        }
    </script>
</head>
<body>

<div class="products-selector">
    <img src="/images/thingsboard-cm-icon.svg"/>
    <div class="product-info">
        <div class="product-title">
            Community Edition
        </div>
        <div class="product-description">
            ThingsBoard Documentation
        </div>
    </div>
    <div class="products">
        
        

    
        
        


        
            
        
    


        <a href="/docs/paas/samples/analytics/kafka-streams/" class="product">Cloud</a>
        
        

    
        
        


        
            
        
    


        <a href="/docs/pe/samples/analytics/kafka-streams/" class="product">Professional Edition</a>
        
        

    
        
        


        
            
        
    


        <a href="/docs/samples/analytics/kafka-streams/" class="product active">Community Edition</a>
        
        

    


        <a href="/docs/edge/" class="product">Edge</a>
        
        

    


        <a href="/docs/iot-gateway/" class="product">IoT Gateway</a>
        
        

    


        <a href="/products/license-server/" class="product">License Server</a>
        
        

    


        <a href="/docs/trendz/" class="product">Trendz Analytics</a>
        
    </div>
</div>

<header>
    <div class="logo-burger">
        
        <button onclick="Burger()" class="burger"></button>
        <div id="githubButtonContainer">
            <a class="github-button" href="https://github.com/thingsboard/thingsboard" data-show-count="true"
               aria-label="Star thingsboard/thingsboard on GitHub">Star</a>
        </div>
    </div>
    <nav class="head-menu">
        <ul>
            <li class="nav-products" data-submenu-id="nav-products">
                <a onclick="listburg('nav-products')">Products</a>
            </li>
            <li class="nav-services" data-submenu-id="nav-services">
                <a onclick="listburg('nav-services')">Services</a>
            </li>
            
            <li class="nav-cases" data-submenu-id="nav-cases">
                <a onclick="listburg('nav-cases')">Use Cases</a>
            </li>
            <li class="nav-customers" data-submenu-id="nav-customers">
                <a onclick="listburg('nav-customers')">Customers</a>
            </li>
            <li class="nav-company" data-submenu-id="nav-company">
                <a onclick="listburg('nav-company')">Company</a>
            </li>
            <div class="indicator"><div class="head-arrow"></div><div class="line"></div><div class="sub-background"></div></div>
        </ul>
        <div class="sub-menu-container">
            <div id="nav-products" class="centered-sub">
                <ul class="sub-menu products">
                    <div class="sub-groups">
                        <div class="group">
                            <p class="group-name">IoT platforms</p>
                            <a class="cloud-lnk" href="/products/paas/">
                                <img src="/images/thingsboard-c-icon.svg">
                                <div class="sub-text">
                                    <h1>Cloud</h1>
                                    <p>Platform as a service</p>
                                </div>
                            </a>
                            <a class="prof-lnk" href="/products/thingsboard-pe/">
                                <img src="/images/thingsboard-p-icon.svg">
                                <div class="sub-text">
                                    <h1>Professional Edition</h1>
                                    <p>Advanced IoT platform</p>
                                </div>
                            </a>
                            <a class="com-lnk" href="/">
                                <img src="/images/thingsboard-cm-icon.svg">
                                <div class="sub-text">
                                    <h1>Community Edition</h1>
                                    <p>Open source platform</p>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <p class="group-name">Product ecosystem</p>
                            <a class="edge-lnk" href="/products/thingsboard-edge/">
                                <img src="/images/thingsboard-e-icon.svg">
                                <div class="sub-text">
                                    <h1>Edge</h1>
                                    <p>Edge computing</p>
                                </div>
                            </a>
                            <a class="gateway-lnk" href="/docs/iot-gateway/what-is-iot-gateway/">
                                <img src="/images/gateway-icon.svg">
                                <div class="sub-text">
                                    <h1>IoT Gateway</h1>
                                    <p>Connect legacy protocols</p>
                                </div>
                            </a>
                            <a class="license-lnk" href="/products/license-server/">
                                <img src="/images/license-icon.svg">
                                <div class="sub-text">
                                    <h1>License Server</h1>
                                    <p>Billing solution</p>
                                </div>
                            </a>
                            <a class="trendz-lnk" href="/products/trendz/">
                                <img src="/images/trendz-icon.svg">
                                <div class="sub-text">
                                    <h1>Trendz Analytics</h1>
                                    <p>Data analytics and Prediction</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </ul>
            </div>
            <div id="nav-services" class="centered-sub">
                <ul class="sub-menu services">
                    <a href="/docs/services/support/">
                        <img src="/images/support-icon.svg">
                        <div class="sub-text">
                            <h1>Support</h1>
                            <p>Support packages</p>
                        </div>
                    </a>
                    <a href="/docs/services/trainings/">
                        <img src="/images/train-icon.svg">
                        <div class="sub-text">
                            <h1>Trainings</h1>
                            <p>ThingsBoard education courses</p>
                        </div>
                    </a>
                    <a href="/docs/services/consulting/">
                        <img src="/images/prof-icon.svg">
                        <div class="sub-text">
                            <h1>Professional services</h1>
                            <p>Development of solutions by the ThingsBoard team</p>
                        </div>
                    </a>
                </ul>
            </div>
            
            <div id="nav-cases" class="centered-sub">
                <ul class="sub-menu cases">
                    <a href="/smart-metering/">
                        <img src="/images/case-met-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Metering</h1>
                            <p>Collection, analysis and visualization of data from meters</p>
                        </div>
                    </a>
                    <a href="/smart-energy/">
                        <img src="/images/case-eng-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Energy</h1>
                            <p>Energy monitoring and efficiency analysis</p>
                        </div>
                    </a>
                    <a href="/smart-farming/">
                        <img src="/images/case-fam-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Farming</h1>
                            <p>Monitoring of indoor conditions and plant growth characteristics</p>
                        </div>
                    </a>
                    <a href="/fleet-tracking/">
                        <img src="/images/case-trk-icon.svg">
                        <div class="sub-text">
                            <h1>Fleet Tracking</h1>
                            <p>Fleet tracking and fleet management</p>
                        </div>
                    </a>
                </ul>
            </div>
            <div id="nav-customers" class="centered-sub">
                <ul class="sub-menu customers">
                    <div class="sub-groups">
                        <div class="group">
                            <a class="small-link" href="/industries/smart-energy/">
                                <img src="/images/se-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart Energy</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/agriculture/">
                                <img src="/images/agr-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Agriculture</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/smart-buildings/">
                                <img src="/images/sb-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart Buildings</h1>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <a class="small-link" href="/industries/smart-city/">
                                <img src="/images/sc-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart City</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/telecom/">
                                <img src="/images/tel-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Telecom</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/industry40/">
                                <img src="/images/in-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Industry 4.0</h1>
                                </div>
                            </a>
                        </div>
                    </div>
                </ul>
            </div>
            <div id="nav-company" class="centered-sub">
                <ul class="sub-menu about">
                    <div class="sub-groups">
                        <div class="group">
                            <a class="small-link" href="/company/">
                                <img src="/images/about-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Our Company</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/docs/contact-us/">
                                <img src="/images/contact-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Contact Us</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/careers/">
                                <img src="/images/careers-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Careers</h1>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <a class="small-link" href="/mediakit/">
                                <img src="/images/media-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Media Kit</h1>
                                </div>
                            </a>
                            <a class="small-link" href="https://blog.thingsboard.io/">
                                <img src="/images/blog-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Blog</h1>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="bottom-group">
                        <a class="small-link" href="/partners/hardware/">
                            <img src="/images/hard-s-icon.svg">
                            <div class="sub-text">
                                <h1>Hardware partners</h1>
                            </div>
                        </a>
                        <a class="small-link" href="/partners/distributors/">
                            <img src="/images/dis-s-icon.svg">
                            <div class="sub-text">
                                <h1>Distributors</h1>
                            </div>
                        </a>
                    </div>
                </ul>
            </div>
        </div>
    </nav>
    <div>
        <a href="/installations/" class="n-button try">Try it now</a>
        <a href="/pricing/" class="n-button price">Pricing</a>
    </div>
</header>


<div id="searchBox">
    <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    <button class="searchButton"></button>
</div>

<!--  HERO  -->
<section id="hero">
  <div id="hero-content">
    <div id="vendorStrip">
      <div id="docsList">
          <ul>
            
              
              
              
              <li>
                  <a href="/docs/getting-started-guides/helloworld/" >Getting Started</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/" class="YAH">Documentation</a>
                  
                     <div class="indicator"><div class="head-arrow"></div><div class="line"></div><div class="sub-background"></div></div>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/guides/" >Guides</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/user-guide/install/installation-options/" >Installation</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/reference/" >Architecture</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/api/" >API</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/faq/" >FAQ</a>
                  
              </li>
            
          </ul>
          <div id="docsBreadcrumbs">
              
                  
                  
                  
                  
                      
                  
                      
                  
                      
                  
                      
                         
                         
                         
    

    

    

    

    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    
        
        
        
    

    

    

    

    


        
            
        
    

    
        
        
        
    

    

    


        
            
        
    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    


                         
                            
                         
                      
                  
                      
                         
                         
                         
    

    
        
        
        

                         
                            
                  
                    <span class="item">Documentation</span>
                    
                        <span class="divider">></span>
                    
                  
                    <span class="item">Analytics</span>
                    
                        <span class="divider">></span>
                    
                  
                    <span class="item">Kafka Streams</span>
                    
                  
              
          </div>
      </div>
    </div>
  </div>
</section>
<div id="docsNav">
    <div class="docItems">
        
            
            
                <a class="toc" href="/docs/getting-started-guides/helloworld/" >Getting Started</a>
            
        
            
            
                <div class="pi-accordion">
                    


<a class="item" data-title="Community Edition" href="/docs/"></a>


<a class="item" data-title="What is ThingsBoard?" href="/docs/getting-started-guides/what-is-thingsboard/"></a>


<a class="item" data-title="How to connect your device?" href="/docs/getting-started-guides/connectivity/"></a>


<div class="item" data-title="Key concepts">
  <div class="container">


<a class="item" data-title="Entities and relations" href="/docs/user-guide/entities-and-relations/"></a>


<a class="item" data-title="Tenant Profiles" href="/docs/user-guide/tenant-profiles/"></a>


<a class="item item-new" data-title="Device Profiles" href="/docs/user-guide/device-profiles/"></a>


<a class="item" data-title="Attributes" href="/docs/user-guide/attributes/"></a>


<a class="item" data-title="Time-series data" href="/docs/user-guide/telemetry/"></a>


<a class="item" data-title="Alarms" href="/docs/user-guide/alarms/"></a>


<a class="item" data-title="Remote commands to devices" href="/docs/user-guide/rpc/"></a>


<a class="item item-new" data-title="OTA updates" href="/docs/user-guide/ota-updates/"></a>
  </div>
</div>


<div class="item" data-title="Dashboards">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/user-guide/dashboards/"></a>


<a class="item" data-title="Aliases" href="/docs/user-guide/ui/aliases/"></a>


<a class="item" data-title="Widget Actions" href="/docs/user-guide/ui/widget-actions/"></a>


<a class="item" data-title="Widgets Library" href="/docs/user-guide/ui/widget-library/"></a>
  </div>
</div>


<div class="item" data-title="Rule engine">
  <div class="container">


<a class="item" data-title="Getting Started" href="/docs/user-guide/rule-engine-2-0/re-getting-started/"></a>


<a class="item" data-title="Overview" href="/docs/user-guide/rule-engine-2-0/overview/"></a>


<a class="item" data-title="Architecture" href="/docs/user-guide/rule-engine-2-0/architecture/"></a>


<div class="item" data-title="Nodes">
  <div class="container">


<a class="item" data-title="Filter Nodes" href="/docs/user-guide/rule-engine-2-0/filter-nodes/"></a>


<a class="item" data-title="Enrichment Nodes" href="/docs/user-guide/rule-engine-2-0/enrichment-nodes/"></a>


<a class="item" data-title="Transformation Nodes" href="/docs/user-guide/rule-engine-2-0/transformation-nodes/"></a>


<a class="item" data-title="Action Nodes" href="/docs/user-guide/rule-engine-2-0/action-nodes/"></a>


<a class="item" data-title="External Nodes" href="/docs/user-guide/rule-engine-2-0/external-nodes/"></a>
  </div>
</div>


<div class="item item-pe" data-title="PE Nodes">
  <div class="container">


<a class="item" data-title="Transformation Nodes" href="/docs/pe/user-guide/rule-engine-2-0/transformation-nodes/"></a>


<a class="item" data-title="Action Nodes" href="/docs/pe/user-guide/rule-engine-2-0/action-nodes/"></a>


<a class="item" data-title="Analytics Nodes" href="/docs/pe/user-guide/rule-engine-2-0/analytics-nodes/"></a>
  </div>
</div>


<a class="item" data-title="Custom Rule Nodes" href="/docs/user-guide/contribution/rule-node-development/"></a>
  </div>
</div>


<div class="item item-pe" data-title="White-labeling">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/pe/user-guide/white-labeling/"></a>


<a class="item" data-title="Self-registration" href="/docs/pe/user-guide/self-registration/"></a>


<a class="item" data-title="Custom Translations" href="/docs/pe/user-guide/custom-translation/"></a>


<a class="item" data-title="Custom Menu" href="/docs/pe/user-guide/custom-menu/"></a>
  </div>
</div>


<div class="item item-pe" data-title="Integrations">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/user-guide/integrations/"></a>


<a class="item" data-title="Remote Integrations" href="/docs/user-guide/integrations/remote-integrations/"></a>


<a class="item" data-title="HTTP" href="/docs/user-guide/integrations/http/"></a>


<a class="item" data-title="MQTT" href="/docs/user-guide/integrations/mqtt/"></a>


<a class="item" data-title="OPC-UA" href="/docs/user-guide/integrations/opc-ua/"></a>


<a class="item" data-title="Actility ThingPark" href="/docs/user-guide/integrations/thingpark/"></a>


<a class="item" data-title="TheThingsNetwork" href="/docs/user-guide/integrations/ttn/"></a>


<a class="item" data-title="TheThingsIndustries" href="/docs/user-guide/integrations/tti/"></a>


<a class="item" data-title="LORIOT" href="/docs/user-guide/integrations/loriot/"></a>


<a class="item" data-title="AWS IoT" href="/docs/user-guide/integrations/aws-iot/"></a>


<a class="item" data-title="AWS Kinesis" href="/docs/user-guide/integrations/aws-kinesis/"></a>


<a class="item" data-title="IBM Watson" href="/docs/user-guide/integrations/ibm-watson-iot/"></a>


<a class="item" data-title="Azure Event Hub" href="/docs/user-guide/integrations/azure-event-hub/"></a>


<a class="item" data-title="Azure IoT Hub" href="/docs/user-guide/integrations/azure-iot-hub/"></a>


<a class="item" data-title="TCP" href="/docs/user-guide/integrations/tcp/"></a>


<a class="item" data-title="UDP" href="/docs/user-guide/integrations/udp/"></a>


<a class="item" data-title="SigFox" href="/docs/user-guide/integrations/sigfox/"></a>


<a class="item" data-title="Ocean Connect" href="/docs/user-guide/integrations/ocean-connect/"></a>


<a class="item" data-title="Custom Integration development guide" href="/docs/user-guide/integrations/custom/"></a>


<a class="item" data-title="Notifications and Alarms on your smartphone using Telegram Bot" href="/docs/user-guide/rule-engine-2-0/tutorials/integration-with-telegram-bot/"></a>
  </div>
</div>


<div class="item" data-title="Analytics">
  <div class="container">


<a class="item" data-title="Trendz Analytics" href="/docs/trendz/"></a>


<a class="item" data-title="Kafka Streams" href="/docs/samples/analytics/kafka-streams/"></a>
  </div>
</div>


<div class="item" data-title="Other Features">
  <div class="container">


<a class="item" data-title="Device Connectivity Status" href="/docs/user-guide/device-connectivity-status/"></a>


<a class="item" data-title="Claiming Devices" href="/docs/user-guide/claiming-devices/"></a>


<a class="item item-new" data-title="Device provisioning" href="/docs/user-guide/device-provisioning/"></a>


<a class="item" data-title="Entity Views" href="/docs/user-guide/entity-views/"></a>


<a class="item" data-title="API Limits" href="/docs/user-guide/api-limits/"></a>


<a class="item item-new" data-title="Bulk Provisioning" href="/docs/user-guide/bulk-provisioning/"></a>


<a class="item item-pe" data-title="Entity Groups" href="/docs/pe/user-guide/groups/"></a>


<a class="item item-pe" data-title="Scheduler" href="/docs/pe/user-guide/scheduler/"></a>


<a class="item item-pe" data-title="Reporting" href="/docs/pe/user-guide/reporting/"></a>


<a class="item item-pe" data-title="CSV/XLS data export" href="/docs/pe/user-guide/csv-xls-data-export/"></a>


<a class="item item-pe" data-title="File Storage" href="/docs/pe/user-guide/file-storage/"></a>
  </div>
</div>


<div class="item" data-title="Security">
  <div class="container">


<a class="item" data-title="Audit Log" href="/docs/user-guide/audit-log/"></a>


<a class="item item-pe" data-title="Advanced RBAC for IoT" href="/docs/pe/user-guide/rbac/"></a>


<a class="item" data-title="OAuth 2 Support" href="/docs/user-guide/oauth-2-support/"></a>


<a class="item" data-title="MQTT over SSL" href="/docs/user-guide/mqtt-over-ssl/"></a>


<a class="item" data-title="Device authentication options" href="/docs/user-guide/device-credentials/"></a>


<a class="item" data-title="Access Token based authentication" href="/docs/user-guide/access-token/"></a>


<a class="item" data-title="Basic MQTT Credentials" href="/docs/user-guide/basic-mqtt/"></a>


<a class="item" data-title="X.509 Certificate based authentication" href="/docs/user-guide/certificates/"></a>
  </div>
</div>


<div class="item" data-title="Administration UI">
  <div class="container">


<a class="item" data-title="Tenants" href="/docs/user-guide/ui/tenants/"></a>


<a class="item" data-title="Customers" href="/docs/user-guide/ui/customers/"></a>


<a class="item" data-title="Users" href="/docs/user-guide/ui/users/"></a>


<a class="item" data-title="Assets" href="/docs/user-guide/ui/assets/"></a>


<a class="item" data-title="Devices" href="/docs/user-guide/ui/devices/"></a>


<a class="item" data-title="Rule Chains" href="/docs/user-guide/ui/rule-chains/"></a>


<div class="item" data-title="Widgets">
  <div class="container">


<a class="item item-new" data-title="Chart widgets" href="/docs/user-guide/ui/chart-widget/"></a>


<a class="item item-new" data-title="Entity Table widget" href="/docs/user-guide/ui/entity-table-widget/"></a>


<a class="item" data-title="Trip Animation widget" href="/docs/user-guide/ui/trip-animation-widget/"></a>


<a class="item" data-title="Advanced data key configuration" href="/docs/user-guide/ui/advanced-data-key-configuration/"></a>
  </div>
</div>


<a class="item" data-title="Dashboards" href="/docs/user-guide/ui/dashboards/"></a>


<a class="item" data-title="SMS Provider Settings" href="/docs/user-guide/ui/sms-provider-settings/"></a>


<a class="item" data-title="Mail Settings" href="/docs/user-guide/ui/mail-settings/"></a>
  </div>
</div>


<div class="item" data-title="Contribution Guide">
  <div class="container">


<a class="item" data-title="How to contribute" href="/docs/user-guide/contribution/how-to-contribute/"></a>


<a class="item" data-title="How to contribute your device integration guide" href="/docs/user-guide/contribution/how-to-contribute-your-device-integration-guide/"></a>


<a class="item" data-title="Rule Node development" href="/docs/user-guide/contribution/rule-node-development/"></a>


<a class="item" data-title="Widgets development (ThingsBoard v3.x)" href="/docs/user-guide/contribution/widgets-development/"></a>


<a class="item" data-title="Widgets development (ThingsBoard v2.x)" href="/docs/user-guide/contribution/widgets-development-before-3.0/"></a>
  </div>
</div>


<a class="item" data-title="Troubleshooting" href="/docs/user-guide/troubleshooting/"></a>


<a class="item" data-title="Release Notes" href="/docs/reference/releases/"></a>


<a class="item" data-title="Roadmap" href="/docs/reference/roadmap/"></a>
                </div>
            
        
            
            
                <a class="toc" href="/docs/guides/" >Guides</a>
            
        
            
            
                <a class="toc" href="/docs/user-guide/install/installation-options/" >Installation</a>
            
        
            
            
                <a class="toc" href="/docs/reference/" >Architecture</a>
            
        
            
            
                <a class="toc" href="/docs/api/" >API</a>
            
        
            
            
                <a class="toc" href="/docs/faq/" >FAQ</a>
            
        
    </div>
</div>








<section id="encyclopedia">
  
  <div id="docsToc">
        <div class="pi-accordion">
        


<a class="item" data-title="Community Edition" href="/docs/"></a>


<a class="item" data-title="What is ThingsBoard?" href="/docs/getting-started-guides/what-is-thingsboard/"></a>


<a class="item" data-title="How to connect your device?" href="/docs/getting-started-guides/connectivity/"></a>


<div class="item" data-title="Key concepts">
  <div class="container">


<a class="item" data-title="Entities and relations" href="/docs/user-guide/entities-and-relations/"></a>


<a class="item" data-title="Tenant Profiles" href="/docs/user-guide/tenant-profiles/"></a>


<a class="item item-new" data-title="Device Profiles" href="/docs/user-guide/device-profiles/"></a>


<a class="item" data-title="Attributes" href="/docs/user-guide/attributes/"></a>


<a class="item" data-title="Time-series data" href="/docs/user-guide/telemetry/"></a>


<a class="item" data-title="Alarms" href="/docs/user-guide/alarms/"></a>


<a class="item" data-title="Remote commands to devices" href="/docs/user-guide/rpc/"></a>


<a class="item item-new" data-title="OTA updates" href="/docs/user-guide/ota-updates/"></a>
  </div>
</div>


<div class="item" data-title="Dashboards">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/user-guide/dashboards/"></a>


<a class="item" data-title="Aliases" href="/docs/user-guide/ui/aliases/"></a>


<a class="item" data-title="Widget Actions" href="/docs/user-guide/ui/widget-actions/"></a>


<a class="item" data-title="Widgets Library" href="/docs/user-guide/ui/widget-library/"></a>
  </div>
</div>


<div class="item" data-title="Rule engine">
  <div class="container">


<a class="item" data-title="Getting Started" href="/docs/user-guide/rule-engine-2-0/re-getting-started/"></a>


<a class="item" data-title="Overview" href="/docs/user-guide/rule-engine-2-0/overview/"></a>


<a class="item" data-title="Architecture" href="/docs/user-guide/rule-engine-2-0/architecture/"></a>


<div class="item" data-title="Nodes">
  <div class="container">


<a class="item" data-title="Filter Nodes" href="/docs/user-guide/rule-engine-2-0/filter-nodes/"></a>


<a class="item" data-title="Enrichment Nodes" href="/docs/user-guide/rule-engine-2-0/enrichment-nodes/"></a>


<a class="item" data-title="Transformation Nodes" href="/docs/user-guide/rule-engine-2-0/transformation-nodes/"></a>


<a class="item" data-title="Action Nodes" href="/docs/user-guide/rule-engine-2-0/action-nodes/"></a>


<a class="item" data-title="External Nodes" href="/docs/user-guide/rule-engine-2-0/external-nodes/"></a>
  </div>
</div>


<div class="item item-pe" data-title="PE Nodes">
  <div class="container">


<a class="item" data-title="Transformation Nodes" href="/docs/pe/user-guide/rule-engine-2-0/transformation-nodes/"></a>


<a class="item" data-title="Action Nodes" href="/docs/pe/user-guide/rule-engine-2-0/action-nodes/"></a>


<a class="item" data-title="Analytics Nodes" href="/docs/pe/user-guide/rule-engine-2-0/analytics-nodes/"></a>
  </div>
</div>


<a class="item" data-title="Custom Rule Nodes" href="/docs/user-guide/contribution/rule-node-development/"></a>
  </div>
</div>


<div class="item item-pe" data-title="White-labeling">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/pe/user-guide/white-labeling/"></a>


<a class="item" data-title="Self-registration" href="/docs/pe/user-guide/self-registration/"></a>


<a class="item" data-title="Custom Translations" href="/docs/pe/user-guide/custom-translation/"></a>


<a class="item" data-title="Custom Menu" href="/docs/pe/user-guide/custom-menu/"></a>
  </div>
</div>


<div class="item item-pe" data-title="Integrations">
  <div class="container">


<a class="item" data-title="Overview" href="/docs/user-guide/integrations/"></a>


<a class="item" data-title="Remote Integrations" href="/docs/user-guide/integrations/remote-integrations/"></a>


<a class="item" data-title="HTTP" href="/docs/user-guide/integrations/http/"></a>


<a class="item" data-title="MQTT" href="/docs/user-guide/integrations/mqtt/"></a>


<a class="item" data-title="OPC-UA" href="/docs/user-guide/integrations/opc-ua/"></a>


<a class="item" data-title="Actility ThingPark" href="/docs/user-guide/integrations/thingpark/"></a>


<a class="item" data-title="TheThingsNetwork" href="/docs/user-guide/integrations/ttn/"></a>


<a class="item" data-title="TheThingsIndustries" href="/docs/user-guide/integrations/tti/"></a>


<a class="item" data-title="LORIOT" href="/docs/user-guide/integrations/loriot/"></a>


<a class="item" data-title="AWS IoT" href="/docs/user-guide/integrations/aws-iot/"></a>


<a class="item" data-title="AWS Kinesis" href="/docs/user-guide/integrations/aws-kinesis/"></a>


<a class="item" data-title="IBM Watson" href="/docs/user-guide/integrations/ibm-watson-iot/"></a>


<a class="item" data-title="Azure Event Hub" href="/docs/user-guide/integrations/azure-event-hub/"></a>


<a class="item" data-title="Azure IoT Hub" href="/docs/user-guide/integrations/azure-iot-hub/"></a>


<a class="item" data-title="TCP" href="/docs/user-guide/integrations/tcp/"></a>


<a class="item" data-title="UDP" href="/docs/user-guide/integrations/udp/"></a>


<a class="item" data-title="SigFox" href="/docs/user-guide/integrations/sigfox/"></a>


<a class="item" data-title="Ocean Connect" href="/docs/user-guide/integrations/ocean-connect/"></a>


<a class="item" data-title="Custom Integration development guide" href="/docs/user-guide/integrations/custom/"></a>


<a class="item" data-title="Notifications and Alarms on your smartphone using Telegram Bot" href="/docs/user-guide/rule-engine-2-0/tutorials/integration-with-telegram-bot/"></a>
  </div>
</div>


<div class="item" data-title="Analytics">
  <div class="container">


<a class="item" data-title="Trendz Analytics" href="/docs/trendz/"></a>


<a class="item" data-title="Kafka Streams" href="/docs/samples/analytics/kafka-streams/"></a>
  </div>
</div>


<div class="item" data-title="Other Features">
  <div class="container">


<a class="item" data-title="Device Connectivity Status" href="/docs/user-guide/device-connectivity-status/"></a>


<a class="item" data-title="Claiming Devices" href="/docs/user-guide/claiming-devices/"></a>


<a class="item item-new" data-title="Device provisioning" href="/docs/user-guide/device-provisioning/"></a>


<a class="item" data-title="Entity Views" href="/docs/user-guide/entity-views/"></a>


<a class="item" data-title="API Limits" href="/docs/user-guide/api-limits/"></a>


<a class="item item-new" data-title="Bulk Provisioning" href="/docs/user-guide/bulk-provisioning/"></a>


<a class="item item-pe" data-title="Entity Groups" href="/docs/pe/user-guide/groups/"></a>


<a class="item item-pe" data-title="Scheduler" href="/docs/pe/user-guide/scheduler/"></a>


<a class="item item-pe" data-title="Reporting" href="/docs/pe/user-guide/reporting/"></a>


<a class="item item-pe" data-title="CSV/XLS data export" href="/docs/pe/user-guide/csv-xls-data-export/"></a>


<a class="item item-pe" data-title="File Storage" href="/docs/pe/user-guide/file-storage/"></a>
  </div>
</div>


<div class="item" data-title="Security">
  <div class="container">


<a class="item" data-title="Audit Log" href="/docs/user-guide/audit-log/"></a>


<a class="item item-pe" data-title="Advanced RBAC for IoT" href="/docs/pe/user-guide/rbac/"></a>


<a class="item" data-title="OAuth 2 Support" href="/docs/user-guide/oauth-2-support/"></a>


<a class="item" data-title="MQTT over SSL" href="/docs/user-guide/mqtt-over-ssl/"></a>


<a class="item" data-title="Device authentication options" href="/docs/user-guide/device-credentials/"></a>


<a class="item" data-title="Access Token based authentication" href="/docs/user-guide/access-token/"></a>


<a class="item" data-title="Basic MQTT Credentials" href="/docs/user-guide/basic-mqtt/"></a>


<a class="item" data-title="X.509 Certificate based authentication" href="/docs/user-guide/certificates/"></a>
  </div>
</div>


<div class="item" data-title="Administration UI">
  <div class="container">


<a class="item" data-title="Tenants" href="/docs/user-guide/ui/tenants/"></a>


<a class="item" data-title="Customers" href="/docs/user-guide/ui/customers/"></a>


<a class="item" data-title="Users" href="/docs/user-guide/ui/users/"></a>


<a class="item" data-title="Assets" href="/docs/user-guide/ui/assets/"></a>


<a class="item" data-title="Devices" href="/docs/user-guide/ui/devices/"></a>


<a class="item" data-title="Rule Chains" href="/docs/user-guide/ui/rule-chains/"></a>


<div class="item" data-title="Widgets">
  <div class="container">


<a class="item item-new" data-title="Chart widgets" href="/docs/user-guide/ui/chart-widget/"></a>


<a class="item item-new" data-title="Entity Table widget" href="/docs/user-guide/ui/entity-table-widget/"></a>


<a class="item" data-title="Trip Animation widget" href="/docs/user-guide/ui/trip-animation-widget/"></a>


<a class="item" data-title="Advanced data key configuration" href="/docs/user-guide/ui/advanced-data-key-configuration/"></a>
  </div>
</div>


<a class="item" data-title="Dashboards" href="/docs/user-guide/ui/dashboards/"></a>


<a class="item" data-title="SMS Provider Settings" href="/docs/user-guide/ui/sms-provider-settings/"></a>


<a class="item" data-title="Mail Settings" href="/docs/user-guide/ui/mail-settings/"></a>
  </div>
</div>


<div class="item" data-title="Contribution Guide">
  <div class="container">


<a class="item" data-title="How to contribute" href="/docs/user-guide/contribution/how-to-contribute/"></a>


<a class="item" data-title="How to contribute your device integration guide" href="/docs/user-guide/contribution/how-to-contribute-your-device-integration-guide/"></a>


<a class="item" data-title="Rule Node development" href="/docs/user-guide/contribution/rule-node-development/"></a>


<a class="item" data-title="Widgets development (ThingsBoard v3.x)" href="/docs/user-guide/contribution/widgets-development/"></a>


<a class="item" data-title="Widgets development (ThingsBoard v2.x)" href="/docs/user-guide/contribution/widgets-development-before-3.0/"></a>
  </div>
</div>


<a class="item" data-title="Troubleshooting" href="/docs/user-guide/troubleshooting/"></a>


<a class="item" data-title="Release Notes" href="/docs/reference/releases/"></a>


<a class="item" data-title="Roadmap" href="/docs/reference/roadmap/"></a>
        </div> <!-- /pi-accordion -->
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class=" hasTocContent">
      <div id="table-of-contents">
          
              <h4>On this page</h4>
          
      </div>
      <div id="top-spacer"></div>
      <h1>IoT data analytics using Kafka, Kafka Streams and ThingsBoard</h1>
      <div id="content">
          <ul id="markdown-toc">
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#step-1-rule-chain-configuration" id="markdown-toc-step-1-rule-chain-configuration">Step 1. Rule Chain configuration</a></li>
  <li><a href="#step-2-launch-kafka-streams-application" id="markdown-toc-step-2-launch-kafka-streams-application">Step 2. Launch Kafka Streams application.</a>    <ul>
      <li><a href="#download-the-sample-application" id="markdown-toc-download-the-sample-application">Download the sample application</a></li>
      <li><a href="#dependencies-review" id="markdown-toc-dependencies-review">Dependencies review</a></li>
      <li><a href="#source-code-review" id="markdown-toc-source-code-review">Source code review</a></li>
    </ul>
  </li>
  <li><a href="#step-3-configure-the-kafka-integration" id="markdown-toc-step-3-configure-the-kafka-integration">Step 3. Configure the Kafka Integration.</a>    <ul>
      <li><a href="#configure-uplink-converter" id="markdown-toc-configure-uplink-converter">Configure Uplink Converter</a></li>
      <li><a href="#configure-kafka-integration" id="markdown-toc-configure-kafka-integration">Configure Kafka Integration</a></li>
    </ul>
  </li>
  <li><a href="#step-4-configure-rule-engine-to-raise-alarms" id="markdown-toc-step-4-configure-rule-engine-to-raise-alarms">Step 4. Configure Rule Engine to raise Alarms.</a></li>
  <li><a href="#step-5-remove-debug-messages-logging" id="markdown-toc-step-5-remove-debug-messages-logging">Step 5. Remove debug messages logging</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next steps</a></li>
</ul>

<p>ThingsBoard rule engine supports basic analysis of incoming telemetry data, for example, threshold crossing.
The idea behind rule engine is to provide functionality to route data from IoT Devices to different plugins, based on device attributes or the data itself. <br />
However, most of the real-life use cases also require the support of advanced analytics: machine learning, predictive analytics, etc.</p>

<p>This tutorial will demonstrate how you can:</p>

<ul>
  <li>route telemetry device data from ThingsBoard to Kafka topic using the built-in rule engine capabilities (works for both ThingsBoard CE and PE).</li>
  <li>aggregate data from multiple devices using a simple Kafka Streams application.</li>
  <li>push results of the analytics back to ThingsBoard for persistence and visualization using ThingsBoard PE Kafka Integration.</li>
</ul>

<p>The analytics in this tutorial is, of course, quite simple, but our goal is to highlight the integration steps.</p>

<p><img src="/images/samples/analytics/kafka-streams/kafka-streams-example.svg" alt="image" /></p>

<p>Let’s assume we have a large number of solar panels which include a number of solar modules. 
ThingsBoard is used to collect, store and visualize anomaly telemetry from these solar modules in each panels.</p>

<p>We calculated anomaly by comparing value produced from a solar module with the average valued produced by all modules of the same panel and standard <strong>deviation</strong> of the same value.</p>

<p><img src="/images/user-guide/integrations/kafka/deviation.png" alt="image" /></p>

<p>We will analyze real-time data from multiple devices using <a href="https://kafka.apache.org/documentation/streams/">Kafka Streams</a> job with 30 seconds window (configurable).</p>

<p>In order to store and visualize the results of the analytics, we are going to create three virtual solar module devices for each solar panel.</p>

<h3 id="prerequisites">Prerequisites</h3>

<p>The following services must be up and running:</p>

<ul>
  <li>ThingsBoard PE v2.4.2+ <a href="/docs/user-guide/install/pe/installation-options/">instance</a></li>
  <li>Kafka <a href="https://kafka.apache.org/23/documentation/streams/quickstart#quickstart_streams_download">server</a></li>
</ul>

<h3 id="step-1-rule-chain-configuration">Step 1. Rule Chain configuration</h3>

<p>During this step we will configure three generator nodes that will produce simulated data for testing during development. 
Typically, you don’t need them in production, but it is very useful for debugging. We will generate data for 3 modules and one panel. 
Two of those modules will produce the same value and one module will produce much lower value. 
Of course, you should replace this with real data produced by real devices. This is just an example.</p>

<p>Let’s create three devices with type “solar-module”. If you are using ThingsBoard PE, you cna put them to new “Solar Modules” group.</p>

<p><img src="/images/samples/analytics/kafka-streams/solar-module-devices.png" alt="image" /></p>

<p>Now, let’s create three device simulators to push data directly to our local Kafka broker. 
The simulated data will be pushed to the Kafka Rule Node, which is responsible for pushing data to Kafka topic. 
Let’s configure Kafka Rule Node first. We will use local Kafka server (localhost:9092) and topic “solar-module-raw”.</p>

<p><img src="/images/samples/analytics/kafka-streams/add-kafka-rule-node.png" alt="image" /></p>

<p>Now, let’s add “generator” node for the first module. We will configure generator to constantly “produce” 5 watts.</p>

<p><img src="/images/samples/analytics/kafka-streams/add-module1-simulator-rule-node.png" alt="image" /></p>

<p>Add “generator” node for the second module. We will configure generator to constantly “produce” 5 watts as well.</p>

<p>Now, let’s add “generator” node for the third module. We will configure generator to constantly “produce” 3.5 watts which simulates module degradation.</p>

<p><img src="/images/samples/analytics/kafka-streams/add-module3-simulator-rule-node.png" alt="image" /></p>

<p>The result rule chain should look similar to this one:</p>

<p><img src="/images/samples/analytics/kafka-streams/simulator-rule-chain.png" alt="image" /></p>

<p>You can also download the rule chain <a href="/docs/samples/analytics/resources/solar_module_simulator.json">JSON file</a> and <a href="/docs/user-guide/ui/rule-chains/#rule-import">import</a> it to your project.</p>

<p>Once the rule chain is imported, you should check the debug output of the Kafka node. If your Kafka is up and running at localhost, you should see similar debug messages. 
Notice the absence of errors in debug log:</p>

<p><img src="/images/samples/analytics/kafka-streams/check-no-errors.png" alt="image" /></p>

<h3 id="step-2-launch-kafka-streams-application">Step 2. Launch Kafka Streams application.</h3>

<p>During this step we will download and launch sample application that analyze raw data from “solar-module-raw” 
and produce valuable insights about module degradations. 
The sample application calculates total amount of energy produced by each module in the panel within the time window (configurable). 
Then application calculates average power produced by module for each panel and it’s deviation within the same time window.
Once this is done, the app compares each module values with the average and if the difference is bigger then the deviation, we treat this as anomaly.</p>

<p>The results of anomaly calculations are pushed to the “anomalies-topic”. 
ThingsBoard subscribed to this topic using Kafka Integration, generate alarms and store anomalies to the database.</p>

<h4 id="download-the-sample-application">Download the sample application</h4>

<p>Feel free to grab the <a href="https://github.com/thingsboard/kafka-streams-example">code from the ThingsBoard repository</a> and build the project with maven:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>mvn clean <span class="nb">install</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Go ahead and add that maven project to your favorite IDE.</p>

<h4 id="dependencies-review">Dependencies review</h4>

<p>Main dependencies that are used in the project:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;dependencies&gt;</span>
...
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.kafka<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>kafka-streams<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${kafka.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
...
<span class="nt">&lt;/dependencies&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="source-code-review">Source code review</h4>

<p>The Kafka Streams Application logic is concentrated mainly in the <a href="https://github.com/thingsboard/kafka-streams-example/blob/master/src/main/java/org/thingsboard/kafka/SolarConsumer.java">SolarConsumer</a> class.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="nc">Properties</span> <span class="nf">getProperties</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Properties</span><span class="o">();</span>
    <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">APPLICATION_ID_CONFIG</span><span class="o">,</span> <span class="s">"streams"</span><span class="o">);</span>
    <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="s">"localhost:9092"</span><span class="o">);</span>
    <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">CACHE_MAX_BYTES_BUFFERING_CONFIG</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">DEFAULT_KEY_SERDE_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">Serdes</span><span class="o">.</span><span class="na">String</span><span class="o">().</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">DEFAULT_VALUE_SERDE_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">Serdes</span><span class="o">.</span><span class="na">String</span><span class="o">().</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">AUTO_OFFSET_RESET_CONFIG</span><span class="o">,</span> <span class="s">"latest"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">props</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">IN_TOPIC</span> <span class="o">=</span> <span class="s">"solar-module-raw"</span><span class="o">;</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">TopicNameExtractor</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">SolarModuleAggregatorJoiner</span><span class="o">&gt;</span> <span class="no">OUT_TOPIC</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nc">StaticTopicNameExtractor</span><span class="o">&lt;&gt;(</span><span class="s">"solar-module-anomalies"</span><span class="o">);</span>

<span class="c1">// Time for windowing</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Duration</span> <span class="no">DURATION</span> <span class="o">=</span> <span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">TimeWindows</span> <span class="no">TIME_WINDOWS</span> <span class="o">=</span> <span class="nc">TimeWindows</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="no">DURATION</span><span class="o">);</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">JoinWindows</span> <span class="no">JOIN_WINDOWS</span> <span class="o">=</span> <span class="nc">JoinWindows</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="no">DURATION</span><span class="o">);</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">StreamsBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamsBuilder</span><span class="o">();</span>


<span class="c1">// serde - Serializer/Deserializer</span>
<span class="c1">// for custom classes should be custom Serializer/Deserializer</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">SolarModuleData</span><span class="o">&gt;</span> <span class="no">SOLAR_MODULE_DATA_SERDE</span> <span class="o">=</span>
    <span class="nc">Serdes</span><span class="o">.</span><span class="na">serdeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonPojoSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonPojoDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">SolarModuleData</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">SolarModuleAggregator</span><span class="o">&gt;</span> <span class="no">SOLAR_MODULE_AGGREGATOR_SERDE</span> <span class="o">=</span>
    <span class="nc">Serdes</span><span class="o">.</span><span class="na">serdeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonPojoSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonPojoDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">SolarModuleAggregator</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">SolarPanelAggregator</span><span class="o">&gt;</span> <span class="no">SOLAR_PANEL_AGGREGATOR_SERDE</span> <span class="o">=</span>
    <span class="nc">Serdes</span><span class="o">.</span><span class="na">serdeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonPojoSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonPojoDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">SolarPanelAggregator</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">SolarModuleKey</span><span class="o">&gt;</span> <span class="no">SOLAR_MODULE_KEY_SERDE</span> <span class="o">=</span>
    <span class="nc">Serdes</span><span class="o">.</span><span class="na">serdeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonPojoSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonPojoDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">SolarModuleKey</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">SolarPanelAggregatorJoiner</span><span class="o">&gt;</span> <span class="no">SOLAR_PANEL_AGGREGATOR_JOINER_SERDE</span> <span class="o">=</span>
    <span class="nc">Serdes</span><span class="o">.</span><span class="na">serdeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonPojoSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonPojoDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">SolarPanelAggregatorJoiner</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">SolarModuleAggregatorJoiner</span><span class="o">&gt;</span> <span class="no">SOLAR_MODULE_AGGREGATOR_JOINER_SERDE</span> <span class="o">=</span>
    <span class="nc">Serdes</span><span class="o">.</span><span class="na">serdeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonPojoSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonPojoDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">SolarModuleAggregatorJoiner</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">STRING_SERDE</span> <span class="o">=</span> <span class="nc">Serdes</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Serde</span><span class="o">&lt;</span><span class="nc">Windowed</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="no">WINDOWED_STRING_SERDE</span> <span class="o">=</span> <span class="nc">Serdes</span><span class="o">.</span><span class="na">serdeFrom</span><span class="o">(</span>
    <span class="k">new</span> <span class="nc">TimeWindowedSerializer</span><span class="o">&lt;&gt;(</span><span class="no">STRING_SERDE</span><span class="o">.</span><span class="na">serializer</span><span class="o">()),</span>
    <span class="k">new</span> <span class="nc">TimeWindowedDeserializer</span><span class="o">&lt;&gt;(</span><span class="no">STRING_SERDE</span><span class="o">.</span><span class="na">deserializer</span><span class="o">(),</span> <span class="no">TIME_WINDOWS</span><span class="o">.</span><span class="na">size</span><span class="o">()));</span>

<span class="c1">// 1 - sigma</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">Z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre></td><td class="rouge-code"><pre><span class="c1">// source stream from kafka</span>
<span class="kd">final</span> <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">SolarModuleKey</span><span class="o">,</span> <span class="nc">SolarModuleData</span><span class="o">&gt;</span> <span class="n">source</span> <span class="o">=</span>
    <span class="n">builder</span>
        <span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="no">IN_TOPIC</span><span class="o">,</span> <span class="nc">Consumed</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">STRING_SERDE</span><span class="o">,</span> <span class="no">SOLAR_MODULE_DATA_SERDE</span><span class="o">))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">KeyValue</span><span class="o">.</span><span class="na">pair</span><span class="o">(</span><span class="k">new</span> <span class="nc">SolarModuleKey</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getPanel</span><span class="o">(),</span> <span class="n">v</span><span class="o">.</span><span class="na">getName</span><span class="o">()),</span> <span class="n">v</span><span class="o">));</span>


<span class="c1">// calculating sum power and average power for modules</span>
<span class="kd">final</span> <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">Windowed</span><span class="o">&lt;</span><span class="nc">SolarModuleKey</span><span class="o">&gt;,</span> <span class="nc">SolarModuleAggregator</span><span class="o">&gt;</span> <span class="n">aggPowerPerSolarModuleStream</span> <span class="o">=</span>
     <span class="n">source</span>
        <span class="o">.</span><span class="na">groupByKey</span><span class="o">(</span><span class="nc">Grouped</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">SOLAR_MODULE_KEY_SERDE</span><span class="o">,</span> <span class="no">SOLAR_MODULE_DATA_SERDE</span><span class="o">))</span>
        <span class="o">.</span><span class="na">windowedBy</span><span class="o">(</span><span class="no">TIME_WINDOWS</span><span class="o">)</span>
        <span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="nl">SolarModuleAggregator:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span>
            <span class="o">(</span><span class="n">modelKey</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">aggregation</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">aggregation</span><span class="o">.</span><span class="na">updateFrom</span><span class="o">(</span><span class="n">value</span><span class="o">),</span>
            <span class="nc">Materialized</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">SOLAR_MODULE_KEY_SERDE</span><span class="o">,</span> <span class="no">SOLAR_MODULE_AGGREGATOR_SERDE</span><span class="o">))</span>
        <span class="o">.</span><span class="na">suppress</span><span class="o">(</span><span class="nc">Suppressed</span><span class="o">.</span><span class="na">untilTimeLimit</span><span class="o">(</span><span class="no">DURATION</span><span class="o">,</span> <span class="nc">Suppressed</span><span class="o">.</span><span class="na">BufferConfig</span><span class="o">.</span><span class="na">unbounded</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">toStream</span><span class="o">();</span>


<span class="c1">// calculating sum power and average power for panels</span>
<span class="kd">final</span> <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">Windowed</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;,</span> <span class="nc">SolarPanelAggregator</span><span class="o">&gt;</span> <span class="n">aggPowerPerSolarPanelStream</span> <span class="o">=</span>
    <span class="n">aggPowerPerSolarModuleStream</span>
        <span class="o">.</span><span class="na">map</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">KeyValue</span><span class="o">.</span><span class="na">pair</span><span class="o">(</span><span class="k">new</span> <span class="nc">Windowed</span><span class="o">&lt;&gt;(</span><span class="n">k</span><span class="o">.</span><span class="na">key</span><span class="o">().</span><span class="na">getPanelName</span><span class="o">(),</span> <span class="n">k</span><span class="o">.</span><span class="na">window</span><span class="o">()),</span> <span class="n">v</span><span class="o">))</span>
        <span class="o">.</span><span class="na">groupByKey</span><span class="o">(</span><span class="nc">Grouped</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">WINDOWED_STRING_SERDE</span><span class="o">,</span> <span class="no">SOLAR_MODULE_AGGREGATOR_SERDE</span><span class="o">))</span>
        <span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="nl">SolarPanelAggregator:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span>
            <span class="o">(</span><span class="n">panelKey</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">aggregation</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">aggregation</span><span class="o">.</span><span class="na">updateFrom</span><span class="o">(</span><span class="n">value</span><span class="o">),</span>
            <span class="nc">Materialized</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">WINDOWED_STRING_SERDE</span><span class="o">,</span> <span class="no">SOLAR_PANEL_AGGREGATOR_SERDE</span><span class="o">))</span>
        <span class="o">.</span><span class="na">suppress</span><span class="o">(</span><span class="nc">Suppressed</span><span class="o">.</span><span class="na">untilTimeLimit</span><span class="o">(</span><span class="no">DURATION</span><span class="o">,</span> <span class="nc">Suppressed</span><span class="o">.</span><span class="na">BufferConfig</span><span class="o">.</span><span class="na">unbounded</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">toStream</span><span class="o">();</span>


 <span class="c1">// if used for join more than once, the exception "TopologyException: Invalid topology:" will be thrown</span>
<span class="kd">final</span> <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">Windowed</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;,</span> <span class="nc">SolarModuleAggregator</span><span class="o">&gt;</span> <span class="n">aggPowerPerSolarModuleForJoinStream</span> <span class="o">=</span>
    <span class="n">aggPowerPerSolarModuleStream</span>
        <span class="o">.</span><span class="na">map</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">KeyValue</span><span class="o">.</span><span class="na">pair</span><span class="o">(</span><span class="k">new</span> <span class="nc">Windowed</span><span class="o">&lt;&gt;(</span><span class="n">k</span><span class="o">.</span><span class="na">key</span><span class="o">().</span><span class="na">getPanelName</span><span class="o">(),</span> <span class="n">k</span><span class="o">.</span><span class="na">window</span><span class="o">()),</span> <span class="n">v</span><span class="o">));</span>


<span class="c1">// joining aggregated panels with aggregated modules</span>
<span class="c1">// need for calculating sumSquare and deviance</span>
<span class="kd">final</span> <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">Windowed</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;,</span> <span class="nc">SolarPanelAggregatorJoiner</span><span class="o">&gt;</span> <span class="n">joinedAggPanelWithAggModule</span> <span class="o">=</span>
    <span class="n">aggPowerPerSolarPanelStream</span>
        <span class="o">.</span><span class="na">join</span><span class="o">(</span>
            <span class="n">aggPowerPerSolarModuleForJoinStream</span><span class="o">,</span>
            <span class="nl">SolarPanelAggregatorJoiner:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span> <span class="no">JOIN_WINDOWS</span><span class="o">,</span>
            <span class="nc">Joined</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">WINDOWED_STRING_SERDE</span><span class="o">,</span> <span class="no">SOLAR_PANEL_AGGREGATOR_SERDE</span><span class="o">,</span> <span class="no">SOLAR_MODULE_AGGREGATOR_SERDE</span><span class="o">));</span>


<span class="c1">//calculating sumSquare and deviance</span>
<span class="kd">final</span> <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">Windowed</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;,</span> <span class="nc">SolarPanelAggregator</span><span class="o">&gt;</span> <span class="n">aggPowerPerSolarPanelFinalStream</span> <span class="o">=</span>
    <span class="n">joinedAggPanelWithAggModule</span>
        <span class="o">.</span><span class="na">groupByKey</span><span class="o">(</span><span class="nc">Grouped</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">WINDOWED_STRING_SERDE</span><span class="o">,</span> <span class="no">SOLAR_PANEL_AGGREGATOR_JOINER_SERDE</span><span class="o">))</span>
        <span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="nl">SolarPanelAggregator:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span>
            <span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">aggregation</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">aggregation</span><span class="o">.</span><span class="na">updateFrom</span><span class="o">(</span><span class="n">value</span><span class="o">),</span>
            <span class="nc">Materialized</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">WINDOWED_STRING_SERDE</span><span class="o">,</span> <span class="no">SOLAR_PANEL_AGGREGATOR_SERDE</span><span class="o">))</span>
        <span class="o">.</span><span class="na">suppress</span><span class="o">(</span><span class="nc">Suppressed</span><span class="o">.</span><span class="na">untilTimeLimit</span><span class="o">(</span><span class="no">DURATION</span><span class="o">,</span> <span class="nc">Suppressed</span><span class="o">.</span><span class="na">BufferConfig</span><span class="o">.</span><span class="na">unbounded</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">toStream</span><span class="o">();</span>


<span class="c1">// joining aggregated modules with aggregated panels in which calculated sumSquare and deviance</span>
<span class="c1">// need for check modules with anomaly power value</span>
<span class="kd">final</span> <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">Windowed</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;,</span> <span class="nc">SolarModuleAggregatorJoiner</span><span class="o">&gt;</span> <span class="n">joinedAggModuleWithAggPanel</span> <span class="o">=</span>
    <span class="n">aggPowerPerSolarModuleStream</span>
        <span class="o">.</span><span class="na">map</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">KeyValue</span><span class="o">.</span><span class="na">pair</span><span class="o">(</span><span class="k">new</span> <span class="nc">Windowed</span><span class="o">&lt;&gt;(</span><span class="n">k</span><span class="o">.</span><span class="na">key</span><span class="o">().</span><span class="na">getPanelName</span><span class="o">(),</span> <span class="n">k</span><span class="o">.</span><span class="na">window</span><span class="o">()),</span> <span class="n">v</span><span class="o">))</span>
        <span class="o">.</span><span class="na">join</span><span class="o">(</span>
            <span class="n">aggPowerPerSolarPanelFinalStream</span><span class="o">,</span>
            <span class="nl">SolarModuleAggregatorJoiner:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span> <span class="no">JOIN_WINDOWS</span><span class="o">,</span>
            <span class="nc">Joined</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="no">WINDOWED_STRING_SERDE</span><span class="o">,</span> <span class="no">SOLAR_MODULE_AGGREGATOR_SERDE</span><span class="o">,</span> <span class="no">SOLAR_PANEL_AGGREGATOR_SERDE</span><span class="o">));</span>


<span class="c1">// streaming result data (modules with anomaly power value)</span>
<span class="n">joinedAggModuleWithAggPanel</span>
    <span class="o">.</span><span class="na">filter</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">isAnomalyModule</span><span class="o">(</span><span class="n">v</span><span class="o">))</span>
    <span class="o">.</span><span class="na">map</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">KeyValue</span><span class="o">.</span><span class="na">pair</span><span class="o">(</span><span class="n">k</span><span class="o">.</span><span class="na">key</span><span class="o">(),</span> <span class="n">v</span><span class="o">))</span>
    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="no">OUT_TOPIC</span><span class="o">,</span> <span class="nc">Produced</span><span class="o">.</span><span class="na">valueSerde</span><span class="o">(</span><span class="no">SOLAR_MODULE_AGGREGATOR_JOINER_SERDE</span><span class="o">));</span>


<span class="c1">// starting streams</span>
<span class="kd">final</span> <span class="nc">KafkaStreams</span> <span class="n">streams</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">KafkaStreams</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">(),</span> <span class="n">getProperties</span><span class="o">());</span>
<span class="n">streams</span><span class="o">.</span><span class="na">cleanUp</span><span class="o">();</span>
<span class="n">streams</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">addShutdownHook</span><span class="o">(</span><span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="nl">streams:</span><span class="o">:</span><span class="n">close</span><span class="o">));</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Calculating anomaly data</strong></p>

<p><img src="/images/user-guide/integrations/kafka/latex.png" alt="image" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isAnomalyModule</span><span class="o">(</span><span class="nc">SolarModuleAggregatorJoiner</span> <span class="n">module</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">double</span> <span class="n">currentZ</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">module</span><span class="o">.</span><span class="na">getSumPower</span><span class="o">()</span> <span class="o">-</span> <span class="n">module</span><span class="o">.</span><span class="na">getSolarPanelAggregator</span><span class="o">().</span><span class="na">getAvgPower</span><span class="o">())</span> <span class="o">/</span> <span class="n">module</span><span class="o">.</span><span class="na">getSolarPanelAggregator</span><span class="o">().</span><span class="na">getDeviance</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">currentZ</span> <span class="o">&gt;</span> <span class="no">Z</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Sample application output</strong></p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>...SolarConsumer - PerSolarModule: [1572447720|Panel 1|Module 1]: 30.0:6
...SolarConsumer - PerSolarModule: [1572447720|Panel 1|Module 2]: 30.0:6
...SolarConsumer - PerSolarModule: [1572447720|Panel 1|Module 3]: 21.0:6
...SolarConsumer - PerSolarPanel: [1572447690|Panel 1]: 81.0:3
...SolarConsumer - PerSolarPanelFinal: [1572447660|Panel 1]: power:81.0 count:3 squareSum:54.0 variance:18.0 deviance:4.2
...SolarConsumer - ANOMALY module: [1572447660|Panel 1|Module 3]: sumPower:21.0 panelAvg:27.0 deviance:4.2
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-configure-the-kafka-integration">Step 3. Configure the Kafka Integration.</h3>

<p>Let’s configure ThingsBoard to subscribe to the “solar-module-anomalies” topic and create alarms. We will use Kafka Integration that is available since ThingsBoard v2.4.2.</p>

<h4 id="configure-uplink-converter">Configure Uplink Converter</h4>

<p>Before setting up a Kafka integration, you need to create the Uplink data converter. The uplink data converter is responsible for parsing the incoming anomalies data.</p>

<p>Example of the incoming message that is produced by our Kafka Streams application:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"moduleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Module 3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"panelName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Panel 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sumPower"</span><span class="p">:</span><span class="w"> </span><span class="mf">21.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"avgPower"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.5</span><span class="p">,</span><span class="w">
    </span><span class="nl">"solarPanelAggregator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"panelName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Panel 1"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="nl">"sumPower"</span><span class="p">:</span><span class="w"> </span><span class="mf">81.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"avgPower"</span><span class="p">:</span><span class="w"> </span><span class="mf">27.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"squaresSum"</span><span class="p">:</span><span class="w"> </span><span class="mf">54.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"variance"</span><span class="p">:</span><span class="w"> </span><span class="mf">18.0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"deviance"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.2</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>See the following script that is pasted to the Decoder function section:</p>

<div class="language-javascript copy-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="c1">// Decode an uplink message from a buffer</span>
<span class="c1">// payload - array of bytes</span>
<span class="c1">// metadata - key/value object</span>

<span class="cm">/** Decoder **/</span>

<span class="c1">// decode payload to string</span>
<span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">decodeToJson</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>

<span class="c1">// decode payload to JSON</span>
<span class="c1">// var data = decodeToJson(payload);</span>

<span class="kd">var</span> <span class="nx">deviceName</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">moduleName</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">deviceType</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">module</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Result object with device attributes/telemetry data</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
   <span class="na">deviceName</span><span class="p">:</span> <span class="nx">deviceName</span><span class="p">,</span>
   <span class="na">deviceType</span><span class="p">:</span> <span class="nx">deviceType</span><span class="p">,</span>
   <span class="na">attributes</span><span class="p">:</span> <span class="p">{</span>
       <span class="na">panel</span><span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">panelName</span>
   <span class="p">},</span>
   <span class="na">telemetry</span><span class="p">:</span> <span class="p">{</span>
       <span class="na">avgPower</span><span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">avgPower</span><span class="p">,</span>
       <span class="na">sumPower</span><span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sumPower</span><span class="p">,</span>
       <span class="na">avgPowerFromPanel</span><span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">solarPanelAggregator</span><span class="p">.</span><span class="nx">avgPower</span><span class="p">,</span>
       <span class="na">deviance</span><span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">solarPanelAggregator</span><span class="p">.</span><span class="nx">deviance</span>
   <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/** Helper functions **/</span>

<span class="kd">function</span> <span class="nx">decodeToString</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nb">String</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">decodeToJson</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// covert payload to string.</span>
   <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">decodeToString</span><span class="p">(</span><span class="nx">payload</span><span class="p">);</span>

   <span class="c1">// parse string to JSON</span>
   <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
   <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The purpose of the decoder function is to parse the incoming data and metadata to a format that ThingsBoard can consume. 
<strong>deviceName</strong> and <strong>deviceType</strong> are required, while <strong>attributes</strong> and <strong>telemetry</strong> are optional.
<strong>Attributes</strong> and <strong>telemetry</strong> are flat key-value objects. Nested objects are not supported.</p>

<p><img src="/images/samples/analytics/kafka-streams/add-converter.png" alt="image" /></p>

<h4 id="configure-kafka-integration">Configure Kafka Integration</h4>

<p>Let’s create kafka integration that will subscribe to “solar-module-anomalies” topic.</p>

<p><img src="/images/samples/analytics/kafka-streams/add-integration.png" alt="image" /></p>

<h3 id="step-4-configure-rule-engine-to-raise-alarms">Step 4. Configure Rule Engine to raise Alarms.</h3>

<p>Follow existing “<a href="/docs/user-guide/rule-engine-2-0/tutorials/create-clear-alarms/">Create and Clear Alarms</a>” guide to raise the alarm 
based on the “anomaly” boolean flag in the incoming telemetry and use 
“<a href="/docs/user-guide/rule-engine-2-0/tutorials/send-email/">Send email on alarm</a>” guide to send email notifications.
Explore other <a href="/docs/guides/">guides</a> to learn mode.</p>

<h3 id="step-5-remove-debug-messages-logging">Step 5. Remove debug messages logging</h3>

<p>Although the Debug mode is very useful for development and troubleshooting, leaving it enabled in production mode may tremendously increase the disk space, used by the database, because all the debugging data is stored there. 
It is highly recommended to turn the Debug mode off when done debugging.</p>

<h2 id="next-steps">Next steps</h2>

<ul>
  <li>
    <p><a href="/docs/guides#AnchorIDGettingStartedGuides">Getting started guides</a> - These guides provide quick overview of main ThingsBoard features. Designed to be completed in 15-30 minutes.</p>
  </li>
  <li>
    <p><a href="/docs/user-guide/install/installation-options/">Installation guides</a> - Learn how to setup ThingsBoard on various available operating systems.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDDataVisualization">Data visualization</a> - These guides contain instructions how to configure complex ThingsBoard dashboards.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDDataProcessing">Data processing &amp; actions</a> - Learn how to use ThingsBoard Rule Engine.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDDataAnalytics">IoT Data analytics</a> - Learn how to use rule engine to perform basic analytics tasks.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDHardwareSamples">Hardware samples</a> - Learn how to connect various hardware platforms to ThingsBoard.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDAdvancedFeatures">Advanced features</a> - Learn about advanced ThingsBoard features.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDContribution">Contribution and Development</a> - Learn about contribution and development in ThingsBoard.</p>
  </li>
</ul>

<p><br /></p>


      </div>
      <footer>
	<main class="light-text">
		<div class="newsletterSubsContainer">
            <script type="text/javascript">
                function subscribeForNewsletter(event) {
                    event.stopPropagation();
                    var script_tag = document.createElement('script');
                    script_tag.setAttribute("type", "text/javascript");
                    script_tag.setAttribute("src", "https://static.mailerlite.com/js/w/webforms.min.js?v28bf44f740701752bfc6767bc7e171d4");
                    document.getElementsByTagName("head")[0].appendChild(script_tag);
                    $(event.target).css('display', 'none');
                    $('#mlb2-7341216').css('display', 'block');
                }
            </script>
            <button class="n-button price subscribe" onClick="subscribeForNewsletter(event)">Sign up for ThingsBoard news</button>
            <div id="mlb2-7341216" class="ml-subscribe-form ml-subscribe-form-7341216" style="display: none;">
<!--            <div id="mlb2-7341216" class="ml-subscribe-form ml-subscribe-form-7341216" style="display: block;">-->
                <div class="ml-vertical-align-center">
                    <div class="subscribe-form ml-block-success" style="display: none;">
                        <div class="form-section">
                            <p>Thank you for your interest in ThingsBoard!<br/>Have a great day!</p>
                        </div>
                    </div>
                    <form class="ml-block-form" action="https://static.mailerlite.com/webforms/submit/r9r9x7" data-id="708170" data-code="r9r9x7" method="POST" target="_blank">
                        <div class="subscribe-form horizontal">
                            <div class="form-section horizontal">
                                <div class="form-group ml-field-email ml-validate-required ml-validate-email">
                                    <input type="email" name="fields[email]" class="form-control" placeholder="Email address*" value="" autocomplete="email" x-autocompletetype="email" spellcheck="false" autocapitalize="off" autocorrect="off">
                                </div>
                            </div>
                            <input type="hidden" name="ml-submit" value="1">
                            <div class="form-section horizontal ml-button-position">
                                <button class="primary n-button price subscribe" type="submit">
                                    Subscribe
                                </button>
                                <button disabled="disabled" style="display: none;" type="button" class="n-button loading">
                                    <img src="https://static.mailerlite.com/images/rolling@2x.gif" width="20" height="20" style="width: 20px; height: 20px;">
                                </button>
                            </div>
                            <p>By subscribing you agree to receive newsletters from ThingsBoard, Inc.</p>
                        </div>
                    </form>
                </div>
            </div>
		</div>

        <hr>

        <div class="deeper">
            <a href="/" class="footer-logo"></a>
            <nav>
                <a href="/docs/getting-started-guides/helloworld/">Get Started</a>
                <a href="/docs/">Documentation</a>
                <a href="/iot-use-cases/">Use cases</a>
                <a href="https://blog.thingsboard.io/">Blog</a>
                <a href="/docs/services/">Services</a>
                <a href="/docs/contact-us/">Contact us</a>
            </nav>
        </div>

        <div class="deepmost">
            <div class="copyright">&copy; 2021 The ThingsBoard Authors</div>
            <div class="social">
                <a href="https://github.com/thingsboard/thingsboard" class="github"></a>
                <a href="https://gitter.im/thingsboard/chat" class="gitter"></a>
                <a href="https://www.youtube.com/thingsboard" class="youtube"></a>
                <a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"></a>
                <a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"></a>
                <a href="https://www.facebook.com/thingsboard" class="facebook"></a>
                <a href="https://twitter.com/thingsboard" class="twitter"></a>
            </div>
        </div>
	</main>
</footer>

  </div>
</section>

<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
<script>
    jqueryDefer(function () {
        $(document).on('selectionchange',function() {
        // $(document).mouseup(function () {
            $('.clipboard-btn').removeClass('noChars');
            var selectedChars = getSelectedText();
            // $('#numberChars').html(selectedChars.length);
            if (selectedChars == 0) {
                $('.clipboard-btn').addClass('noChars');
            }
        });
    });
    function getSelectedText() {
        var text;
        if (window.getSelection) {
            text = window.getSelection().toString();
        } else if (document.getSelection) {
            text = document.getSelection();
        } else if (document.selection) {
            text = document.selection.createRange().text;
        }
        return text;
    }
</script>
<script>
    jqueryDefer(function () {
        $(document).ready(function () {
            var allCodeBlocksElements = $(".copy-code");
            allCodeBlocksElements.each(function (i) {
                var codeBlock = $(this);
                if (!codeBlock.hasClass('highlighter-rouge')) {
                    codeBlock = codeBlock.find('.highlighter-rouge');
                }
                codeBlock.each(function () {
                    var block = codeBlock.find('pre.highlight > code .rouge-code');
                    var currentId = "codeblock" + (i + 1);
                    block.attr('id', currentId);
                    var clipButton = $('<button class="clipboard-btn" data-clipboard-target="#' + currentId + '"><p>Copy to clipboard</p><div><img src="/images/copy-code-icon.svg" alt="Copy to clipboard"></div></button>');
                    $(this).append(clipButton);
                    var troyan = codeBlock.find('pre.highlight');
                    var Tooltip = $('<div class="customTooltip"><div class="tooltipText">Copied!</div></div>');
                    troyan.append(Tooltip);
                    troyan.addClass('clipboard-btn');
                    troyan.attr('data-clipboard-target', "#" + currentId);
                    troyan.on('mouseleave', clearTooltip);
                    troyan.on('blur', clearTooltip);
                    troyan.on('click', function(e) {
                        var el = $(e.currentTarget);
                        if (el.hasClass('showTool')) {
                            clearTooltip(e);
                            troyan.attr('data-skip-tooltip', "true");
                        }
                    });
                });
            });

            var clipboard = new Clipboard('.noChars');
            clipboard.on('success', function (e) {
                $('.clipboard-btn').removeClass('noChars');
                e.clearSelection();
                var trigger = e.trigger;
                if (!$(trigger).attr('data-skip-tooltip')) {
                    showTooltip(e.trigger, 'Copied!');
                } else {
                    $(trigger).removeAttr('data-skip-tooltip');
                }
            });

            $('#search').focus(
                function(){
                    $(this).parent('#searchBox').addClass('focused');
                }).blur(
                function(){
                    $(this).parent('#searchBox').removeClass('focused');
                });

            $('#searchBox .searchButton').click(function () {
                var value = $('#search').val();
                window.location.replace('/docs/search/?q=' + value);
            });

            $('#docsBreadcrumbs').click(function () {
                if ($(this).hasClass('active')) {
                    $(this).removeClass('active');
                    $('#docsNav').removeClass('active');
                    $('#searchBox').removeClass('visible');
                } else {
                    $(this).addClass('active');
                    $('#docsNav').addClass('active');
                    $('#searchBox').addClass('visible');
                }
            });
        });

        function clearTooltip(e) {
            var el = $(e.currentTarget);
            el.removeClass('showTool');
            el.attr('aria-label', null);
        }

        function showTooltip(elem, msg) {
            var el = $(elem);
            el.addClass('showTool');
            el.attr('aria-label', msg);
        }
    });
</script>

<script>
    jqueryDefer(function () {
        var markdownTocs = null;
        var contentAnchors = [];
        var activeAnchor = null;
        var firstAnchor = null;
        var lastAnchor = null;

        function updatePositions() {
            contentAnchors = [];
            markdownTocs.each(function (i) {
                var tocAnchor = $(this).children('a');
                var href = tocAnchor.attr('href');
                var contentAnchor = $('div#content ' + href);
                var top = Math.floor(contentAnchor.offset().top);
                var bottom;
                if (i < markdownTocs.length - 1) {
                    var nextHref = $(markdownTocs[i + 1]).children('a').attr('href');
                    var nextContentAnchor = $('div#content ' + nextHref);
                    bottom = Math.floor(nextContentAnchor.offset().top);
                } else {
                    bottom = $('div#content').offset().top + $('div#content').innerHeight();
                }
                var contentAnchorInfo = {anchor: contentAnchor, toc: $(this), top: top, bottom: bottom, href: href};
                contentAnchors.push(contentAnchorInfo);
                if (i === 0) {
                    firstAnchor = contentAnchorInfo;
                }
                if (i === markdownTocs.length - 1) {
                    lastAnchor = contentAnchorInfo;
                }
            });
        }

        function findActiveContentToc() {
            var top = $(window).scrollTop();
            var bottom = top + $(window).height();
            if (bottom === $('#encyclopedia').offset().top + $('#encyclopedia').innerHeight()) {
                return lastAnchor;
            } else {
                bottom -= 154;
                for (var i = 0; i < contentAnchors.length; i++) {
                    var contentAnchor = contentAnchors[i];
                    if (contentAnchor.top <= bottom &&
                        contentAnchor.bottom > top) {
                        return contentAnchor;
                    }
                }
            }
            return firstAnchor;
        }

        function updateActiveToc(init) {
            updatePositions();
            var newActiveAnchor = findActiveContentToc();
            if (!activeAnchor || newActiveAnchor.href !== activeAnchor.href) {
                activeAnchor = newActiveAnchor;
                markdownTocs.removeClass('active');
                activeAnchor.toc.addClass('active');
                var tocTop = $('#table-of-contents').scrollTop() + 100;
                var tocBottom = tocTop + $('#table-of-contents').innerHeight() - 200;
                var activeTocTop = activeAnchor.toc.position().top;
                var activeTocBottom = activeTocTop + activeAnchor.toc.children(':first').height();
                if (tocTop > activeTocTop) {
                    activeAnchor.toc[0].scrollIntoView();
                    $('#table-of-contents')[0].scrollTop -= 100;
                } else if (tocBottom < activeTocBottom) {
                    activeAnchor.toc[0].scrollIntoView();
                    $('#table-of-contents')[0].scrollTop += init ? -100 : 100;
                }
            }
        }
        $( document ).ready(function() {
            var tocs = $('#content > ul#markdown-toc');
            var tableOfContents = $('#table-of-contents');
            tableOfContents.append(tocs);
            markdownTocs = $('#table-of-contents ul#markdown-toc li').filter(function() {
                var tocAnchor = $(this).children('a');
                var href = tocAnchor.attr('href');
                if (!href.startsWith('#')) {
                    return false;
                } else {
                    var contentAnchor = $('div#content ' + href);
                    return contentAnchor.length > 0;
                }
            });
            updateActiveToc(true);
        });

        $(document).on("scroll", function() {
            updateActiveToc(false);
        });

    });
</script>

</body>
</html>

