







<!Doctype html>
<html id="docs" class="">







<head>
    <meta charset="utf-8">
    <meta name="cf-2fa-verify" content="a08672380de15e9">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Temperature and humidity upload over MQTT using Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and Bluetooth Low Energy | ThingsBoard Community Edition</title>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Temperature and humidity upload over MQTT using Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and Bluetooth Low Energy" />
<meta name="author" content="thingsboard" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ThingsBoard IoT Platform sample for Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and temperature/humidity monitor using Bluetooth Low Energy" />
<meta property="og:description" content="ThingsBoard IoT Platform sample for Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and temperature/humidity monitor using Bluetooth Low Energy" />
<link rel="canonical" href="http://0.0.0.0:4002/docs/samples/ble/raspberry-esp32-xiaomi-sensor-htu21d/" />
<meta property="og:url" content="http://0.0.0.0:4002/docs/samples/ble/raspberry-esp32-xiaomi-sensor-htu21d/" />
<meta property="og:site_name" content="ThingsBoard" />
<meta property="og:image" content="http://0.0.0.0:4002/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://0.0.0.0:4002/images/thingsboard_logo.png" />
<meta property="twitter:title" content="Temperature and humidity upload over MQTT using Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and Bluetooth Low Energy" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
{"url":"http://0.0.0.0:4002/docs/samples/ble/raspberry-esp32-xiaomi-sensor-htu21d/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4002/images/thingsboard_logo.png"},"name":"thingsboard"},"author":{"@type":"Person","name":"thingsboard"},"image":{"twitter":"/images/thingsboard_logo.png","facebook":"/images/thingsboard_logo.png","url":"http://0.0.0.0:4002/images/thingsboard_logo.png","@type":"imageObject"},"description":"ThingsBoard IoT Platform sample for Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and temperature/humidity monitor using Bluetooth Low Energy","@type":"WebPage","headline":"Temperature and humidity upload over MQTT using Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and Bluetooth Low Energy","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
    
    <meta name="twitter:description" content="ThingsBoard IoT Platform sample for Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and temperature/humidity monitor using Bluetooth Low Energy"/>
    
    
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.7.0/qs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gifffer/1.5.0/gifffer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            Gifffer();
        }
    </script>
    <script type="text/javascript">
        /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
        !function (a) {
            "use strict";
            var b = function (b, c, d) {
                function e(a) {
                    return h.body ? a() : void setTimeout(function () {
                        e(a)
                    })
                }

                function f() {
                    i.addEventListener && i.removeEventListener("load", f), i.media = d || "all"
                }

                var g, h = a.document, i = h.createElement("link");
                if (c) g = c; else {
                    var j = (h.body || h.getElementsByTagName("head")[0]).childNodes;
                    g = j[j.length - 1]
                }
                var k = h.styleSheets;
                i.rel = "stylesheet", i.href = b, i.media = "only x", e(function () {
                    g.parentNode.insertBefore(i, c ? g : g.nextSibling)
                });
                var l = function (a) {
                    for (var b = i.href, c = k.length; c--;) if (k[c].href === b) return a();
                    setTimeout(function () {
                        l(a)
                    })
                };
                return i.addEventListener && i.addEventListener("load", f), i.onloadcssdefined = l, l(f), i
            };
            "undefined" != typeof exports ? exports.loadCSS = b : a.loadCSS = b
        }("undefined" != typeof global ? global : this);

        /*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
        function onloadCSS(a, b) {
            function c() {
                !d && b && (d = !0, b.call(a))
            }

            var d;
            a.addEventListener && a.addEventListener("load", c), a.attachEvent && a.attachEvent("onload", c), "isApplicationInstalled" in navigator && "onloadcssdefined" in a && a.onloadcssdefined(c)
        }
    </script>
    <script type="text/javascript">

        function jqueryDefer(method) {
            if (window.jQuery) {
                method();
            } else {
                setTimeout(function () {
                    jqueryDefer(method)
                }, 50);
            }
        }

        function jqueryUiDefer(method) {
            if (window.jQuery && window.jQuery.ui) {
                method();
            } else {
                setTimeout(function () {
                    jqueryUiDefer(method)
                }, 50);
            }
        }

        window.vis = (function () {
            var stateKey,
                eventKey,
                keys = {
                    hidden: "visibilitychange",
                    webkitHidden: "webkitvisibilitychange",
                    mozHidden: "mozvisibilitychange",
                    msHidden: "msvisibilitychange"
                };
            for (stateKey in keys) {
                if (stateKey in document) {
                    eventKey = keys[stateKey];
                    break;
                }
            }
            return function (c) {
                if (c) document.addEventListener(eventKey, c);
                return !document[stateKey];
            }
        })();

        function loadScript(src, callback) {
            var s, r, t;
            r = false;
            s = document.createElement('script');
            s.type = 'text/javascript';
            s.src = src;
            s.onload = s.onreadystatechange = function () {
                if (!r && (!this.readyState || this.readyState == 'complete')) {
                    r = true;
                    if (callback) {
                        callback();
                    }
                }
            };
            t = document.getElementsByTagName('script')[0];
            t.parentNode.insertBefore(s, t);
        }

        function loadCssAsync(src, callback) {
            var stylesheet = loadCSS(src);
            if (callback) {
                onloadCSS(stylesheet, callback);
            }
        }

        function loadNextScript(index, scriptsList, completeCallback) {
            if (index < scriptsList.length) {
                var script = scriptsList[index];
                if (script.type === 'script') {
                    loadScript(script.src, function () {
                        if (script.callback) {
                            script.callback();
                        }
                        index++;
                        loadNextScript(index, scriptsList, completeCallback);
                    });
                } else if (script.type === 'css') {
                    loadCssAsync(script.src, function () {
                        index++;
                        loadNextScript(index, scriptsList, completeCallback);
                    });
                }
            } else if (completeCallback) {
                completeCallback();
            }
        }

        var initialScriptsList = [
            {src: '/js/jquery-2.2.0.min.js', type: 'script'},
            {src: '/css/jquery-ui.min.css', type: 'css'},
            {src: '/js/jquery-ui.min.js', type: 'script'},
            {src: '/js/jquery.vide.js', type: 'script'},
            {src: '/js/script.js', type: 'script'},
            {src: '/css/photoswipe.css', type: 'css'},
            {src: '/css/default-skin/default-skin.css', type: 'css'},
            {src: '/js/photoswipe.min.js', type: 'script'},
            {src: '/js/photoswipe-ui-default.min.js', type: 'script'}
        ];

        loadNextScript(0, initialScriptsList);

        jqueryDefer(function () {
            (function ($, win) {
                $.fn.inViewport = function (cb) {
                    return this.each(function (i, el) {
                        function visPx() {
                            var H = $(this).height(),
                                r = el.getBoundingClientRect(), t = r.top, b = r.bottom;
                            var result = cb.call(el, Math.max(0, t > 0 ? H - t : (b < H ? b : H)));
                            if (result) {
                                $(win).off("resize scroll", visPx);
                            }
                        }

                        visPx();
                        $(win).on("resize scroll", visPx);
                    });
                };
            }(jQuery, window));
        });

        function inViewportDefer(method) {
            if (window.jQuery && $.fn.inViewport) {
                method();
            } else {
                setTimeout(function () {
                    inViewportDefer(method)
                }, 50);
            }
        }

    </script>
    <script type="text/javascript">
        function _gaLt(event) {
            /* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
            if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
                return;
            }
            var el = event.srcElement || event.target;

            while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
                el = el.parentNode;
            }
            if (el && el.href) {
                var link = el.href;
                if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
                    var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
                    if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
                        target = "_blank";
                    }

                    var hbrun = false; // tracker has not yet run
                    var hitBack = function () {
                        if (hbrun) return;
                        hbrun = true;
                        window.location.href = link;
                    };

                    if (target) {
                        ga(
                            "send", "event", "Outgoing Links", link,
                            document.location.pathname + document.location.search
                        );
                    } else {
                        event.preventDefault ? event.preventDefault() : event.returnValue = !1;
                        ga(
                            "send", "event", "Outgoing Links", link,
                            document.location.pathname + document.location.search, {
                                "hitCallback": hitBack
                            }
                        );

                        setTimeout(hitBack, 1000);
                    }
                }
            }
        }

        var _w = window;
        var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
        _w.addEventListener ? _w.addEventListener("load", function () {
                document.body.addEventListener(_gaLtEvt, _gaLt, !1)
            }, !1)
            : _w.attachEvent && _w.attachEvent("onload", function () {
            document.body.attachEvent("on" + _gaLtEvt, _gaLt)
        });
    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-88383331-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script>
        function Burger() {
            var header = $('header');
            var body = $('body');
            if (header.hasClass('opened-burger')) {
                header.removeClass('opened-burger');
                let subMenus = $('nav.head-menu > ul > li > div.centered-sub > ul.sub-menu');
                subMenus.removeClass('open-sub');
                body.css('overflow', '');
            } else {
                header.addClass('opened-burger');
                body.css('overflow', 'hidden');
            }
        }
    </script>
    <script>

        jqueryDefer(function () {
            let menuElement = $('nav.head-menu > ul');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            let menuItems = $('nav.head-menu > ul > li');
            let indicator = $('nav.head-menu > ul > div.indicator');
            let subMenuActive = false;
            menuElement.on('mouseleave', function (event) {
                if (!$(event.relatedTarget).parents('div.sub-menu-container').length) {
                    subMenuActive = false;
                    submenuContainer.removeClass('active bounds-transition');
                    menuItems.removeClass('active');
                    indicator.removeClass('left-transition');
                }
            });
            submenuContainer.on('mouseleave', function (event) {
                if (!$(event.relatedTarget).parents('nav.head-menu > ul').length) {
                    subMenuActive = false;
                    submenuContainer.removeClass('active bounds-transition');
                    menuItems.removeClass('active');
                    indicator.removeClass('left-transition');
                }
            });
            menuItems.each(function() {
                let item = $( this );
                let subMenuId = item.attr('data-submenu-id');
                item.on('mouseenter', function () {
                    let submenus = $('nav.head-menu > div.sub-menu-container > div');
                    submenus.css('display', 'none');
                    menuItems.removeClass('active');
                    item.addClass('active');
                    let targetSubMenu = $('nav.head-menu > div.sub-menu-container > div#'+subMenuId);
                    targetSubMenu.css('display', 'block');
                    submenuContainer.css('overflow', 'visible');
                    let left = item.position().left + (item.outerWidth() - targetSubMenu.outerWidth()) / 2;
                    submenuContainer.css('left', left + 'px');
                    if (!subMenuActive) {
                        submenuContainer.addClass('active');
                        subMenuActive = true;
                    } else {
                        submenuContainer.addClass('bounds-transition');
                        indicator.addClass('left-transition');
                    }
                    indicator.css('left', item.position().left);
                    indicator.css('width', item.outerWidth());
                    submenuContainer.css('height', targetSubMenu.outerHeight() + 'px');
                    submenuContainer.css('width', targetSubMenu.outerWidth() + 'px');
                    submenuContainer.css('overflow', 'hidden');
                });
            });

            let isMobile = $('button.burger').css('display') === 'block';
            if (isMobile) {
                initMobileSubmenu();
            }

            $(window).resize(function(){
                let newIsMobile = $('button.burger').css('display') === 'block';
                if (isMobile !== newIsMobile) {
                    isMobile = newIsMobile;
                    if (isMobile) {
                        initMobileSubmenu();
                    } else {
                        restoreDesktopSubmenu();
                    }
                }
            });

            // Products selector

            
            let productsSelector = $('.products-selector');
            $(window).click(function(e) {
                if (productsSelector[0].contains(e.target)) {
                    if (productsSelector.hasClass('active')) {
                        productsSelector.removeClass('active');
                    } else {
                        productsSelector.addClass('active');
                    }
                } else {
                    productsSelector.removeClass('active');
                }
            });
            

            // Rogue line numbers fix (don't show line numbers for 1 row)
            $( document ).ready(function() {
                $('.rouge-gutter.gl').each(function() {
                    var lineNumbers = $(this).children('.lineno');
                    if (lineNumbers.text() === '1\n') {
                        $(this).css('display', 'none');
                    }
                });
            });
        });

        function initMobileSubmenu() {

            var header = $('header');
            if (header.hasClass('opened-burger')) {
                var body = $('body');
                body.css('overflow', 'hidden');
            }

            let targetSubMenus = $('nav.head-menu > div.sub-menu-container > div');
            targetSubMenus.css('display', 'block');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            submenuContainer.removeClass('active');
            submenuContainer.css('display', 'none');

            targetSubMenus.each(function() {
                let subMenu = $( this );
                let subMenuId = subMenu.attr('id');
                let parent = $('nav.head-menu > ul > li.'+subMenuId);
                parent.append(subMenu);
            });
        }

        function restoreDesktopSubmenu() {
            var body = $('body');
            body.css('overflow', '');
            let targetSubMenus = $('nav.head-menu > ul > li > div');
            let submenuContainer = $('nav.head-menu > div.sub-menu-container');
            submenuContainer.removeClass('active');
            submenuContainer.css('display', 'block');
            let menuItems = $('nav.head-menu > ul > li');
            menuItems.removeClass('active');
            targetSubMenus.each(function() {
                let subMenu = $( this );
                submenuContainer.append(subMenu);
            });
        }

        function listburg(subMenuId) {
            let isMobile = $('button.burger').css('display') === 'block';
            if (isMobile) {
                let targetSubMenu = $('nav.head-menu > ul > li > div.centered-sub#'+subMenuId+' > ul.sub-menu');
                let isOpen = targetSubMenu.hasClass('open-sub');
                let subMenus = $('nav.head-menu > ul > li > div.centered-sub > ul.sub-menu');
                subMenus.removeClass('open-sub');
                if (!isOpen) {
                    targetSubMenu.addClass('open-sub');
                }
            }
        }
    </script>
</head>
<body>

<div class="products-selector">
    <img src="/images/thingsboard-cm-icon.svg"/>
    <div class="product-info">
        <div class="product-title">
            Community Edition
        </div>
        <div class="product-description">
            ThingsBoard Documentation
        </div>
    </div>
    <div class="products">
        
        

    
        
        


        
    


        <a href="/docs/paas/" class="product">Cloud</a>
        
        

    
        
        


        
    


        <a href="/docs/pe/" class="product">Professional Edition</a>
        
        

    
        
        


        
            
        
    


        <a href="/docs/samples/ble/raspberry-esp32-xiaomi-sensor-htu21d/" class="product active">Community Edition</a>
        
        

    


        <a href="/docs/edge/" class="product">Edge</a>
        
        

    


        <a href="/docs/iot-gateway/" class="product">IoT Gateway</a>
        
        

    


        <a href="/products/license-server/" class="product">License Server</a>
        
        

    


        <a href="/docs/trendz/" class="product">Trendz Analytics</a>
        
    </div>
</div>

<header>
    <div class="logo-burger">
        
        <button onclick="Burger()" class="burger"></button>
        <div id="githubButtonContainer">
            <a class="github-button" href="https://github.com/thingsboard/thingsboard" data-show-count="true"
               aria-label="Star thingsboard/thingsboard on GitHub">Star</a>
        </div>
    </div>
    <nav class="head-menu">
        <ul>
            <li class="nav-products" data-submenu-id="nav-products">
                <a onclick="listburg('nav-products')">Products</a>
            </li>
            <li class="nav-services" data-submenu-id="nav-services">
                <a onclick="listburg('nav-services')">Services</a>
            </li>
            
            <li class="nav-cases" data-submenu-id="nav-cases">
                <a onclick="listburg('nav-cases')">Use Cases</a>
            </li>
            <li class="nav-customers" data-submenu-id="nav-customers">
                <a onclick="listburg('nav-customers')">Customers</a>
            </li>
            <li class="nav-company" data-submenu-id="nav-company">
                <a onclick="listburg('nav-company')">Company</a>
            </li>
            <div class="indicator"><div class="head-arrow"></div><div class="line"></div><div class="sub-background"></div></div>
        </ul>
        <div class="sub-menu-container">
            <div id="nav-products" class="centered-sub">
                <ul class="sub-menu products">
                    <div class="sub-groups">
                        <div class="group">
                            <p class="group-name">IoT platforms</p>
                            <a class="cloud-lnk" href="/products/paas/">
                                <img src="/images/thingsboard-c-icon.svg">
                                <div class="sub-text">
                                    <h1>Cloud</h1>
                                    <p>Platform as a service</p>
                                </div>
                            </a>
                            <a class="prof-lnk" href="/products/thingsboard-pe/">
                                <img src="/images/thingsboard-p-icon.svg">
                                <div class="sub-text">
                                    <h1>Professional Edition</h1>
                                    <p>Advanced IoT platform</p>
                                </div>
                            </a>
                            <a class="com-lnk" href="/">
                                <img src="/images/thingsboard-cm-icon.svg">
                                <div class="sub-text">
                                    <h1>Community Edition</h1>
                                    <p>Open source platform</p>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <p class="group-name">Product ecosystem</p>
                            <a class="edge-lnk" href="/products/thingsboard-edge/">
                                <img src="/images/thingsboard-e-icon.svg">
                                <div class="sub-text">
                                    <h1>Edge</h1>
                                    <p>Edge computing</p>
                                </div>
                            </a>
                            <a class="gateway-lnk" href="/docs/iot-gateway/what-is-iot-gateway/">
                                <img src="/images/gateway-icon.svg">
                                <div class="sub-text">
                                    <h1>IoT Gateway</h1>
                                    <p>Connect legacy protocols</p>
                                </div>
                            </a>
                            <a class="license-lnk" href="/products/license-server/">
                                <img src="/images/license-icon.svg">
                                <div class="sub-text">
                                    <h1>License Server</h1>
                                    <p>Billing solution</p>
                                </div>
                            </a>
                            <a class="trendz-lnk" href="/products/trendz/">
                                <img src="/images/trendz-icon.svg">
                                <div class="sub-text">
                                    <h1>Trendz Analytics</h1>
                                    <p>Data analytics and Prediction</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </ul>
            </div>
            <div id="nav-services" class="centered-sub">
                <ul class="sub-menu services">
                    <a href="/docs/services/support/">
                        <img src="/images/support-icon.svg">
                        <div class="sub-text">
                            <h1>Support</h1>
                            <p>Support packages</p>
                        </div>
                    </a>
                    <a href="/docs/services/trainings/">
                        <img src="/images/train-icon.svg">
                        <div class="sub-text">
                            <h1>Trainings</h1>
                            <p>ThingsBoard education courses</p>
                        </div>
                    </a>
                    <a href="/docs/services/consulting/">
                        <img src="/images/prof-icon.svg">
                        <div class="sub-text">
                            <h1>Professional services</h1>
                            <p>Development of solutions by the ThingsBoard team</p>
                        </div>
                    </a>
                </ul>
            </div>
            
            <div id="nav-cases" class="centered-sub">
                <ul class="sub-menu cases">
                    <a href="/smart-metering/">
                        <img src="/images/case-met-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Metering</h1>
                            <p>Collection, analysis and visualization of data from meters</p>
                        </div>
                    </a>
                    <a href="/smart-energy/">
                        <img src="/images/case-eng-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Energy</h1>
                            <p>Energy monitoring and efficiency analysis</p>
                        </div>
                    </a>
                    <a href="/smart-farming/">
                        <img src="/images/case-fam-icon.svg">
                        <div class="sub-text">
                            <h1>Smart Farming</h1>
                            <p>Monitoring of indoor conditions and plant growth characteristics</p>
                        </div>
                    </a>
                    <a href="/fleet-tracking/">
                        <img src="/images/case-trk-icon.svg">
                        <div class="sub-text">
                            <h1>Fleet Tracking</h1>
                            <p>Fleet tracking and fleet management</p>
                        </div>
                    </a>
                </ul>
            </div>
            <div id="nav-customers" class="centered-sub">
                <ul class="sub-menu customers">
                    <div class="sub-groups">
                        <div class="group">
                            <a class="small-link" href="/industries/smart-energy/">
                                <img src="/images/se-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart Energy</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/agriculture/">
                                <img src="/images/agr-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Agriculture</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/smart-buildings/">
                                <img src="/images/sb-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart Buildings</h1>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <a class="small-link" href="/industries/smart-city/">
                                <img src="/images/sc-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Smart City</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/telecom/">
                                <img src="/images/tel-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Telecom</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/industries/industry40/">
                                <img src="/images/in-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Industry 4.0</h1>
                                </div>
                            </a>
                        </div>
                    </div>
                </ul>
            </div>
            <div id="nav-company" class="centered-sub">
                <ul class="sub-menu about">
                    <div class="sub-groups">
                        <div class="group">
                            <a class="small-link" href="/company/">
                                <img src="/images/about-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Our Company</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/docs/contact-us/">
                                <img src="/images/contact-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Contact Us</h1>
                                </div>
                            </a>
                            <a class="small-link" href="/careers/">
                                <img src="/images/careers-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Careers</h1>
                                </div>
                            </a>
                        </div>
                        <div class="group">
                            <a class="small-link" href="/mediakit/">
                                <img src="/images/media-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Media Kit</h1>
                                </div>
                            </a>
                            <a class="small-link" href="https://blog.thingsboard.io/">
                                <img src="/images/blog-s-icon.svg">
                                <div class="sub-text">
                                    <h1>Blog</h1>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="bottom-group">
                        <a class="small-link" href="/partners/hardware/">
                            <img src="/images/hard-s-icon.svg">
                            <div class="sub-text">
                                <h1>Hardware partners</h1>
                            </div>
                        </a>
                        <a class="small-link" href="/partners/distributors/">
                            <img src="/images/dis-s-icon.svg">
                            <div class="sub-text">
                                <h1>Distributors</h1>
                            </div>
                        </a>
                    </div>
                </ul>
            </div>
        </div>
    </nav>
    <div>
        <a href="/installations/" class="n-button try">Try it now</a>
        <a href="/pricing/" class="n-button price">Pricing</a>
    </div>
</header>


<div id="searchBox">
    <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    <button class="searchButton"></button>
</div>

<!--  HERO  -->
<section id="hero">
  <div id="hero-content">
    <div id="vendorStrip">
      <div id="docsList">
          <ul>
            
              
              
              
              <li>
                  <a href="/docs/getting-started-guides/helloworld/" >Getting Started</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/" >Documentation</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/guides/" >Guides</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/user-guide/install/installation-options/" >Installation</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/reference/" >Architecture</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/api/" >API</a>
                  
              </li>
            
              
              
              
              <li>
                  <a href="/docs/faq/" >FAQ</a>
                  
              </li>
            
          </ul>
          <div id="docsBreadcrumbs">
              
                <span class="item">Temperature and humidity upload over MQTT using Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and Bluetooth Low Energy</span>
              
          </div>
      </div>
    </div>
  </div>
</section>
<div id="docsNav">
    <div class="docItems">
        
            
            
                <a class="toc" href="/docs/getting-started-guides/helloworld/" >Getting Started</a>
            
        
            
            
                <a class="toc" href="/docs/" >Documentation</a>
            
        
            
            
                <a class="toc" href="/docs/guides/" >Guides</a>
            
        
            
            
                <a class="toc" href="/docs/user-guide/install/installation-options/" >Installation</a>
            
        
            
            
                <a class="toc" href="/docs/reference/" >Architecture</a>
            
        
            
            
                <a class="toc" href="/docs/api/" >API</a>
            
        
            
            
                <a class="toc" href="/docs/faq/" >FAQ</a>
            
        
    </div>
</div>








<section id="encyclopedia">
  
  <div id="docsContent" class="noToc hasTocContent">
      <div id="table-of-contents">
          
              <h4>On this page</h4>
          
      </div>
      <div id="top-spacer"></div>
      <h1>Temperature and humidity upload over MQTT using Raspberry Pi, ESP32 with HTU21D, Xiaomi sensor and Bluetooth Low Energy</h1>
      <div id="content">
          <ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#list-of-hardware" id="markdown-toc-list-of-hardware">List of hardware</a></li>
  <li><a href="#hardware-setup" id="markdown-toc-hardware-setup">Hardware setup</a>    <ul>
      <li><a href="#esp32-wiring-scheme" id="markdown-toc-esp32-wiring-scheme">ESP32 Wiring scheme</a></li>
      <li><a href="#raspberry-pi" id="markdown-toc-raspberry-pi">Raspberry Pi</a></li>
    </ul>
  </li>
  <li><a href="#preparing-esp32" id="markdown-toc-preparing-esp32">Preparing ESP32</a>    <ul>
      <li><a href="#application-capabilities" id="markdown-toc-application-capabilities">Application capabilities</a></li>
      <li><a href="#flashing-esp32-bt-firmware" id="markdown-toc-flashing-esp32-bt-firmware">Flashing ESP32 BT firmware</a>        <ul>
          <li><a href="#note" id="markdown-toc-note">Note</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#preparing-mi-sensor" id="markdown-toc-preparing-mi-sensor">Preparing MI Sensor</a></li>
  <li><a href="#preparing-raspberry-pi" id="markdown-toc-preparing-raspberry-pi">Preparing Raspberry Pi</a>    <ul>
      <li><a href="#implementation-details" id="markdown-toc-implementation-details">Implementation details</a></li>
      <li><a href="#installing-gateway-scripts-on-raspberry-pi" id="markdown-toc-installing-gateway-scripts-on-raspberry-pi">Installing gateway scripts on Raspberry Pi</a></li>
    </ul>
  </li>
  <li><a href="#device-provisioning" id="markdown-toc-device-provisioning">Device provisioning</a></li>
  <li><a href="#provision-your-dashboard" id="markdown-toc-provision-your-dashboard">Provision your dashboard</a></li>
  <li><a href="#data-visualization" id="markdown-toc-data-visualization">Data visualization</a></li>
  <li><a href="#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a></li>
  <li><a href="#see-also" id="markdown-toc-see-also">See also</a></li>
  <li><a href="#your-feedback" id="markdown-toc-your-feedback">Your feedback</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next steps</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>ThingsBoard is an open-source server-side platform that allows you to monitor and control IoT devices.
It is free for both personal and commercial usage and you can deploy it anywhere. 
If this is your first experience with the platform we recommend to review 
<a href="/docs/getting-started-guides/what-is-thingsboard/">what-is-thingsboard</a> page and <a href="/docs/getting-started-guides/helloworld/">getting-started</a> guide.</p>

<p>This sample demo performs collection of temperature and humidity values produced by BLE broadcasting devices and further visualization on the real-time web dashboard. In this example we use <a href="https://www.sparkfun.com/products/13763">HTU21D</a> connected to <a href="https://espressif.com/en/products/hardware/esp32/overview">ESP32</a> and  <a href="https://www.amazon.com/Xiaomi-Bluetooth-Temperature-Sensitive-Thermometer/dp/B07B9SJJZJ">Xiaomi Smart Temperature &amp; Humidity Sensor</a>. The purpose of this application is to demonstrate ThingsBoard  <a href="/docs/user-guide/telemetry/">data collection API</a> , <a href="/docs/user-guide/visualization/">visualization capabilities</a>, <a href="/docs/iot-gateway/what-is-iot-gateway/">gateway API</a> and the capabilities of <a href="https://en.wikipedia.org/wiki/Bluetooth_Low_Energy">Bluetooth Low Energy</a> protocol, which you can use with both custom and mass-produce devices.</p>

<p>Data is collected by a python script that is running on <a href="https://en.wikipedia.org/wiki/Raspberry_Pi">Raspberry Pi</a>. It pushes data to ThingsBoard server via MQTT protocol by using  <a href="https://github.com/thingsboard/thingsboard-python-client-sdk">ThingsBoard MQTT client Python SDK</a> library. Data is visualized using built-in customizable dashboard. Demo that is running on Raspberry Pi is written in Python which is quite simple and easy to understand.</p>

<p><img src="/images/samples/ble/ble-diagram.png" alt="Ble diagram" /></p>

<h2 id="list-of-hardware">List of hardware</h2>

<ul>
  <li>
    <p><a href="https://www.espressif.com/en/products/hardware/development-boards">ESP32-PICO-KIT</a></p>

    <p><img src="https://cdn.xingosoftware.com/elektor/images/fetch/dpr_1/https%3A%2F%2Fwww.elektormagazine.com%2Fassets%2Fupload%2Fimages%2F18%2F20171221112541_esp32-pico-kit-v4-004.jpg" width="400" /></p>
  </li>
  <li>
    <p><a href="https://ru.aliexpress.com/item/NEW-HTU21D-Temperature-Humidity-Sensor-Breakout-Board-Module/32451061596.html?spm=a2g0v.search0104.3.8.69f56062P2BU8f&amp;ws_ab_test=searchweb0_0,searchweb201602_3_10065_10068_319_10059_10884_317_10887_10696_321_322_10084_453_10083_454_10103_10618_10307_537_536,searchweb201603_52,ppcSwitch_0&amp;algo_expid=c8c9941c-ea29-40e5-b74a-d1c0ae217af7-1&amp;algo_pvid=c8c9941c-ea29-40e5-b74a-d1c0ae217af7">HTU21D Digital Relative Humidity Sensor</a></p>

    <p><img src="https://http2.mlstatic.com/htu21d-gy-21-sht21-sensor-humedad-precision-i2c-itytarg-D_NQ_NP_729642-MLA25959905493_092017-F.jpg" width="400" /></p>
  </li>
  <li>Breadboard</li>
  <li>4 female-to-male jumper wires</li>
  <li>
    <p><a href="https://www.raspberrypi.org/products/">Raspberry Pi with Bluetooth</a></p>

    <p><img src="https://images-na.ssl-images-amazon.com/images/I/91zSu44%2B34L._SL1500_.jpg" width="400" /></p>
  </li>
  <li>
    <p>Xiaomi Smart Temperature &amp; Humidity Sensor</p>

    <p><img src="http://cdn.shopify.com/s/files/1/0011/9957/1005/products/211941-1_1200x1200.jpg?v=1527580517" width="400" /></p>
  </li>
</ul>

<h2 id="hardware-setup">Hardware setup</h2>

<h3 id="esp32-wiring-scheme">ESP32 Wiring scheme</h3>

<table>
  <thead>
    <tr>
      <th>ESP32</th>
      <th>HTU21D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3V3</td>
      <td>VIN</td>
    </tr>
    <tr>
      <td>GND</td>
      <td>GND</td>
    </tr>
    <tr>
      <td>18</td>
      <td>SDA</td>
    </tr>
    <tr>
      <td>19</td>
      <td>SCL</td>
    </tr>
  </tbody>
</table>

<p>The following picture summarizes the connection of ESP32 and HTU21D:</p>

<p><img src="/images/samples/ble/esp32-htu21d-scheme.png" alt="Ble diagram" /></p>

<h3 id="raspberry-pi">Raspberry Pi</h3>

<p>In this setup we use Raspberry Pi 2 Model B V1.1 with <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian GNU/Linux 9.8 (stretch)</a> installed on it. Raspbian is a free operating system based on Debian optimized for the Raspberry Pi hardware. This model does’t support Bluetooth, so it needs a usb dongle. We use Grand-X BT40G.
Make sure your dongle is recognized by system. You can check it with the following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>$&gt; lsusb
...
Cambridge Silicon Radio, Ltd Bluetooth Dongle (HCI mode)
...

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Whole setup:</p>

<p><img src="/images/samples/ble/setup.jpg" alt="Ble diagram" /></p>

<h2 id="preparing-esp32">Preparing ESP32</h2>

<h3 id="application-capabilities">Application capabilities</h3>

<p>In this project ESP is a GATT server, which creates BLE service with two characteristics, one is read-only, and the second is for both reading and writing.
Also it reads temperature and humidity data from connected HTU21D sensor and broadcast it as notifications to all nearby BLE devices.
You can find the source code <a href="https://github.com/thingsboard/gatts_demo"><strong>here</strong></a>.
It is based on Espressif GATT demo server <a href="https://github.com/espressif/esp-idf/tree/master/examples/bluetooth/gatt_server"><strong>example</strong></a> and uses <a href="https://github.com/lucadentella/esp32_htu21d"><strong>this</strong></a> library to interact with HTU21D.</p>

<h3 id="flashing-esp32-bt-firmware">Flashing ESP32 BT firmware</h3>

<p>You need ESP-IDF (Espressif IoT Development Framework) to program your ESP32.
It is the official development framework for the ESP32 chip.
Install it with the following instructions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>mkdir ~/esp
cd ~/esp
git clone --recursive https://github.com/espressif/esp-idf.git
git checkout 3bf56cdd1
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Set up IDF_PATH before running any other command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>export IDF_PATH=~/esp/esp-idf
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The python packages required by ESP-IDF are located in IDF_PATH/requirements.txt. You can install them by running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python -m pip install --user -r $IDF_PATH/requirements.txt
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="note">Note</h4>

<p>Please check the version of the Python interpreter that you will be using with ESP-IDF. For this, run the command <code class="language-plaintext highlighter-rouge">python --version</code> and depending on the result, you might want to use python2, python2.7 or similar instead of just python, e.g.</p>

<p>See <a href="https://docs.espressif.com/projects/esp-idf/en/latest/get-started/index.html"><strong>this</strong></a> guide for more info.</p>

<p>Now you can flash your ESP:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>git clone https://github.com/thingsboard/gatts_demo
cd gatts_demo
make flash
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Run <code class="language-plaintext highlighter-rouge">make monitor</code> if you want to see logs of ESP and check if everything is okay.
Example of output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre>I (30) boot: ESP-IDF v4.0-dev-584-g3bf56cdd1 2nd stage bootloader
I (30) boot: compile time 14:00:10
I (30) boot: Enabling RNG early entropy source...
I (36) boot: SPI Speed      : 40MHz
I (40) boot: SPI Mode       : DIO
I (44) boot: SPI Flash Size : 4MB
I (48) boot: Partition Table:
I (52) boot: ## Label            Usage          Type ST Offset   Length
I (59) boot:  0 nvs              WiFi data        01 02 00009000 00006000
I (66) boot:  1 phy_init         RF data          01 01 0000f000 00001000
I (74) boot:  2 factory          factory app      00 00 00010000 00100000
I (81) boot: End of partition table
I (85) esp_image: segment 0: paddr=0x00010020 vaddr=0x3f400020 size=0x23384 (144260) map
I (145) esp_image: segment 1: paddr=0x000333ac vaddr=0x3ffbdb60 size=0x02c5c ( 11356) load
I (150) esp_image: segment 2: paddr=0x00036010 vaddr=0x40080000 size=0x00400 (  1024) load
0x40080000: _WindowOverflow4 at /home/yulia/esp/esp-idf/components/freertos/xtensa_vectors.S:1779

I (152) esp_image: segment 3: paddr=0x00036418 vaddr=0x40080400 size=0x09bf8 ( 39928) load
I (177) esp_image: segment 4: paddr=0x00040018 vaddr=0x400d0018 size=0x71ea0 (466592) map
0x400d0018: _flash_cache_start at ??:?

I (341) esp_image: segment 5: paddr=0x000b1ec0 vaddr=0x40089ff8 size=0x08d50 ( 36176) load
0x40089ff8: r_lld_pdu_rx_handler at ??:?

I (367) boot: Loaded app from partition at offset 0x10000
I (367) boot: Disabling RNG early entropy source...
I (368) cpu_start: Pro cpu up.
I (371) cpu_start: Application information:
I (376) cpu_start: Project name:     gatt_server_demos
I (382) cpu_start: App version:      b2732e4-dirty
I (387) cpu_start: Compile time:     Jun  3 2019 17:06:46
I (393) cpu_start: ELF file SHA256:  2d3d593eed804970...
I (399) cpu_start: ESP-IDF:          v4.0-dev-584-g3bf56cdd1
I (406) cpu_start: Starting app cpu, entry point is 0x400810e0
0x400810e0: call_start_cpu1 at /home/yulia/esp/esp-idf/components/esp32/cpu_start.c:267

I (0) cpu_start: App cpu up.
I (416) heap_init: Initializing. RAM available for dynamic allocation:
I (423) heap_init: At 3FFAFF10 len 000000F0 (0 KiB): DRAM
I (429) heap_init: At 3FFB6388 len 00001C78 (7 KiB): DRAM
I (435) heap_init: At 3FFB9A20 len 00004108 (16 KiB): DRAM
I (441) heap_init: At 3FFBDB5C len 00000004 (0 KiB): DRAM
I (447) heap_init: At 3FFC8EA0 len 00017160 (92 KiB): DRAM
I (453) heap_init: At 3FFE0440 len 00003AE0 (14 KiB): D/IRAM
I (460) heap_init: At 3FFE4350 len 0001BCB0 (111 KiB): D/IRAM
I (466) heap_init: At 40092D48 len 0000D2B8 (52 KiB): IRAM
I (472) cpu_start: Pro cpu start user code
I (155) cpu_start: Starting scheduler on PRO CPU.
I (0) cpu_start: Starting scheduler on APP CPU.
I (157) GATTS_DEMO: starting ESP gatt demo

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="preparing-mi-sensor">Preparing MI Sensor</h2>
<p>Install the battery in sensor.</p>

<h2 id="preparing-raspberry-pi">Preparing Raspberry Pi</h2>
<p>Demo script scans for available BLE devices and connects to them. It can read a direct value of BLE characteristic from ESP and receive notifications from both ESP and Mi. If needed, a re-scan command can be issues from the dashboard to connect to new devices.</p>

<h3 id="implementation-details">Implementation details</h3>

<p>If you are not interested in modifying or extending a list of supported devices, you can skip this sub-section.
The demo script consists of few modules: the main module and couple of extension modules.</p>

<p>The <a href="https://github.com/thingsboard/tb-ble-adapter/blob/master/tb_ble_adapter/adapter.py"><strong>main</strong></a> module is responsible for receiving commands from ThingsBoard and sending telemetry data. It also scans nearby devices and connects to them.</p>

<p>Extensions are <a href="https://github.com/thingsboard/tb-ble-adapter/tree/master/tb_ble_adapter/extensions"><strong>modules</strong></a> that responsible for extracting application-specific data from the BLE device. If you want to implement support for a new device, you can create additional extension class and inherit it from <a href="https://github.com/thingsboard/tb-ble-adapter/blob/master/tb_ble_adapter/extensions/ExtensionInterface.py"><strong>provided intarface</strong></a>. Use <a href="https://github.com/thingsboard/tb-ble-adapter/blob/master/tb_ble_adapter/extensions/MiTempHumidityExtension.py"><strong>this</strong></a> as an example.</p>

<h3 id="installing-gateway-scripts-on-raspberry-pi">Installing gateway scripts on Raspberry Pi</h3>
<p>Login to your Raspberry PI using SSH and install demo. It requires at least <strong>python3.4</strong>. 
Also script requires superuser rights for Bluetooth management, so you need to install it system-wide.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>sudo apt-get install libglib2.0-dev
sudo pip3 install tb-ble-adapter
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="device-provisioning">Device provisioning</h2>
<p>Run python script <strong>before</strong> importing dashboard. For this you have to <a href="/docs/iot-gateway/getting-started/"><strong>create</strong></a> gateway device and specify it in command arguments:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sudo tb_ble_adapter -t $GATEWAY_ACCESS_TOKEN
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Example of logs with device scanning, discovery of known devices and device connection:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre>Loading MiTempHumidityExtension extension...
Loading EspGattDemoExtension extension...
Scanning BLE devices...
Discovered BT device: 10:73:48:30:84:49
Discovered BT device: d8:a0:1d:40:93:fa
Discovered BT device: 3d:0b:d8:a9:ab:9d
Discovered BT device: 4e:8e:10:d8:c4:a1
Discovered BT device: 1b:83:77:79:2e:29
Discovered BT device: 00:1e:c0:75:d0:a3
Discovered BT device: 4c:65:a8:df:8e:3f
Discovered BT device: 4c:65:a8:df:85:c0
Discovered BT device: 4c:65:a8:df:94:d1
Received new data from: 4c:65:a8:df:8e:3f
Received new data from: 4c:65:a8:df:85:c0
Received new data from: 4c:65:a8:df:94:d1
Received new data from: 4c:65:a8:df:8e:3f
Received new data from: 4c:65:a8:df:8e:3f
Received new data from: 4c:65:a8:df:85:c0
Received new data from: 4c:65:a8:df:94:d1
Received new data from: 4c:65:a8:df:8e:3f
Received new data from: 4c:65:a8:df:85:c0
Received new data from: 4c:65:a8:df:94:d1
Discovered BT device: 2e:ff:58:11:60:71
Discovered BT device: 49:91:8f:6c:7a:17
Received new data from: 4c:65:a8:df:8e:3f
Received new data from: 4c:65:a8:df:8e:3f
Received new data from: 4c:65:a8:df:85:c0
Received new data from: 4c:65:a8:df:8e:3f
Received new data from: 4c:65:a8:df:85:c0
Received new data from: 4c:65:a8:df:94:d1
Received new data from: 4c:65:a8:df:8e:3f
Device 10:73:48:30:84:49 (random), RSSI=-52 dB
  Manufacturer = 06000109200298bf2a039d57aa7fda15c7cc1772001b3cd9881bf3e8e0
Device d8:a0:1d:40:93:fa (public), RSSI=-43 dB
  Flags = 06
  Complete Local Name = ESP_GATTS_DEMO
    [!] Known device found: ESP_GATTS_DEMO
  Tx Power = 03
  Complete 16b Services = 000000ee-0000-1000-8000-00805f9b34fb,000000ff-0000-1000-8000-00805f9b34fb
Device 3d:0b:d8:a9:ab:9d (random), RSSI=-76 dB
  Manufacturer = 0600010920029944e816d9764a15972cd9df7db619bf8dc0875737d50a
Device 4e:8e:10:d8:c4:a1 (random), RSSI=-72 dB
  Flags = 1a
  Manufacturer = 4c001005131c9659d5
Device 1b:83:77:79:2e:29 (random), RSSI=-91 dB
  Manufacturer = 060001092002fd5da974543017b16d0518788003bed6946bb155378f84
Device 00:1e:c0:75:d0:a3 (public), RSSI=-90 dB
  Flags = 06
  Complete 128b Services = 00035b03-58e6-07dd-021a-08123a000300
  Complete Local Name = D1900924
Device 4c:65:a8:df:8e:3f (public), RSSI=-59 dB
  Flags = 06
  16b Service Data = ffffe0845fe76916
  Complete Local Name = MJ_HT_V1
    [!] Known device found: MJ_HT_V1
  Complete 16b Services = 0000180f-0000-1000-8000-00805f9b34fb,0000180a-0000-1000-8000-00805f9b34fb
Device 4c:65:a8:df:85:c0 (public), RSSI=-51 dB
  Flags = 06
  16b Service Data = ffffca4e2ef743aa
  Complete Local Name = MJ_HT_V1
    [!] Known device found: MJ_HT_V1
  Complete 16b Services = 0000180f-0000-1000-8000-00805f9b34fb,0000180a-0000-1000-8000-00805f9b34fb
Device 4c:65:a8:df:94:d1 (public), RSSI=-57 dB
  Flags = 06
  16b Service Data = fffff61d60016488
  Complete Local Name = MJ_HT_V1
    [!] Known device found: MJ_HT_V1
  Complete 16b Services = 0000180f-0000-1000-8000-00805f9b34fb,0000180a-0000-1000-8000-00805f9b34fb
Device 2e:ff:58:11:60:71 (random), RSSI=-96 dB
  Manufacturer = 06000109200232a466069323755cf0a3f6333f3575276dd81e6a2940ba
Device 49:91:8f:6c:7a:17 (random), RSSI=-71 dB
  Flags = 1a
  Manufacturer = 4c001005131cc5c74c
Connecting to device: MJ_HT_V1_4C65A8DF8E3F
Polling data from: MJ_HT_V1_4C65A8DF8E3F
Received data: b'T=23.9 H=43.5\x00'
Data received: {'temperature': 23.9, 'humidity': 43.5}
Sending data to TB: {'ts': 1559827797240, 'values': {'temperature': 23.9, 'humidity': 43.5}}
Disconnecting from device

</pre></td></tr></tbody></table></code></pre></div></div>
<p>It creates devices:
<img src="/images/samples/ble/created_devices.png" alt="Created devices" /></p>

<h2 id="provision-your-dashboard">Provision your dashboard</h2>
<p>Download the dashboard file using this <a href="/docs/samples/ble/resources/device_gw.json"><strong>link</strong></a>. Now you have to import it. To do this, configure aliases in such way (use gateway device from <a href="#device-provisioning"><strong>Device provisioning</strong></a> section):</p>

<p><img src="/images/samples/ble/configure-aliases.png" alt="Configure aliases" /></p>

<p><img src="/images/samples/ble/edit_alias_gw_devices.png" alt="Edit alias gw_devices" /></p>

<p><img src="/images/samples/ble/edit_alias_gw.png" alt="Edit alias gw" /></p>

<p>Also this dashboard needs a custom widget bundle. Download it with this <a href="/docs/samples/ble/resources/custom_widget.json"><strong>link</strong></a> and import using import/export <a href="/docs/user-guide/ui/widget-library/"><strong>instructions</strong></a>.</p>

<h2 id="data-visualization">Data visualization</h2>
<p>Finally, open ThingsBoard Web UI. You can access this dashboard by logging in as a tenant administrator.</p>

<p>In case of local installation:</p>
<ul>
  <li>login:  tenant@thingsboard.org</li>
  <li>password: tenant</li>
</ul>

<p>In case of live-demo server:</p>
<ul>
  <li>login: your live-demo username (email)</li>
  <li>password: your live-demo password</li>
</ul>

<p>See  <strong><a href="/docs/user-guide/live-demo/">live-demo</a></strong>  page for more details how to get your account.</p>

<p>Go to <strong>“Devices”</strong> section, open created devices details and switch to <strong>“Latest telemetry”</strong> tab. If all is configured correctly you should be able to see latest telemetry values sent via BLE in the table.</p>

<p><img src="/images/samples/ble/latest-telemetry.png" alt="Latest telemetry" /></p>

<p>After, open <strong>“Dashboards”</strong> section and find previously imported dashboard <strong>“Device GW”</strong> and observe the following picture:</p>

<p><img src="/images/samples/ble/dashboard.png" alt="Dashboard" /></p>

<h2 id="troubleshooting">Troubleshooting</h2>
<p>In order to perform troubleshooting, you must check demo script output. It displays connection status with every device, as well as received and sent data.</p>

<h2 id="see-also">See also</h2>
<p>Browse other  <a href="/docs/samples">samples</a>  or explore guides related to main ThingsBoard features:</p>

<ul>
  <li><a href="/docs/user-guide/attributes/">Device attributes</a>  - how to use device attributes.</li>
  <li><a href="/docs/user-guide/telemetry/">Telemetry data collection</a>  - how to collect telemetry data.</li>
  <li><a href="/docs/user-guide/rpc/">Using RPC capabilities</a>  - how to send commands to/from devices.</li>
  <li><a href="/docs/user-guide/rule-engine/">Rule Engine</a>  - how to use rule engine to analyze data from devices.</li>
  <li><a href="/docs/user-guide/visualization/">Data Visualization</a>  - how to visualize collected data.</li>
</ul>

<h2 id="your-feedback">Your feedback</h2>

<p>Don’t hesitate to star ThingsBoard on <strong><a href="https://github.com/thingsboard/thingsboard">github</a></strong> to help us spread the word.
If you have any questions about this sample - post it on the <strong><a href="https://github.com/thingsboard/thingsboard/issues">issues</a></strong>.</p>

<div id="share"></div>
<script>
    jqueryDefer(initSocials);
    function initSocials() {
        var scriptsList = [
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js', type: 'script'}
        ];
        loadNextScript(0, scriptsList,
                function() {
                    $("#share").jsSocials({
                        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp", "telegram"],
                        showLabel: false,
                        showCount: false
                    });
                }
        );
    }
</script>

<h2 id="next-steps">Next steps</h2>

<ul>
  <li>
    <p><a href="/docs/guides#AnchorIDGettingStartedGuides">Getting started guides</a> - These guides provide quick overview of main ThingsBoard features. Designed to be completed in 15-30 minutes.</p>
  </li>
  <li>
    <p><a href="/docs/user-guide/install/installation-options/">Installation guides</a> - Learn how to setup ThingsBoard on various available operating systems.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDConnectYourDevice">Connect your device</a> - Learn how to connect devices based on your connectivity technology or solution.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDDataVisualization">Data visualization</a> - These guides contain instructions how to configure complex ThingsBoard dashboards.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDDataProcessing">Data processing &amp; actions</a> - Learn how to use ThingsBoard Rule Engine.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDDataAnalytics">IoT Data analytics</a> - Learn how to use rule engine to perform basic analytics tasks.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDAdvancedFeatures">Advanced features</a> - Learn about advanced ThingsBoard features.</p>
  </li>
  <li>
    <p><a href="/docs/guides#AnchorIDContribution">Contribution and Development</a> - Learn about contribution and development in ThingsBoard.</p>
  </li>
</ul>

<p><br /></p>


      </div>
      <footer>
	<main class="light-text">
		<div class="newsletterSubsContainer">
            <script type="text/javascript">
                function subscribeForNewsletter(event) {
                    event.stopPropagation();
                    var script_tag = document.createElement('script');
                    script_tag.setAttribute("type", "text/javascript");
                    script_tag.setAttribute("src", "https://static.mailerlite.com/js/w/webforms.min.js?v28bf44f740701752bfc6767bc7e171d4");
                    document.getElementsByTagName("head")[0].appendChild(script_tag);
                    $(event.target).css('display', 'none');
                    $('#mlb2-7341216').css('display', 'block');
                }
            </script>
            <button class="n-button price subscribe" onClick="subscribeForNewsletter(event)">Sign up for ThingsBoard news</button>
            <div id="mlb2-7341216" class="ml-subscribe-form ml-subscribe-form-7341216" style="display: none;">
<!--            <div id="mlb2-7341216" class="ml-subscribe-form ml-subscribe-form-7341216" style="display: block;">-->
                <div class="ml-vertical-align-center">
                    <div class="subscribe-form ml-block-success" style="display: none;">
                        <div class="form-section">
                            <p>Thank you for your interest in ThingsBoard!<br/>Have a great day!</p>
                        </div>
                    </div>
                    <form class="ml-block-form" action="https://static.mailerlite.com/webforms/submit/r9r9x7" data-id="708170" data-code="r9r9x7" method="POST" target="_blank">
                        <div class="subscribe-form horizontal">
                            <div class="form-section horizontal">
                                <div class="form-group ml-field-email ml-validate-required ml-validate-email">
                                    <input type="email" name="fields[email]" class="form-control" placeholder="Email address*" value="" autocomplete="email" x-autocompletetype="email" spellcheck="false" autocapitalize="off" autocorrect="off">
                                </div>
                            </div>
                            <input type="hidden" name="ml-submit" value="1">
                            <div class="form-section horizontal ml-button-position">
                                <button class="primary n-button price subscribe" type="submit">
                                    Subscribe
                                </button>
                                <button disabled="disabled" style="display: none;" type="button" class="n-button loading">
                                    <img src="https://static.mailerlite.com/images/rolling@2x.gif" width="20" height="20" style="width: 20px; height: 20px;">
                                </button>
                            </div>
                            <p>By subscribing you agree to receive newsletters from ThingsBoard, Inc.</p>
                        </div>
                    </form>
                </div>
            </div>
		</div>

        <hr>

        <div class="deeper">
            <a href="/" class="footer-logo"></a>
            <nav>
                <a href="/docs/getting-started-guides/helloworld/">Get Started</a>
                <a href="/docs/">Documentation</a>
                <a href="/iot-use-cases/">Use cases</a>
                <a href="https://blog.thingsboard.io/">Blog</a>
                <a href="/docs/services/">Services</a>
                <a href="/docs/contact-us/">Contact us</a>
            </nav>
        </div>

        <div class="deepmost">
            <div class="copyright">&copy; 2021 The ThingsBoard Authors</div>
            <div class="social">
                <a href="https://github.com/thingsboard/thingsboard" class="github"></a>
                <a href="https://gitter.im/thingsboard/chat" class="gitter"></a>
                <a href="https://www.youtube.com/thingsboard" class="youtube"></a>
                <a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"></a>
                <a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"></a>
                <a href="https://www.facebook.com/thingsboard" class="facebook"></a>
                <a href="https://twitter.com/thingsboard" class="twitter"></a>
            </div>
        </div>
	</main>
</footer>

  </div>
</section>

<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
<script>
    jqueryDefer(function () {
        $(document).on('selectionchange',function() {
        // $(document).mouseup(function () {
            $('.clipboard-btn').removeClass('noChars');
            var selectedChars = getSelectedText();
            // $('#numberChars').html(selectedChars.length);
            if (selectedChars == 0) {
                $('.clipboard-btn').addClass('noChars');
            }
        });
    });
    function getSelectedText() {
        var text;
        if (window.getSelection) {
            text = window.getSelection().toString();
        } else if (document.getSelection) {
            text = document.getSelection();
        } else if (document.selection) {
            text = document.selection.createRange().text;
        }
        return text;
    }
</script>
<script>
    jqueryDefer(function () {
        $(document).ready(function () {
            var allCodeBlocksElements = $(".copy-code");
            allCodeBlocksElements.each(function (i) {
                var codeBlock = $(this);
                if (!codeBlock.hasClass('highlighter-rouge')) {
                    codeBlock = codeBlock.find('.highlighter-rouge');
                }
                codeBlock.each(function () {
                    var block = codeBlock.find('pre.highlight > code .rouge-code');
                    var currentId = "codeblock" + (i + 1);
                    block.attr('id', currentId);
                    var clipButton = $('<button class="clipboard-btn" data-clipboard-target="#' + currentId + '"><p>Copy to clipboard</p><div><img src="/images/copy-code-icon.svg" alt="Copy to clipboard"></div></button>');
                    $(this).append(clipButton);
                    var troyan = codeBlock.find('pre.highlight');
                    var Tooltip = $('<div class="customTooltip"><div class="tooltipText">Copied!</div></div>');
                    troyan.append(Tooltip);
                    troyan.addClass('clipboard-btn');
                    troyan.attr('data-clipboard-target', "#" + currentId);
                    troyan.on('mouseleave', clearTooltip);
                    troyan.on('blur', clearTooltip);
                    troyan.on('click', function(e) {
                        var el = $(e.currentTarget);
                        if (el.hasClass('showTool')) {
                            clearTooltip(e);
                            troyan.attr('data-skip-tooltip', "true");
                        }
                    });
                });
            });

            var clipboard = new Clipboard('.noChars');
            clipboard.on('success', function (e) {
                $('.clipboard-btn').removeClass('noChars');
                e.clearSelection();
                var trigger = e.trigger;
                if (!$(trigger).attr('data-skip-tooltip')) {
                    showTooltip(e.trigger, 'Copied!');
                } else {
                    $(trigger).removeAttr('data-skip-tooltip');
                }
            });

            $('#search').focus(
                function(){
                    $(this).parent('#searchBox').addClass('focused');
                }).blur(
                function(){
                    $(this).parent('#searchBox').removeClass('focused');
                });

            $('#searchBox .searchButton').click(function () {
                var value = $('#search').val();
                window.location.replace('/docs/search/?q=' + value);
            });

            $('#docsBreadcrumbs').click(function () {
                if ($(this).hasClass('active')) {
                    $(this).removeClass('active');
                    $('#docsNav').removeClass('active');
                    $('#searchBox').removeClass('visible');
                } else {
                    $(this).addClass('active');
                    $('#docsNav').addClass('active');
                    $('#searchBox').addClass('visible');
                }
            });
        });

        function clearTooltip(e) {
            var el = $(e.currentTarget);
            el.removeClass('showTool');
            el.attr('aria-label', null);
        }

        function showTooltip(elem, msg) {
            var el = $(elem);
            el.addClass('showTool');
            el.attr('aria-label', msg);
        }
    });
</script>

<script>
    jqueryDefer(function () {
        var markdownTocs = null;
        var contentAnchors = [];
        var activeAnchor = null;
        var firstAnchor = null;
        var lastAnchor = null;

        function updatePositions() {
            contentAnchors = [];
            markdownTocs.each(function (i) {
                var tocAnchor = $(this).children('a');
                var href = tocAnchor.attr('href');
                var contentAnchor = $('div#content ' + href);
                var top = Math.floor(contentAnchor.offset().top);
                var bottom;
                if (i < markdownTocs.length - 1) {
                    var nextHref = $(markdownTocs[i + 1]).children('a').attr('href');
                    var nextContentAnchor = $('div#content ' + nextHref);
                    bottom = Math.floor(nextContentAnchor.offset().top);
                } else {
                    bottom = $('div#content').offset().top + $('div#content').innerHeight();
                }
                var contentAnchorInfo = {anchor: contentAnchor, toc: $(this), top: top, bottom: bottom, href: href};
                contentAnchors.push(contentAnchorInfo);
                if (i === 0) {
                    firstAnchor = contentAnchorInfo;
                }
                if (i === markdownTocs.length - 1) {
                    lastAnchor = contentAnchorInfo;
                }
            });
        }

        function findActiveContentToc() {
            var top = $(window).scrollTop();
            var bottom = top + $(window).height();
            if (bottom === $('#encyclopedia').offset().top + $('#encyclopedia').innerHeight()) {
                return lastAnchor;
            } else {
                bottom -= 154;
                for (var i = 0; i < contentAnchors.length; i++) {
                    var contentAnchor = contentAnchors[i];
                    if (contentAnchor.top <= bottom &&
                        contentAnchor.bottom > top) {
                        return contentAnchor;
                    }
                }
            }
            return firstAnchor;
        }

        function updateActiveToc(init) {
            updatePositions();
            var newActiveAnchor = findActiveContentToc();
            if (!activeAnchor || newActiveAnchor.href !== activeAnchor.href) {
                activeAnchor = newActiveAnchor;
                markdownTocs.removeClass('active');
                activeAnchor.toc.addClass('active');
                var tocTop = $('#table-of-contents').scrollTop() + 100;
                var tocBottom = tocTop + $('#table-of-contents').innerHeight() - 200;
                var activeTocTop = activeAnchor.toc.position().top;
                var activeTocBottom = activeTocTop + activeAnchor.toc.children(':first').height();
                if (tocTop > activeTocTop) {
                    activeAnchor.toc[0].scrollIntoView();
                    $('#table-of-contents')[0].scrollTop -= 100;
                } else if (tocBottom < activeTocBottom) {
                    activeAnchor.toc[0].scrollIntoView();
                    $('#table-of-contents')[0].scrollTop += init ? -100 : 100;
                }
            }
        }
        $( document ).ready(function() {
            var tocs = $('#content > ul#markdown-toc');
            var tableOfContents = $('#table-of-contents');
            tableOfContents.append(tocs);
            markdownTocs = $('#table-of-contents ul#markdown-toc li').filter(function() {
                var tocAnchor = $(this).children('a');
                var href = tocAnchor.attr('href');
                if (!href.startsWith('#')) {
                    return false;
                } else {
                    var contentAnchor = $('div#content ' + href);
                    return contentAnchor.length > 0;
                }
            });
            updateActiveToc(true);
        });

        $(document).on("scroll", function() {
            updateActiveToc(false);
        });

    });
</script>

</body>
</html>

